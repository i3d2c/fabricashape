!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("fabric")):"function"==typeof define&&define.amd?define("fabricashape",["fabric"],e):"object"==typeof exports?exports.fabricashape=e(require("fabric")):t.fabricashape=e(t.fabric)}("undefined"!=typeof self?self:this,function(t){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(e,n){e.exports=t},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Line=void 0;var o=n(0),i=n(2);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var c=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))).bodyFill=t.fill,n.bodyText=t.text||"",n.components=[],n.type="line",n.hasControls=!0,i.Constants.RECT_DISABLED_CONTROLS.forEach(function(t){n.setControlVisible(t,!1)}),n.set("fill","transparent"),n.on({added:n._initComponents,modified:n._setComponentsPosition,scaling:n._setComponentsPosition,moving:n._setComponentsPosition,rotating:n._setComponentsPosition}),n}var n,r,c;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(e,o.fabric.Rect),n=e,(r=[{key:"_initComponents",value:function(){var t=this;this.text=new o.fabric.Text("",{visible:!1}),this.body=new o.fabric.Rect({width:this.width,height:this.height,top:this.top,left:this.left,fill:this.bodyFill}),this.components=[this.text,this.body],this.components.forEach(function(e){e.hasControls=!1,e.selectable=!1,t.canvas.add(e),e.sendBackwards()}),this.setText(this.bodyText)}},{key:"_setComponentsPosition",value:function(){var t=this.height*this.scaleY,e=this.width*this.scaleX,n=this.getBoundingRect();this.text&&this.text.set({top:n.top+.5*(n.height-this.text.height),left:n.left+.5*(n.width-this.text.width)}),this.body.set({top:this.top,left:this.left,width:e,height:t,angle:this.angle})}},{key:"getComponents",value:function(){return this.components}},{key:"setText",value:function(t){"m"!==t.slice(-1)&&(t+="m"),this.text.set({text:t}),this._setComponentsPosition()}}])&&s(n.prototype,r),c&&s(n,c),e}();e.Line=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Constants=void 0;e.Constants={RECT_DISABLED_CONTROLS:["tl","tr","bl","br","mt","mb"]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Arrowline",{enumerable:!0,get:function(){return o.Arrowline}}),Object.defineProperty(e,"Canvas",{enumerable:!0,get:function(){return i.Canvas}}),Object.defineProperty(e,"Line",{enumerable:!0,get:function(){return r.Line}}),Object.defineProperty(e,"Constants",{enumerable:!0,get:function(){return s.Constants}});var o=n(4),i=n(5),r=n(1),s=n(2)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Arrowline=void 0;var o=n(0),i=n(1);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var c=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))).type="arrowline",n.bodyFill=t.fill,n}var n,r,c;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(e,i.Line),n=e,(r=[{key:"_initComponents",value:function(){var t=this;this.text=new o.fabric.Text("",{backgroundColor:"white"}),this.body=new o.fabric.Rect({fill:this.bodyFill}),this.leftTriangle=new o.fabric.Triangle({fill:this.bodyFill}),this.rightTriangle=new o.fabric.Triangle({fill:this.bodyFill}),this._setComponentsPosition(),this.components=[this.body,this.leftTriangle,this.rightTriangle,this.text],this.components.forEach(function(e){e.hasControls=!1,e.selectable=!1,t.canvas.add(e),e.sendBackwards()}),this.setText(this.bodyText)}},{key:"_setComponentsPosition",value:function(){var t=Math.PI/180,e=this.height*this.scaleY,n=this.width*this.scaleX,o=Math.cos(this.angle*t),i=Math.sin(this.angle*t),r=this.getBoundingRect();this.text.set({top:r.top+.5*(r.height-this.text.height),left:r.left+.5*(r.width-this.text.width),fontSize:18}),this.body.set({top:this.top+e*i+e/4*o,left:this.left+e*o-e/4*i,width:n-2*e,height:e/2,angle:this.angle}),this.leftTriangle.set({top:this.top+e*o,left:this.left-e*i,width:e,height:e,angle:this.angle-90}),this.rightTriangle.set({top:this.top+n*i,left:this.left+n*o,width:e,height:e,angle:this.angle+90})}}])&&s(n.prototype,r),c&&s(n,c),e}();e.Arrowline=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Canvas=void 0;var o=n(0),i=n(2),r=n(1);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function l(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var u=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))).domElemendId=t,n.scale={value:null,shape:null},n.backgroundImage=null,n}var n,s,u;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,o.fabric.Canvas),n=e,(s=[{key:"addImage",value:function(t){var e=this,n=new FileReader;n.onload=function(){var t=document.createElement("img");t.src=n.result,e.backgroundImage=new o.fabric.Image(t),e.backgroundImage.scale(e.height/e.backgroundImage.height),e.add(e.backgroundImage),e.backgroundImage.sendToBack(),e.renderAll()},n.readAsDataURL(t)}},{key:"lockImage",value:function(){this.backgroundImage.hasControls=!1,this.backgroundImage.selectable=!1,this.discardActiveObject(),this.renderAll()}},{key:"_lockObjectsToBoundaries",value:function(){this.on("object:moving",function(t){var e=t.target;e.currentHeight>this.height||e.currentWidth>this.width||(e.setCoords(),(e.getBoundingRect().top<0||e.getBoundingRect().left<0)&&(e.top=Math.max(e.top,e.top-e.getBoundingRect().top),e.left=Math.max(e.left,e.left-e.getBoundingRect().left)),(e.getBoundingRect().top+e.getBoundingRect().height>this.height||e.getBoundingRect().left+e.getBoundingRect().width>this.width)&&(e.top=Math.min(e.top,this.height-e.getBoundingRect().height+e.top-e.getBoundingRect().top),e.left=Math.min(e.left,this.width-e.getBoundingRect().width+e.left-e.getBoundingRect().left)))})}},{key:"setScale",value:function(t){t.shape&&(this.scale.shape=t.shape),t.value&&(this.scale.value=t.value)}},{key:"getScale",value:function(){return this.scale}},{key:"lockScale",value:function(){this.scale.shape.hasControls=!1}},{key:"listToSelectDOM",value:function(t){var e=document.getElementById(this.domElemendId),n=document.createElement("select");n.id="fabricashapeShapeChoices",e.parentElement.appendChild(n);for(var o=0;o<t.length;o++){var i=document.createElement("option");i.value=t[o].label,i.text=t[o].label,i.style.backgroundColor=t[o].color,n.appendChild(i)}return n}},{key:"setShapeChoices",value:function(t){var e=this.listToSelectDOM(t);this.createReferenceLine(e)}},{key:"createReferenceLine",value:function(t){var e=this,n=new o.fabric.Rect({top:5,left:5,width:80,height:17,fill:t.options[t.selectedIndex].style.backgroundColor});this.add(n),this.item(this.size()-1).hasControls=!1,this.requestRenderAll();var r=function(){e.item(e.size()-1).set("fill",t.options[t.selectedIndex].style.backgroundColor),e.renderAll()};n.on("mousedown",function(){e.createReferenceLine(t),n.hasControls=!0,i.Constants.RECT_DISABLED_CONTROLS.forEach(function(t){n.setControlVisible(t,!1)}),n.off("mousedown")}),t.removeEventListener("change",r),t.addEventListener("change",r)}},{key:"createScaledLine",value:function(t){var e=this.scale.shape.width*this.scale.shape.scaleX/this.scale.value;return t.top=t.top*e,t.left=t.left*e,t.width=t.width*e,t.height=t.stroke*e,new r.Line(t)}}])&&a(n.prototype,s),u&&a(n,u),e}();e.Canvas=u}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvZXh0ZXJuYWwgXCJmYWJyaWNcIiIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvbGluZS5qcyIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvYXJyb3dsaW5lLmpzIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS8uL3NyYy9jYW52YXMuanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIl9mYWJyaWMiLCJfY29uc3RhbnRzIiwiTGluZSIsIm9wdGlvbnMiLCJfdGhpcyIsIl9jbGFzc0NhbGxDaGVjayIsIl9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIiwiX19wcm90b19fIiwiZ2V0UHJvdG90eXBlT2YiLCJib2R5RmlsbCIsImZpbGwiLCJib2R5VGV4dCIsInRleHQiLCJjb21wb25lbnRzIiwidHlwZSIsImhhc0NvbnRyb2xzIiwiQ29uc3RhbnRzIiwiUkVDVF9ESVNBQkxFRF9DT05UUk9MUyIsImZvckVhY2giLCJjb250cm9sIiwic2V0Q29udHJvbFZpc2libGUiLCJzZXQiLCJvbiIsImFkZGVkIiwiX2luaXRDb21wb25lbnRzIiwibW9kaWZpZWQiLCJfc2V0Q29tcG9uZW50c1Bvc2l0aW9uIiwic2NhbGluZyIsIm1vdmluZyIsInJvdGF0aW5nIiwiZmFicmljIiwiUmVjdCIsIl90aGlzMiIsIlRleHQiLCJ2aXNpYmxlIiwiYm9keSIsIndpZHRoIiwiaGVpZ2h0IiwidG9wIiwibGVmdCIsImNvbXBvbmVudCIsInNlbGVjdGFibGUiLCJjYW52YXMiLCJhZGQiLCJzZW5kQmFja3dhcmRzIiwic2V0VGV4dCIsInNjYWxlWSIsInNjYWxlWCIsImJvdW5kaW5nUmVjdCIsImdldEJvdW5kaW5nUmVjdCIsImFuZ2xlIiwic2xpY2UiLCJfYXJyb3dsaW5lIiwiX2NhbnZhcyIsIl9saW5lIiwiQXJyb3dsaW5lIiwiYmFja2dyb3VuZENvbG9yIiwibGVmdFRyaWFuZ2xlIiwiVHJpYW5nbGUiLCJyaWdodFRyaWFuZ2xlIiwiZGVncmVlc1RvUmFkaWFuc1JhdGlvIiwiTWF0aCIsIlBJIiwiY29zVGV0YSIsImNvcyIsInNpblRldGEiLCJzaW4iLCJmb250U2l6ZSIsIkNhbnZhcyIsImRvbUVsZW1lbmRJZCIsInNjYWxlIiwic2hhcGUiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJpbWFnZUZpbGUiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkIiwiaW1nIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwic3JjIiwicmVzdWx0IiwiSW1hZ2UiLCJzZW5kVG9CYWNrIiwicmVuZGVyQWxsIiwicmVhZEFzRGF0YVVSTCIsImRpc2NhcmRBY3RpdmVPYmplY3QiLCJlIiwib2JqIiwidGFyZ2V0IiwiY3VycmVudEhlaWdodCIsImN1cnJlbnRXaWR0aCIsInNldENvb3JkcyIsIm1heCIsIm1pbiIsInNjYWxlRGVmaW5pdGlvbiIsImNob2ljZXMiLCJjYW52YXNob2xkZXIiLCJnZXRFbGVtZW50QnlJZCIsInNlbGVjdExpc3QiLCJpZCIsInBhcmVudEVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsImxlbmd0aCIsIm9wdGlvbiIsImxhYmVsIiwic3R5bGUiLCJjb2xvciIsInNlbGVjdE9iamVjdCIsImxpc3RUb1NlbGVjdERPTSIsImNyZWF0ZVJlZmVyZW5jZUxpbmUiLCJfdGhpczMiLCJyZWZlcmVuY2VMaW5lIiwic2VsZWN0ZWRJbmRleCIsIml0ZW0iLCJzaXplIiwicmVxdWVzdFJlbmRlckFsbCIsImZpbGxSZWZlcmVuY2VMaW5lIiwib2ZmIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImFkZEV2ZW50TGlzdGVuZXIiLCJzdHJva2UiXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsaUJBQUFDLFNBQUEsaUJBQUFDLE9BQ0FBLE9BQUFELFFBQUFELEVBQUFHLFFBQUEsV0FDQSxtQkFBQUMsZUFBQUMsSUFDQUQsT0FBQSwwQkFBQUosR0FDQSxpQkFBQUMsUUFDQUEsUUFBQSxhQUFBRCxFQUFBRyxRQUFBLFdBRUFKLEVBQUEsYUFBQUMsRUFBQUQsRUFBQSxRQVJBLENBU0Msb0JBQUFPLFVBQUFDLEtBQUEsU0FBQUMsR0FDRCxtQkNUQSxJQUFBQyxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFWLFFBR0EsSUFBQUMsRUFBQU8sRUFBQUUsR0FBQSxDQUNBQyxFQUFBRCxFQUNBRSxHQUFBLEVBQ0FaLFFBQUEsSUFVQSxPQU5BYSxFQUFBSCxHQUFBSSxLQUFBYixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBUyxHQUdBUixFQUFBVyxHQUFBLEVBR0FYLEVBQUFELFFBMERBLE9BckRBUyxFQUFBTSxFQUFBRixFQUdBSixFQUFBTyxFQUFB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QUFlUCxNQUFNbEQsaUJBQ3hFdUQsRUFBSzNCLGFBV1Q0QixFQUFjMUYsR0FBRyxZQUFhLFdBUDFCeUYsRUFBS0Qsb0JBQW9CRixHQUN6QkksRUFBY2pHLGFBQWMsRUFDNUJkLEVBQUFlLFVBQVVDLHVCQUF1QkMsUUFBUSxTQUFDQyxHQUN0QzZGLEVBQWM1RixrQkFBa0JELEdBQVMsS0FNN0M2RixFQUFjTSxJQUFJLGVBR3RCVixFQUFhVyxvQkFBb0IsU0FBVUYsR0FDM0NULEVBQWFZLGlCQUFpQixTQUFVSCw0Q0FHM0JsSCxHQUNiLElBQU1tRSxFQUFTM0csS0FBSzJHLE1BQU1DLE1BQU1uQyxNQUFRekUsS0FBSzJHLE1BQU1DLE1BQU14QixPQUFVcEYsS0FBSzJHLE1BQU1yRixNQU85RSxPQUxBa0IsRUFBUW1DLElBQU1uQyxFQUFRbUMsSUFBTWdDLEVBQzVCbkUsRUFBUW9DLEtBQU9wQyxFQUFRb0MsS0FBTytCLEVBQzlCbkUsRUFBUWlDLE1BQVFqQyxFQUFRaUMsTUFBUWtDLEVBQ2hDbkUsRUFBUWtDLE9BQVNsQyxFQUFRc0gsT0FBU25ELEVBRTNCLElBQUFoQixFQUFBcEQsS0FBU0MiLCJmaWxlIjoiZmFicmljYXNoYXBlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZShcImZhYnJpY1wiKSk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShcImZhYnJpY2FzaGFwZVwiLCBbXCJmYWJyaWNcIl0sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiZmFicmljYXNoYXBlXCJdID0gZmFjdG9yeShyZXF1aXJlKFwiZmFicmljXCIpKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJmYWJyaWNhc2hhcGVcIl0gPSBmYWN0b3J5KHJvb3RbXCJmYWJyaWNcIl0pO1xufSkodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHRoaXMsIGZ1bmN0aW9uKF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzBfXykge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAzKTtcbiIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fOyIsImltcG9ydCB7ZmFicmljfSBmcm9tICdmYWJyaWMnXG5pbXBvcnQge0NvbnN0YW50c30gZnJvbSAnLi9jb25zdGFudHMnXG5cbmV4cG9ydCBjbGFzcyBMaW5lIGV4dGVuZHMgZmFicmljLlJlY3Qge1xuXG4gICAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgICAgICBzdXBlcihvcHRpb25zKVxuICAgICAgICB0aGlzLmJvZHlGaWxsID0gb3B0aW9ucy5maWxsXG4gICAgICAgIHRoaXMuYm9keVRleHQgPSBvcHRpb25zLnRleHQgfHwgJydcbiAgICAgICAgdGhpcy5jb21wb25lbnRzID0gW11cbiAgICAgICAgdGhpcy50eXBlID0gJ2xpbmUnXG4gICAgICAgIHRoaXMuaGFzQ29udHJvbHMgPSB0cnVlXG4gICAgICAgIENvbnN0YW50cy5SRUNUX0RJU0FCTEVEX0NPTlRST0xTLmZvckVhY2goKGNvbnRyb2wpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0Q29udHJvbFZpc2libGUoY29udHJvbCwgZmFsc2UpXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuc2V0KCdmaWxsJywgJ3RyYW5zcGFyZW50JylcblxuICAgICAgICB0aGlzLm9uKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICdhZGRlZCc6IHRoaXMuX2luaXRDb21wb25lbnRzLFxuICAgICAgICAgICAgICAgICdtb2RpZmllZCc6IHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbixcbiAgICAgICAgICAgICAgICAnc2NhbGluZyc6IHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbixcbiAgICAgICAgICAgICAgICAnbW92aW5nJzogdGhpcy5fc2V0Q29tcG9uZW50c1Bvc2l0aW9uLFxuICAgICAgICAgICAgICAgICdyb3RhdGluZyc6IHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvblxuICAgICAgICAgICAgfVxuICAgICAgICApXG4gICAgfVxuXG4gICAgX2luaXRDb21wb25lbnRzKCkge1xuICAgICAgICB0aGlzLnRleHQgPSBuZXcgZmFicmljLlRleHQoJycsIHt2aXNpYmxlOiBmYWxzZX0pXG4gICAgICAgIHRoaXMuYm9keSA9IG5ldyBmYWJyaWMuUmVjdCh7XG4gICAgICAgICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQsXG4gICAgICAgICAgICB0b3A6IHRoaXMudG9wLFxuICAgICAgICAgICAgbGVmdDogdGhpcy5sZWZ0LFxuICAgICAgICAgICAgZmlsbDogdGhpcy5ib2R5RmlsbFxuICAgICAgICB9KVxuICAgICAgICB0aGlzLmNvbXBvbmVudHMgPSBbdGhpcy50ZXh0LCB0aGlzLmJvZHldXG5cbiAgICAgICAgdGhpcy5jb21wb25lbnRzLmZvckVhY2goKGNvbXBvbmVudCkgPT4ge1xuICAgICAgICAgICAgY29tcG9uZW50Lmhhc0NvbnRyb2xzID0gZmFsc2VcbiAgICAgICAgICAgIGNvbXBvbmVudC5zZWxlY3RhYmxlID0gZmFsc2VcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLmFkZChjb21wb25lbnQpXG4gICAgICAgICAgICBjb21wb25lbnQuc2VuZEJhY2t3YXJkcygpXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuc2V0VGV4dCh0aGlzLmJvZHlUZXh0KVxuICAgIH1cblxuICAgIF9zZXRDb21wb25lbnRzUG9zaXRpb24oKSB7XG4gICAgICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuaGVpZ2h0ICogdGhpcy5zY2FsZVksXG4gICAgICAgICAgICB3aWR0aCA9IHRoaXMud2lkdGggKiB0aGlzLnNjYWxlWCxcbiAgICAgICAgICAgIGJvdW5kaW5nUmVjdCA9IHRoaXMuZ2V0Qm91bmRpbmdSZWN0KClcblxuICAgICAgICBpZiAodGhpcy50ZXh0KSB7XG4gICAgICAgICAgICB0aGlzLnRleHQuc2V0KHtcbiAgICAgICAgICAgICAgICB0b3A6IGJvdW5kaW5nUmVjdC50b3AgKyAwLjUgKiAoYm91bmRpbmdSZWN0LmhlaWdodCAtIHRoaXMudGV4dC5oZWlnaHQpLFxuICAgICAgICAgICAgICAgIGxlZnQ6IGJvdW5kaW5nUmVjdC5sZWZ0ICsgMC41ICogKGJvdW5kaW5nUmVjdC53aWR0aCAtIHRoaXMudGV4dC53aWR0aClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmJvZHkuc2V0KHtcbiAgICAgICAgICAgIHRvcDogdGhpcy50b3AsXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLmxlZnQsXG4gICAgICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgIGFuZ2xlOiB0aGlzLmFuZ2xlXG4gICAgICAgIH0pXG5cbiAgICB9XG5cbiAgICBnZXRDb21wb25lbnRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21wb25lbnRzXG4gICAgfVxuXG4gICAgc2V0VGV4dCh0ZXh0KSB7XG4gICAgICAgIGlmICh0ZXh0LnNsaWNlKC0xKSAhPT0gJ20nKSB7XG4gICAgICAgICAgICB0ZXh0ICs9ICdtJ1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudGV4dC5zZXQoe1xuICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICB9KVxuICAgICAgICB0aGlzLl9zZXRDb21wb25lbnRzUG9zaXRpb24oKVxuICAgIH1cblxufVxuXG4iLCIvLyBjb250cm9sczogJ3RsJywgJ3RyJywgJ2JyJywgJ2JsJywgJ21sJywgJ210JywgJ21yJywgJ21iJywgJ210cidcbmV4cG9ydCBjb25zdCBDb25zdGFudHMgPSB7XG4gICAgUkVDVF9ESVNBQkxFRF9DT05UUk9MUzogWyAndGwnLCAndHInLCAnYmwnLCAnYnInLCAnbXQnLCAnbWInIF1cbn1cbiIsImltcG9ydCB7QXJyb3dsaW5lfSBmcm9tICcuL2Fycm93bGluZS5qcyc7XG5pbXBvcnQge0NhbnZhc30gZnJvbSAnLi9jYW52YXMuanMnO1xuaW1wb3J0IHtMaW5lfSBmcm9tICcuL2xpbmUuanMnO1xuaW1wb3J0IHtDb25zdGFudHN9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmV4cG9ydCB7QXJyb3dsaW5lLCBDYW52YXMsIExpbmUsIENvbnN0YW50c307XG4iLCJpbXBvcnQge2ZhYnJpY30gZnJvbSAnZmFicmljJ1xuaW1wb3J0IHtMaW5lfSBmcm9tICcuL2xpbmUnXG5cbi8qKlxuICogQW4gQXJyb3dsaW5lIGlzIGEgZ3JvdXAgdGhhdCBsb29rcyBsaWtlIGEgZG91YmxlIGFycm93ZWQgbGluZTpcbiAqICAgICAgIDwtLS0tLS0tPlxuICovXG5leHBvcnQgY2xhc3MgQXJyb3dsaW5lIGV4dGVuZHMgTGluZSB7XG5cbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKG9wdGlvbnMpXG4gICAgICAgIHRoaXMudHlwZSA9ICdhcnJvd2xpbmUnXG4gICAgICAgIHRoaXMuYm9keUZpbGwgPSBvcHRpb25zLmZpbGxcbiAgICB9XG5cbiAgICBfaW5pdENvbXBvbmVudHMoKSB7XG4gICAgICAgIHRoaXMudGV4dCA9IG5ldyBmYWJyaWMuVGV4dCgnJywge2JhY2tncm91bmRDb2xvcjogJ3doaXRlJ30pXG4gICAgICAgIHRoaXMuYm9keSA9IG5ldyBmYWJyaWMuUmVjdCh7ZmlsbDogdGhpcy5ib2R5RmlsbH0pXG4gICAgICAgIHRoaXMubGVmdFRyaWFuZ2xlID0gbmV3IGZhYnJpYy5UcmlhbmdsZSh7ZmlsbDogdGhpcy5ib2R5RmlsbH0pXG4gICAgICAgIHRoaXMucmlnaHRUcmlhbmdsZSA9IG5ldyBmYWJyaWMuVHJpYW5nbGUoe2ZpbGw6IHRoaXMuYm9keUZpbGx9KVxuXG4gICAgICAgIHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbigpXG5cbiAgICAgICAgdGhpcy5jb21wb25lbnRzID0gW3RoaXMuYm9keSwgdGhpcy5sZWZ0VHJpYW5nbGUsIHRoaXMucmlnaHRUcmlhbmdsZSwgdGhpcy50ZXh0XVxuXG4gICAgICAgIHRoaXMuY29tcG9uZW50cy5mb3JFYWNoKChjb21wb25lbnQpID0+IHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5oYXNDb250cm9scyA9IGZhbHNlXG4gICAgICAgICAgICBjb21wb25lbnQuc2VsZWN0YWJsZSA9IGZhbHNlXG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5hZGQoY29tcG9uZW50KVxuICAgICAgICAgICAgY29tcG9uZW50LnNlbmRCYWNrd2FyZHMoKVxuICAgICAgICB9KVxuICAgICAgICB0aGlzLnNldFRleHQodGhpcy5ib2R5VGV4dClcbiAgICB9XG5cbiAgICBfc2V0Q29tcG9uZW50c1Bvc2l0aW9uKCkge1xuICAgICAgICBjb25zdCBkZWdyZWVzVG9SYWRpYW5zUmF0aW8gPSBNYXRoLlBJIC8gMTgwLFxuICAgICAgICAgICAgaGVpZ2h0ID0gdGhpcy5oZWlnaHQgKiB0aGlzLnNjYWxlWSxcbiAgICAgICAgICAgIHdpZHRoID0gdGhpcy53aWR0aCAqIHRoaXMuc2NhbGVYLFxuICAgICAgICAgICAgY29zVGV0YSA9IE1hdGguY29zKHRoaXMuYW5nbGUgKiBkZWdyZWVzVG9SYWRpYW5zUmF0aW8pLFxuICAgICAgICAgICAgc2luVGV0YSA9IE1hdGguc2luKHRoaXMuYW5nbGUgKiBkZWdyZWVzVG9SYWRpYW5zUmF0aW8pLFxuICAgICAgICAgICAgYm91bmRpbmdSZWN0ID0gdGhpcy5nZXRCb3VuZGluZ1JlY3QoKVxuXG4gICAgICAgIHRoaXMudGV4dC5zZXQoe1xuICAgICAgICAgICAgdG9wOiBib3VuZGluZ1JlY3QudG9wICsgMC41ICogKGJvdW5kaW5nUmVjdC5oZWlnaHQgLSB0aGlzLnRleHQuaGVpZ2h0KSxcbiAgICAgICAgICAgIGxlZnQ6IGJvdW5kaW5nUmVjdC5sZWZ0ICsgMC41ICogKGJvdW5kaW5nUmVjdC53aWR0aCAtIHRoaXMudGV4dC53aWR0aCksXG4gICAgICAgICAgICBmb250U2l6ZTogMThcbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLmJvZHkuc2V0KHtcbiAgICAgICAgICAgIHRvcDogdGhpcy50b3AgKyBoZWlnaHQgKiBzaW5UZXRhICsgKGhlaWdodCAvIDQpICogY29zVGV0YSxcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMubGVmdCArIGhlaWdodCAqIGNvc1RldGEgLSAoaGVpZ2h0IC8gNCkgKiBzaW5UZXRhLFxuICAgICAgICAgICAgd2lkdGg6IHdpZHRoIC0gMiAqIGhlaWdodCxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0IC8gMixcbiAgICAgICAgICAgIGFuZ2xlOiB0aGlzLmFuZ2xlXG4gICAgICAgIH0pXG5cbiAgICAgICAgdGhpcy5sZWZ0VHJpYW5nbGUuc2V0KHtcbiAgICAgICAgICAgIHRvcDogdGhpcy50b3AgKyBoZWlnaHQgKiBjb3NUZXRhLFxuICAgICAgICAgICAgbGVmdDogdGhpcy5sZWZ0IC0gaGVpZ2h0ICogc2luVGV0YSxcbiAgICAgICAgICAgIHdpZHRoOiBoZWlnaHQsXG4gICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgIGFuZ2xlOiB0aGlzLmFuZ2xlIC0gOTBcbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLnJpZ2h0VHJpYW5nbGUuc2V0KHtcbiAgICAgICAgICAgIHRvcDogdGhpcy50b3AgKyB3aWR0aCAqIHNpblRldGEsXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLmxlZnQgKyB3aWR0aCAqIGNvc1RldGEsXG4gICAgICAgICAgICB3aWR0aDogaGVpZ2h0LFxuICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgICBhbmdsZTogdGhpcy5hbmdsZSArIDkwXG4gICAgICAgIH0pXG4gICAgfVxuXG59XG4iLCJpbXBvcnQge2ZhYnJpY30gZnJvbSAnZmFicmljJ1xuaW1wb3J0IHtDb25zdGFudHN9IGZyb20gJy4vY29uc3RhbnRzJ1xuaW1wb3J0IHtMaW5lfSBmcm9tICcuL2xpbmUnXG5cbmV4cG9ydCBjbGFzcyBDYW52YXMgZXh0ZW5kcyBmYWJyaWMuQ2FudmFzIHtcblxuICAgIGNvbnN0cnVjdG9yKGRvbUVsZW1lbmRJZCkge1xuICAgICAgICBzdXBlcihkb21FbGVtZW5kSWQpXG4gICAgICAgIHRoaXMuZG9tRWxlbWVuZElkID0gZG9tRWxlbWVuZElkXG4gICAgICAgIHRoaXMuc2NhbGUgPSB7dmFsdWU6IG51bGwsIHNoYXBlOiBudWxsfVxuICAgICAgICB0aGlzLmJhY2tncm91bmRJbWFnZSA9IG51bGxcbiAgICAgICAgLy8gdGhpcy5fbG9ja09iamVjdHNUb0JvdW5kYXJpZXMoKVxuICAgIH1cblxuICAgIGFkZEltYWdlKGltYWdlRmlsZSkge1xuICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpXG5cbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpXG5cbiAgICAgICAgICAgIGltZy5zcmMgPSByZWFkZXIucmVzdWx0XG5cbiAgICAgICAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlID0gbmV3IGZhYnJpYy5JbWFnZShpbWcpXG4gICAgICAgICAgICB0aGlzLmJhY2tncm91bmRJbWFnZS5zY2FsZSh0aGlzLmhlaWdodCAvIHRoaXMuYmFja2dyb3VuZEltYWdlLmhlaWdodClcbiAgICAgICAgICAgIHRoaXMuYWRkKHRoaXMuYmFja2dyb3VuZEltYWdlKVxuICAgICAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2Uuc2VuZFRvQmFjaygpXG4gICAgICAgICAgICB0aGlzLnJlbmRlckFsbCgpXG4gICAgICAgIH07XG5cbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoaW1hZ2VGaWxlKTtcbiAgICB9XG5cbiAgICBsb2NrSW1hZ2UoKSB7XG4gICAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLmhhc0NvbnRyb2xzID0gZmFsc2VcbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2Uuc2VsZWN0YWJsZSA9IGZhbHNlXG4gICAgICAgIHRoaXMuZGlzY2FyZEFjdGl2ZU9iamVjdCgpO1xuICAgICAgICB0aGlzLnJlbmRlckFsbCgpXG4gICAgfVxuXG4gICAgX2xvY2tPYmplY3RzVG9Cb3VuZGFyaWVzKCkge1xuICAgICAgICB0aGlzLm9uKCdvYmplY3Q6bW92aW5nJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHZhciBvYmogPSBlLnRhcmdldDtcblxuICAgICAgICAgICAgLy8gaWYgb2JqZWN0IGlzIHRvbyBiaWcgaWdub3JlXG4gICAgICAgICAgICBpZiAob2JqLmN1cnJlbnRIZWlnaHQgPiB0aGlzLmhlaWdodCB8fCBvYmouY3VycmVudFdpZHRoID4gdGhpcy53aWR0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9iai5zZXRDb29yZHMoKTtcbiAgICAgICAgICAgIC8vIHRvcC1sZWZ0ICBjb3JuZXJcbiAgICAgICAgICAgIGlmIChvYmouZ2V0Qm91bmRpbmdSZWN0KCkudG9wIDwgMCB8fCBvYmouZ2V0Qm91bmRpbmdSZWN0KCkubGVmdCA8IDApIHtcbiAgICAgICAgICAgICAgICBvYmoudG9wID0gTWF0aC5tYXgob2JqLnRvcCwgb2JqLnRvcCAtIG9iai5nZXRCb3VuZGluZ1JlY3QoKS50b3ApO1xuICAgICAgICAgICAgICAgIG9iai5sZWZ0ID0gTWF0aC5tYXgob2JqLmxlZnQsIG9iai5sZWZ0IC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLmxlZnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gYm90LXJpZ2h0IGNvcm5lclxuICAgICAgICAgICAgaWYgKG9iai5nZXRCb3VuZGluZ1JlY3QoKS50b3AgKyBvYmouZ2V0Qm91bmRpbmdSZWN0KCkuaGVpZ2h0ID4gdGhpcy5oZWlnaHQgfHxcbiAgICAgICAgICAgICAgICAgICAgb2JqLmdldEJvdW5kaW5nUmVjdCgpLmxlZnQgKyBvYmouZ2V0Qm91bmRpbmdSZWN0KCkud2lkdGggPiB0aGlzLndpZHRoKSB7XG4gICAgICAgICAgICAgICAgb2JqLnRvcCA9IE1hdGgubWluKG9iai50b3AsIHRoaXMuaGVpZ2h0IC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLmhlaWdodCArXG4gICAgICAgICAgICAgICAgICAgIG9iai50b3AgLSBvYmouZ2V0Qm91bmRpbmdSZWN0KCkudG9wKTtcbiAgICAgICAgICAgICAgICBvYmoubGVmdCA9IE1hdGgubWluKG9iai5sZWZ0LCB0aGlzLndpZHRoIC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLndpZHRoICtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmxlZnQgLSBvYmouZ2V0Qm91bmRpbmdSZWN0KCkubGVmdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHNldFNjYWxlKHNjYWxlRGVmaW5pdGlvbikge1xuICAgICAgICBpZiAoc2NhbGVEZWZpbml0aW9uLnNoYXBlKSB7XG4gICAgICAgICAgICB0aGlzLnNjYWxlLnNoYXBlID0gc2NhbGVEZWZpbml0aW9uLnNoYXBlXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNjYWxlRGVmaW5pdGlvbi52YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zY2FsZS52YWx1ZSA9IHNjYWxlRGVmaW5pdGlvbi52YWx1ZVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0U2NhbGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNjYWxlXG4gICAgfVxuXG4gICAgbG9ja1NjYWxlKCkge1xuICAgICAgICB0aGlzLnNjYWxlLnNoYXBlLmhhc0NvbnRyb2xzID0gZmFsc2VcbiAgICB9XG5cbiAgICAvKlxuICAgICAqIEBwYXJhbSBjaG9pY2VzOiBhIGxpc3Qgb2YgKGxhYmVsLCBjb2xvcilcbiAgICAgKiAgZXhhbXBsZTogW1xuICAgICAqICAgICAge2xhYmVsOiAnbGFiZWwxJywgY29sb3I6ICdibHVlJ30sXG4gICAgICogICAgICB7bGFiZWw6ICdsYWJlbDInLCBjb2xvcjogJ3JnYmEoMjU1LDAsMCwwLjUpJ31cbiAgICAgKiAgIF1cbiAgICAgKiBAcmV0dXJuIGEgRE9NIHNlbGVjdCBvYmplY3Qgd2l0aCBjb3JyZXNwb25kaW5nIG9wdGlvbnNcbiAgICAgKi9cbiAgICBsaXN0VG9TZWxlY3RET00oY2hvaWNlcykge1xuICAgICAgICBjb25zdCBjYW52YXNob2xkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmRvbUVsZW1lbmRJZClcblxuICAgICAgICAvLyBDcmVhdGUgYW5kIGFwcGVuZCBzZWxlY3QgbGlzdFxuICAgICAgICBjb25zdCBzZWxlY3RMaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VsZWN0JylcblxuICAgICAgICBzZWxlY3RMaXN0LmlkID0gJ2ZhYnJpY2FzaGFwZVNoYXBlQ2hvaWNlcydcbiAgICAgICAgY2FudmFzaG9sZGVyLnBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoc2VsZWN0TGlzdClcblxuICAgICAgICAvLyBDcmVhdGUgYW5kIGFwcGVuZCB0aGUgb3B0aW9uc1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNob2ljZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpXG5cbiAgICAgICAgICAgIG9wdGlvbi52YWx1ZSA9IGNob2ljZXNbaV0ubGFiZWxcbiAgICAgICAgICAgIG9wdGlvbi50ZXh0ID0gY2hvaWNlc1tpXS5sYWJlbFxuICAgICAgICAgICAgb3B0aW9uLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNob2ljZXNbaV0uY29sb3JcbiAgICAgICAgICAgIHNlbGVjdExpc3QuYXBwZW5kQ2hpbGQob3B0aW9uKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZWxlY3RMaXN0XG4gICAgfVxuXG4gICAgc2V0U2hhcGVDaG9pY2VzKGNob2ljZXMpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0T2JqZWN0ID0gdGhpcy5saXN0VG9TZWxlY3RET00oY2hvaWNlcylcblxuICAgICAgICB0aGlzLmNyZWF0ZVJlZmVyZW5jZUxpbmUoc2VsZWN0T2JqZWN0KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBsaW5lIHVzZXIgY2FuIGNsaWNrIG9uIHRvIGR1cGxpY2F0ZSBpdCBhbmQgdXNlIHRoZSBkdXBsaWNhdGUgaW50byB0aGUgc2NlbmUuXG4gICAgICovXG4gICAgY3JlYXRlUmVmZXJlbmNlTGluZShzZWxlY3RPYmplY3QpIHtcbiAgICAgICAgY29uc3QgcmVmZXJlbmNlTGluZSA9IG5ldyBmYWJyaWMuUmVjdCh7XG4gICAgICAgICAgICB0b3A6IDUsIGxlZnQ6IDUsIHdpZHRoOiA4MCwgaGVpZ2h0OiAxNyxcbiAgICAgICAgICAgIGZpbGw6IHNlbGVjdE9iamVjdC5vcHRpb25zW3NlbGVjdE9iamVjdC5zZWxlY3RlZEluZGV4XS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3JcbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLmFkZChyZWZlcmVuY2VMaW5lKVxuICAgICAgICB0aGlzLml0ZW0odGhpcy5zaXplKCkgLSAxKS5oYXNDb250cm9scyA9IGZhbHNlXG4gICAgICAgIHRoaXMucmVxdWVzdFJlbmRlckFsbCgpXG5cbiAgICAgICAgY29uc3QgZmlsbFJlZmVyZW5jZUxpbmUgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzXG4gICAgICAgICAgICAgICAgLml0ZW0odGhpcy5zaXplKCkgLSAxKVxuICAgICAgICAgICAgICAgIC5zZXQoJ2ZpbGwnLCBzZWxlY3RPYmplY3Qub3B0aW9uc1tzZWxlY3RPYmplY3Quc2VsZWN0ZWRJbmRleF0uc3R5bGUuYmFja2dyb3VuZENvbG9yKVxuICAgICAgICAgICAgdGhpcy5yZW5kZXJBbGwoKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZHVwbGljYXRlUmVmZXJlbmNlTGluZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlUmVmZXJlbmNlTGluZShzZWxlY3RPYmplY3QpXG4gICAgICAgICAgICByZWZlcmVuY2VMaW5lLmhhc0NvbnRyb2xzID0gdHJ1ZVxuICAgICAgICAgICAgQ29uc3RhbnRzLlJFQ1RfRElTQUJMRURfQ09OVFJPTFMuZm9yRWFjaCgoY29udHJvbCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlZmVyZW5jZUxpbmUuc2V0Q29udHJvbFZpc2libGUoY29udHJvbCwgZmFsc2UpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgcmVmZXJlbmNlTGluZS5vbignbW91c2Vkb3duJywgKCkgPT4ge1xuICAgICAgICAgICAgZHVwbGljYXRlUmVmZXJlbmNlTGluZSgpXG4gICAgICAgICAgICByZWZlcmVuY2VMaW5lLm9mZignbW91c2Vkb3duJylcbiAgICAgICAgfSlcblxuICAgICAgICBzZWxlY3RPYmplY3QucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZmlsbFJlZmVyZW5jZUxpbmUpXG4gICAgICAgIHNlbGVjdE9iamVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmaWxsUmVmZXJlbmNlTGluZSlcbiAgICB9XG5cbiAgICBjcmVhdGVTY2FsZWRMaW5lKG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3Qgc2NhbGUgPSAodGhpcy5zY2FsZS5zaGFwZS53aWR0aCAqIHRoaXMuc2NhbGUuc2hhcGUuc2NhbGVYKSAvIHRoaXMuc2NhbGUudmFsdWVcblxuICAgICAgICBvcHRpb25zLnRvcCA9IG9wdGlvbnMudG9wICogc2NhbGVcbiAgICAgICAgb3B0aW9ucy5sZWZ0ID0gb3B0aW9ucy5sZWZ0ICogc2NhbGVcbiAgICAgICAgb3B0aW9ucy53aWR0aCA9IG9wdGlvbnMud2lkdGggKiBzY2FsZVxuICAgICAgICBvcHRpb25zLmhlaWdodCA9IG9wdGlvbnMuc3Ryb2tlICogc2NhbGVcblxuICAgICAgICByZXR1cm4gbmV3IExpbmUob3B0aW9ucylcbiAgICB9XG5cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=