!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("fabric")):"function"==typeof define&&define.amd?define("fabricashape",["fabric"],e):"object"==typeof exports?exports.fabricashape=e(require("fabric")):t.fabricashape=e(t.fabric)}("undefined"!=typeof self?self:this,function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(e,n){e.exports=t},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Line=void 0;var i=n(0),o=n(2),r=i.fabric.util.createClass(i.fabric.Rect,{type:"line",components:[],hasControls:!0,initialize:function(t){var e=this;t||(t={}),this.callSuper("initialize",t),this.bodyFill=t.fill||"",t.hasOwnProperty("bodyFill")&&(this.bodyFill=t.bodyFill),this.bodyText=t.text||"",t.hasOwnProperty("bodyText")&&(this.bodyText=t.bodyText),o.Constants.RECT_DISABLED_CONTROLS.forEach(function(t){e.setControlVisible(t,!1)}),this.set("fill","transparent"),this.on({added:this._initComponents,modified:this._setComponentsPosition,scaling:this._setComponentsPosition,moving:this._setComponentsPosition,rotating:this._setComponentsPosition})},_initComponents:function(){this.text=new i.fabric.Text("",{visible:!1}),this.body=new i.fabric.Rect({width:this.width,height:this.height,top:this.top,left:this.left,fill:this.bodyFill}),this.components=[this.text,this.body],this._setupComponents(),this.setText(this.bodyText)},_setupComponents:function(){var t=this;this.components.forEach(function(e){e.set({excludeFromExport:!0,hasControls:!1,selectable:!1}),t.canvas.add(e),e.sendBackwards()})},_setComponentsPosition:function(){var t=this.height*this.scaleY,e=this.width*this.scaleX,n=this.getBoundingRect();this.text&&this.text.set({top:n.top+.5*(n.height-this.text.height),left:n.left+.5*(n.width-this.text.width)}),this.body.set({top:this.top,left:this.left,width:e,height:t,angle:this.angle})},getComponents:function(){return this.components},setText:function(t){this.bodyText=t,"m"!==t.slice(-1)&&(t+="m"),this.text.set({text:t}),this._setComponentsPosition()},_render:function(t){this.callSuper("_render",t)},clear:function(){this.canvas.remove(this.components)},toObject:function(){return i.fabric.util.object.extend(this.callSuper("toObject"),{bodyFill:this.get("bodyFill"),bodyText:this.get("bodyText")})}});e.Line=r,i.fabric.Line=r,i.fabric.Line.fromObject=function(t,e){return i.fabric.Object._fromObject("Line",t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Constants=void 0;e.Constants={RECT_DISABLED_CONTROLS:["tl","tr","bl","br","mt","mb"]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Arrowline",{enumerable:!0,get:function(){return i.Arrowline}}),Object.defineProperty(e,"Canvas",{enumerable:!0,get:function(){return o.Canvas}}),Object.defineProperty(e,"Line",{enumerable:!0,get:function(){return r.Line}}),Object.defineProperty(e,"Constants",{enumerable:!0,get:function(){return s.Constants}});var i=n(4),o=n(5),r=n(1),s=n(2)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Arrowline=void 0;var i=n(0),o=n(1),r=i.fabric.util.createClass(o.Line,{type:"arrowline",_initComponents:function(){this.text=new i.fabric.Text(this.bodyText,{backgroundColor:"white"}),this.body=new i.fabric.Rect({fill:this.bodyFill}),this.leftTriangle=new i.fabric.Triangle({fill:this.bodyFill}),this.rightTriangle=new i.fabric.Triangle({fill:this.bodyFill}),this._setComponentsPosition(),this.components=[this.body,this.leftTriangle,this.rightTriangle,this.text],this._setupComponents(),this.setText(this.bodyText)},_setComponentsPosition:function(){var t=Math.PI/180,e=this.height*this.scaleY,n=this.width*this.scaleX,i=Math.cos(this.angle*t),o=Math.sin(this.angle*t),r=this.getBoundingRect();this.text.set({top:r.top+.5*(r.height-this.text.height),left:r.left+.5*(r.width-this.text.width),fontSize:18}),this.body.set({top:this.top+e*o+e/4*i,left:this.left+e*i-e/4*o,width:n-2*e,height:e/2,angle:this.angle}),this.leftTriangle.set({top:this.top+e*i,left:this.left-e*o,width:e,height:e,angle:this.angle-90}),this.rightTriangle.set({top:this.top+n*o,left:this.left+n*i,width:e,height:e,angle:this.angle+90})}});e.Arrowline=r,i.fabric.Arrowline=r,i.fabric.Arrowline.fromObject=function(t,e){return i.fabric.Object._fromObject("Arrowline",t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Canvas=void 0;var i=n(0),o=n(2),r=n(1);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var h=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))).domElemendId=t,n.scale={value:null,shape:null},n.customBackgroundImage=null,n}var n,s,h;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,i.fabric.Canvas),n=e,(s=[{key:"addImage",value:function(t){var e=this,n=new FileReader;n.onload=function(){var t=document.createElement("img");t.src=n.result,e.customBackgroundImage=new i.fabric.Image(t),e.customBackgroundImage.scale(e.height/e.customBackgroundImage.height),e.add(e.customBackgroundImage),e.renderAll()},n.readAsDataURL(t)}},{key:"lockImage",value:function(){this.customBackgroundImage.sendToBack(),this.customBackgroundImage.hasControls=!1,this.customBackgroundImage.selectable=!1,this.discardActiveObject(),this.renderAll()}},{key:"_lockObjectsToBoundaries",value:function(){this.on("object:moving",function(t){var e=t.target;e.currentHeight>this.height||e.currentWidth>this.width||(e.setCoords(),(e.getBoundingRect().top<0||e.getBoundingRect().left<0)&&(e.top=Math.max(e.top,e.top-e.getBoundingRect().top),e.left=Math.max(e.left,e.left-e.getBoundingRect().left)),(e.getBoundingRect().top+e.getBoundingRect().height>this.height||e.getBoundingRect().left+e.getBoundingRect().width>this.width)&&(e.top=Math.min(e.top,this.height-e.getBoundingRect().height+e.top-e.getBoundingRect().top),e.left=Math.min(e.left,this.width-e.getBoundingRect().width+e.left-e.getBoundingRect().left)))})}},{key:"setScale",value:function(t){t.shape&&(this.scale.shape=t.shape,this.scale.shape.hasControls=!1),t.value&&(this.scale.value=t.value)}},{key:"getScale",value:function(){return this.scale}},{key:"lockScale",value:function(){this.scale.shape.hasControls=!1}},{key:"remove",value:function(t){console.log("biche"),Array.isArray(t)?t.forEach(function(t){t.hasOwnProperty("clear")&&t.clear()}):t.hasOwnProperty("clear")&&t.clear(),this.callSuper("remove",t)}},{key:"clearScale",value:function(){}},{key:"listToSelectDOM",value:function(t){var e=document.getElementById(this.domElemendId),n=document.createElement("select");n.id="fabricashapeShapeChoices",e.parentElement.appendChild(n);for(var i=0;i<t.length;i++){var o=document.createElement("option");o.value=t[i].label,o.text=t[i].label,o.style.backgroundColor=t[i].color,n.appendChild(o)}return n}},{key:"setShapeChoices",value:function(t){var e=this.listToSelectDOM(t);this.createReferenceLine(e)}},{key:"createReferenceLine",value:function(t){var e=this,n=new i.fabric.Rect({top:5,left:5,width:80,height:17,fill:t.options[t.selectedIndex].style.backgroundColor});this.add(n),this.item(this.size()-1).hasControls=!1,this.requestRenderAll();var r=function(){e.item(e.size()-1).set("fill",t.options[t.selectedIndex].style.backgroundColor),e.renderAll()};n.on("mousedown",function(){e.createReferenceLine(t),n.hasControls=!0,o.Constants.RECT_DISABLED_CONTROLS.forEach(function(t){n.setControlVisible(t,!1)}),n.off("mousedown")}),t.removeEventListener("change",r),t.addEventListener("change",r)}},{key:"createScaledLine",value:function(t){var e=this.scale.shape.width*this.scale.shape.scaleX/this.scale.value;return t.top=t.top*e,t.left=t.left*e,t.width=t.width*e,t.height=t.stroke*e,new r.Line(t)}}])&&a(n.prototype,s),h&&a(n,h),e}();e.Canvas=h}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvZXh0ZXJuYWwgXCJmYWJyaWNcIiIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvbGluZS5qcyIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvYXJyb3dsaW5lLmpzIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS8uL3NyYy9jYW52YXMuanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIl9mYWJyaWMiLCJfY29uc3RhbnRzIiwiTGluZSIsImZhYnJpYyIsInV0aWwiLCJjcmVhdGVDbGFzcyIsIlJlY3QiLCJ0eXBlIiwiY29tcG9uZW50cyIsImhhc0NvbnRyb2xzIiwiaW5pdGlhbGl6ZSIsIm9wdGlvbnMiLCJfdGhpcyIsImNhbGxTdXBlciIsImJvZHlGaWxsIiwiZmlsbCIsImJvZHlUZXh0IiwidGV4dCIsIkNvbnN0YW50cyIsIlJFQ1RfRElTQUJMRURfQ09OVFJPTFMiLCJmb3JFYWNoIiwiY29udHJvbCIsInNldENvbnRyb2xWaXNpYmxlIiwic2V0Iiwib24iLCJhZGRlZCIsIl9pbml0Q29tcG9uZW50cyIsIm1vZGlmaWVkIiwiX3NldENvbXBvbmVudHNQb3NpdGlvbiIsInNjYWxpbmciLCJtb3ZpbmciLCJyb3RhdGluZyIsIlRleHQiLCJ2aXNpYmxlIiwiYm9keSIsIndpZHRoIiwiaGVpZ2h0IiwidG9wIiwibGVmdCIsIl9zZXR1cENvbXBvbmVudHMiLCJzZXRUZXh0IiwiX3RoaXMyIiwiY29tcG9uZW50IiwiZXhjbHVkZUZyb21FeHBvcnQiLCJzZWxlY3RhYmxlIiwiY2FudmFzIiwiYWRkIiwic2VuZEJhY2t3YXJkcyIsInNjYWxlWSIsInNjYWxlWCIsImJvdW5kaW5nUmVjdCIsImdldEJvdW5kaW5nUmVjdCIsImFuZ2xlIiwiZ2V0Q29tcG9uZW50cyIsInNsaWNlIiwiX3JlbmRlciIsImN0eCIsImNsZWFyIiwicmVtb3ZlIiwidG9PYmplY3QiLCJleHRlbmQiLCJmcm9tT2JqZWN0IiwiY2FsbGJhY2siLCJfZnJvbU9iamVjdCIsIl9hcnJvd2xpbmUiLCJfY2FudmFzIiwiX2xpbmUiLCJBcnJvd2xpbmUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJsZWZ0VHJpYW5nbGUiLCJUcmlhbmdsZSIsInJpZ2h0VHJpYW5nbGUiLCJkZWdyZWVzVG9SYWRpYW5zUmF0aW8iLCJNYXRoIiwiUEkiLCJjb3NUZXRhIiwiY29zIiwic2luVGV0YSIsInNpbiIsImZvbnRTaXplIiwiQ2FudmFzIiwiZG9tRWxlbWVuZElkIiwiX2NsYXNzQ2FsbENoZWNrIiwiX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iLCJfX3Byb3RvX18iLCJnZXRQcm90b3R5cGVPZiIsInNjYWxlIiwic2hhcGUiLCJjdXN0b21CYWNrZ3JvdW5kSW1hZ2UiLCJpbWFnZUZpbGUiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkIiwiaW1nIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwic3JjIiwicmVzdWx0IiwiSW1hZ2UiLCJyZW5kZXJBbGwiLCJyZWFkQXNEYXRhVVJMIiwic2VuZFRvQmFjayIsImRpc2NhcmRBY3RpdmVPYmplY3QiLCJlIiwib2JqIiwidGFyZ2V0IiwiY3VycmVudEhlaWdodCIsImN1cnJlbnRXaWR0aCIsInNldENvb3JkcyIsIm1heCIsIm1pbiIsInNjYWxlRGVmaW5pdGlvbiIsIm9iamVjdHMiLCJjb25zb2xlIiwibG9nIiwiQXJyYXkiLCJpc0FycmF5IiwiY2hvaWNlcyIsImNhbnZhc2hvbGRlciIsImdldEVsZW1lbnRCeUlkIiwic2VsZWN0TGlzdCIsImlkIiwicGFyZW50RWxlbWVudCIsImFwcGVuZENoaWxkIiwibGVuZ3RoIiwib3B0aW9uIiwibGFiZWwiLCJzdHlsZSIsImNvbG9yIiwic2VsZWN0T2JqZWN0IiwibGlzdFRvU2VsZWN0RE9NIiwiY3JlYXRlUmVmZXJlbmNlTGluZSIsIl90aGlzMyIsInJlZmVyZW5jZUxpbmUiLCJzZWxlY3RlZEluZGV4IiwiaXRlbSIsInNpemUiLCJyZXF1ZXN0UmVuZGVyQWxsIiwiZmlsbFJlZmVyZW5jZUxpbmUiLCJvZmYiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsInN0cm9rZSJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQSxpQkFBQUMsU0FBQSxpQkFBQUMsT0FDQUEsT0FBQUQsUUFBQUQsRUFBQUcsUUFBQSxXQUNBLG1CQUFBQyxlQUFBQyxJQUNBRCxPQUFBLDBCQUFBSixHQUNBLGlCQUFBQyxRQUNBQSxRQUFBLGFBQUFELEVBQUFHLFFBQUEsV0FFQUosRUFBQSxhQUFBQyxFQUFBRCxFQUFBLFFBUkEsQ0FTQyxvQkFBQU8sVUFBQUMsS0FBQSxTQUFBQyxHQUNELG1CQ1RBLElBQUFDLEVBQUEs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eEVnRSxFQUFLakMsYUFXVGtDLEVBQWM3RyxHQUFHLFlBQWEsV0FQMUI0RyxFQUFLRCxvQkFBb0JGLEdBQ3pCSSxFQUFjNUgsYUFBYyxFQUM1QlIsRUFBQWlCLFVBQVVDLHVCQUF1QkMsUUFBUSxTQUFDQyxHQUN0Q2dILEVBQWMvRyxrQkFBa0JELEdBQVMsS0FNN0NnSCxFQUFjTSxJQUFJLGVBR3RCVixFQUFhVyxvQkFBb0IsU0FBVUYsR0FDM0NULEVBQWFZLGlCQUFpQixTQUFVSCw0Q0FHM0IvSCxHQUNiLElBQU0yRSxFQUFTM0gsS0FBSzJILE1BQU1DLE1BQU1wRCxNQUFReEUsS0FBSzJILE1BQU1DLE1BQU10QyxPQUFVdEYsS0FBSzJILE1BQU1yRyxNQU85RSxPQUxBMEIsRUFBUTBCLElBQU0xQixFQUFRMEIsSUFBTWlELEVBQzVCM0UsRUFBUTJCLEtBQU8zQixFQUFRMkIsS0FBT2dELEVBQzlCM0UsRUFBUXdCLE1BQVF4QixFQUFRd0IsTUFBUW1ELEVBQ2hDM0UsRUFBUXlCLE9BQVN6QixFQUFRbUksT0FBU3hELEVBRTNCLElBQUFwQixFQUFBaEUsS0FBU1MiLCJmaWxlIjoiZmFicmljYXNoYXBlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZShcImZhYnJpY1wiKSk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShcImZhYnJpY2FzaGFwZVwiLCBbXCJmYWJyaWNcIl0sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiZmFicmljYXNoYXBlXCJdID0gZmFjdG9yeShyZXF1aXJlKFwiZmFicmljXCIpKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJmYWJyaWNhc2hhcGVcIl0gPSBmYWN0b3J5KHJvb3RbXCJmYWJyaWNcIl0pO1xufSkodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHRoaXMsIGZ1bmN0aW9uKF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzBfXykge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAzKTtcbiIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fOyIsImltcG9ydCB7ZmFicmljfSBmcm9tICdmYWJyaWMnXG5pbXBvcnQge0NvbnN0YW50c30gZnJvbSAnLi9jb25zdGFudHMnXG5cbmV4cG9ydCBjb25zdCBMaW5lID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLlJlY3QsIHtcblxuICAgIHR5cGU6ICdsaW5lJyxcbiAgICBjb21wb25lbnRzOiBbXSxcbiAgICBoYXNDb250cm9sczogdHJ1ZSxcblxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7IH0pO1xuICAgICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMuYm9keUZpbGwgPSBvcHRpb25zLmZpbGwgfHwgJydcbiAgICAgICAgaWYgKG9wdGlvbnMuaGFzT3duUHJvcGVydHkoJ2JvZHlGaWxsJykpIHtcbiAgICAgICAgICAgIHRoaXMuYm9keUZpbGwgPSBvcHRpb25zLmJvZHlGaWxsXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ib2R5VGV4dCA9IG9wdGlvbnMudGV4dCB8fCAnJ1xuICAgICAgICBpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgnYm9keVRleHQnKSkge1xuICAgICAgICAgICAgdGhpcy5ib2R5VGV4dCA9IG9wdGlvbnMuYm9keVRleHRcbiAgICAgICAgfVxuICAgICAgICBDb25zdGFudHMuUkVDVF9ESVNBQkxFRF9DT05UUk9MUy5mb3JFYWNoKChjb250cm9sKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldENvbnRyb2xWaXNpYmxlKGNvbnRyb2wsIGZhbHNlKVxuICAgICAgICB9KVxuICAgICAgICB0aGlzLnNldCgnZmlsbCcsICd0cmFuc3BhcmVudCcpXG5cbiAgICAgICAgdGhpcy5vbihcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAnYWRkZWQnOiB0aGlzLl9pbml0Q29tcG9uZW50cyxcbiAgICAgICAgICAgICAgICAnbW9kaWZpZWQnOiB0aGlzLl9zZXRDb21wb25lbnRzUG9zaXRpb24sXG4gICAgICAgICAgICAgICAgJ3NjYWxpbmcnOiB0aGlzLl9zZXRDb21wb25lbnRzUG9zaXRpb24sXG4gICAgICAgICAgICAgICAgJ21vdmluZyc6IHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbixcbiAgICAgICAgICAgICAgICAncm90YXRpbmcnOiB0aGlzLl9zZXRDb21wb25lbnRzUG9zaXRpb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgIH0sXG5cbiAgICBfaW5pdENvbXBvbmVudHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy50ZXh0ID0gbmV3IGZhYnJpYy5UZXh0KCcnLCB7dmlzaWJsZTogZmFsc2V9KVxuICAgICAgICB0aGlzLmJvZHkgPSBuZXcgZmFicmljLlJlY3Qoe1xuICAgICAgICAgICAgd2lkdGg6IHRoaXMud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0LFxuICAgICAgICAgICAgdG9wOiB0aGlzLnRvcCxcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMubGVmdCxcbiAgICAgICAgICAgIGZpbGw6IHRoaXMuYm9keUZpbGxcbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5jb21wb25lbnRzID0gW3RoaXMudGV4dCwgdGhpcy5ib2R5XVxuXG4gICAgICAgIHRoaXMuX3NldHVwQ29tcG9uZW50cygpXG4gICAgICAgIHRoaXMuc2V0VGV4dCh0aGlzLmJvZHlUZXh0KVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBfc2V0dXBDb21wb25lbnRzOiBhZGQgdGhlIGNvbXBvbmVudCB0byB0aGUgY2FudmFzIGFuZCBzZXQgc29tZSBvcHRpb25zXG4gICAgICogdG8gYXZvaWQgdGhlbSBmcm9tIGJlaW5nIGV4cG9ydGVkL3NlbGVjdGVkXG4gICAgICovXG4gICAgX3NldHVwQ29tcG9uZW50czogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmNvbXBvbmVudHMuZm9yRWFjaCgoY29tcG9uZW50KSA9PiB7XG4gICAgICAgICAgICBjb21wb25lbnQuc2V0KHtcbiAgICAgICAgICAgICAgICBleGNsdWRlRnJvbUV4cG9ydDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBoYXNDb250cm9sczogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2VsZWN0YWJsZTogZmFsc2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5hZGQoY29tcG9uZW50KVxuICAgICAgICAgICAgY29tcG9uZW50LnNlbmRCYWNrd2FyZHMoKVxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICBfc2V0Q29tcG9uZW50c1Bvc2l0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuaGVpZ2h0ICogdGhpcy5zY2FsZVksXG4gICAgICAgICAgICB3aWR0aCA9IHRoaXMud2lkdGggKiB0aGlzLnNjYWxlWCxcbiAgICAgICAgICAgIGJvdW5kaW5nUmVjdCA9IHRoaXMuZ2V0Qm91bmRpbmdSZWN0KClcblxuICAgICAgICBpZiAodGhpcy50ZXh0KSB7XG4gICAgICAgICAgICB0aGlzLnRleHQuc2V0KHtcbiAgICAgICAgICAgICAgICB0b3A6IGJvdW5kaW5nUmVjdC50b3AgKyAwLjUgKiAoYm91bmRpbmdSZWN0LmhlaWdodCAtIHRoaXMudGV4dC5oZWlnaHQpLFxuICAgICAgICAgICAgICAgIGxlZnQ6IGJvdW5kaW5nUmVjdC5sZWZ0ICsgMC41ICogKGJvdW5kaW5nUmVjdC53aWR0aCAtIHRoaXMudGV4dC53aWR0aClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmJvZHkuc2V0KHtcbiAgICAgICAgICAgIHRvcDogdGhpcy50b3AsXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLmxlZnQsXG4gICAgICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgIGFuZ2xlOiB0aGlzLmFuZ2xlXG4gICAgICAgIH0pXG5cbiAgICB9LFxuXG4gICAgZ2V0Q29tcG9uZW50czogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21wb25lbnRzXG4gICAgfSxcblxuICAgIHNldFRleHQ6IGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgIHRoaXMuYm9keVRleHQgPSB0ZXh0XG4gICAgICAgIGlmICh0ZXh0LnNsaWNlKC0xKSAhPT0gJ20nKSB7XG4gICAgICAgICAgICB0ZXh0ICs9ICdtJ1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudGV4dC5zZXQoe1xuICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICB9KVxuICAgICAgICB0aGlzLl9zZXRDb21wb25lbnRzUG9zaXRpb24oKVxuICAgIH0sXG5cbiAgICBfcmVuZGVyOiBmdW5jdGlvbiAoY3R4KSB7XG4gICAgICAgIHRoaXMuY2FsbFN1cGVyKCdfcmVuZGVyJywgY3R4KVxuICAgIH0sXG5cbiAgICBjbGVhcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcy5jb21wb25lbnRzKVxuICAgIH0sXG5cbiAgICB0b09iamVjdDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLmNhbGxTdXBlcigndG9PYmplY3QnKSwge1xuICAgICAgICAgICAgYm9keUZpbGw6IHRoaXMuZ2V0KCdib2R5RmlsbCcpLFxuICAgICAgICAgICAgYm9keVRleHQ6IHRoaXMuZ2V0KCdib2R5VGV4dCcpXG4gICAgICAgIH0pO1xuICAgIH1cblxufSlcblxuZmFicmljLkxpbmUgPSBMaW5lXG5cbmZhYnJpYy5MaW5lLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0LCBjYWxsYmFjaykge1xuICAgIHJldHVybiBmYWJyaWMuT2JqZWN0Ll9mcm9tT2JqZWN0KCdMaW5lJywgb2JqZWN0LCBjYWxsYmFjayk7XG59O1xuIiwiLy8gY29udHJvbHM6ICd0bCcsICd0cicsICdicicsICdibCcsICdtbCcsICdtdCcsICdtcicsICdtYicsICdtdHInXG5leHBvcnQgY29uc3QgQ29uc3RhbnRzID0ge1xuICAgIFJFQ1RfRElTQUJMRURfQ09OVFJPTFM6IFsgJ3RsJywgJ3RyJywgJ2JsJywgJ2JyJywgJ210JywgJ21iJyBdXG59XG4iLCJpbXBvcnQge0Fycm93bGluZX0gZnJvbSAnLi9hcnJvd2xpbmUuanMnO1xuaW1wb3J0IHtDYW52YXN9IGZyb20gJy4vY2FudmFzLmpzJztcbmltcG9ydCB7TGluZX0gZnJvbSAnLi9saW5lLmpzJztcbmltcG9ydCB7Q29uc3RhbnRzfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5leHBvcnQge0Fycm93bGluZSwgQ2FudmFzLCBMaW5lLCBDb25zdGFudHN9O1xuIiwiaW1wb3J0IHtmYWJyaWN9IGZyb20gJ2ZhYnJpYydcbmltcG9ydCB7TGluZX0gZnJvbSAnLi9saW5lJ1xuXG4vKipcbiAqIEFuIEFycm93bGluZSBpcyBhIGdyb3VwIHRoYXQgbG9va3MgbGlrZSBhIGRvdWJsZSBhcnJvd2VkIGxpbmU6XG4gKiAgICAgICA8LS0tLS0tLT5cbiAqL1xuZXhwb3J0IGNvbnN0IEFycm93bGluZSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKExpbmUsIHtcblxuICAgIHR5cGU6ICdhcnJvd2xpbmUnLFxuXG4gICAgX2luaXRDb21wb25lbnRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudGV4dCA9IG5ldyBmYWJyaWMuVGV4dCh0aGlzLmJvZHlUZXh0LCB7YmFja2dyb3VuZENvbG9yOiAnd2hpdGUnfSlcbiAgICAgICAgdGhpcy5ib2R5ID0gbmV3IGZhYnJpYy5SZWN0KHtmaWxsOiB0aGlzLmJvZHlGaWxsfSlcbiAgICAgICAgdGhpcy5sZWZ0VHJpYW5nbGUgPSBuZXcgZmFicmljLlRyaWFuZ2xlKHtmaWxsOiB0aGlzLmJvZHlGaWxsfSlcbiAgICAgICAgdGhpcy5yaWdodFRyaWFuZ2xlID0gbmV3IGZhYnJpYy5UcmlhbmdsZSh7ZmlsbDogdGhpcy5ib2R5RmlsbH0pXG5cbiAgICAgICAgdGhpcy5fc2V0Q29tcG9uZW50c1Bvc2l0aW9uKClcblxuICAgICAgICB0aGlzLmNvbXBvbmVudHMgPSBbdGhpcy5ib2R5LCB0aGlzLmxlZnRUcmlhbmdsZSwgdGhpcy5yaWdodFRyaWFuZ2xlLCB0aGlzLnRleHRdXG5cbiAgICAgICAgdGhpcy5fc2V0dXBDb21wb25lbnRzKClcbiAgICAgICAgdGhpcy5zZXRUZXh0KHRoaXMuYm9keVRleHQpXG4gICAgfSxcblxuICAgIF9zZXRDb21wb25lbnRzUG9zaXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgZGVncmVlc1RvUmFkaWFuc1JhdGlvID0gTWF0aC5QSSAvIDE4MCxcbiAgICAgICAgICAgIGhlaWdodCA9IHRoaXMuaGVpZ2h0ICogdGhpcy5zY2FsZVksXG4gICAgICAgICAgICB3aWR0aCA9IHRoaXMud2lkdGggKiB0aGlzLnNjYWxlWCxcbiAgICAgICAgICAgIGNvc1RldGEgPSBNYXRoLmNvcyh0aGlzLmFuZ2xlICogZGVncmVlc1RvUmFkaWFuc1JhdGlvKSxcbiAgICAgICAgICAgIHNpblRldGEgPSBNYXRoLnNpbih0aGlzLmFuZ2xlICogZGVncmVlc1RvUmFkaWFuc1JhdGlvKSxcbiAgICAgICAgICAgIGJvdW5kaW5nUmVjdCA9IHRoaXMuZ2V0Qm91bmRpbmdSZWN0KClcblxuICAgICAgICB0aGlzLnRleHQuc2V0KHtcbiAgICAgICAgICAgIHRvcDogYm91bmRpbmdSZWN0LnRvcCArIDAuNSAqIChib3VuZGluZ1JlY3QuaGVpZ2h0IC0gdGhpcy50ZXh0LmhlaWdodCksXG4gICAgICAgICAgICBsZWZ0OiBib3VuZGluZ1JlY3QubGVmdCArIDAuNSAqIChib3VuZGluZ1JlY3Qud2lkdGggLSB0aGlzLnRleHQud2lkdGgpLFxuICAgICAgICAgICAgZm9udFNpemU6IDE4XG4gICAgICAgIH0pXG5cbiAgICAgICAgdGhpcy5ib2R5LnNldCh7XG4gICAgICAgICAgICB0b3A6IHRoaXMudG9wICsgaGVpZ2h0ICogc2luVGV0YSArIChoZWlnaHQgLyA0KSAqIGNvc1RldGEsXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLmxlZnQgKyBoZWlnaHQgKiBjb3NUZXRhIC0gKGhlaWdodCAvIDQpICogc2luVGV0YSxcbiAgICAgICAgICAgIHdpZHRoOiB3aWR0aCAtIDIgKiBoZWlnaHQsXG4gICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCAvIDIsXG4gICAgICAgICAgICBhbmdsZTogdGhpcy5hbmdsZVxuICAgICAgICB9KVxuXG4gICAgICAgIHRoaXMubGVmdFRyaWFuZ2xlLnNldCh7XG4gICAgICAgICAgICB0b3A6IHRoaXMudG9wICsgaGVpZ2h0ICogY29zVGV0YSxcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMubGVmdCAtIGhlaWdodCAqIHNpblRldGEsXG4gICAgICAgICAgICB3aWR0aDogaGVpZ2h0LFxuICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgICBhbmdsZTogdGhpcy5hbmdsZSAtIDkwXG4gICAgICAgIH0pXG5cbiAgICAgICAgdGhpcy5yaWdodFRyaWFuZ2xlLnNldCh7XG4gICAgICAgICAgICB0b3A6IHRoaXMudG9wICsgd2lkdGggKiBzaW5UZXRhLFxuICAgICAgICAgICAgbGVmdDogdGhpcy5sZWZ0ICsgd2lkdGggKiBjb3NUZXRhLFxuICAgICAgICAgICAgd2lkdGg6IGhlaWdodCxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICAgICAgYW5nbGU6IHRoaXMuYW5nbGUgKyA5MFxuICAgICAgICB9KVxuICAgIH1cblxufSlcblxuZmFicmljLkFycm93bGluZSA9IEFycm93bGluZVxuXG5mYWJyaWMuQXJyb3dsaW5lLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0LCBjYWxsYmFjaykge1xuICAgIHJldHVybiBmYWJyaWMuT2JqZWN0Ll9mcm9tT2JqZWN0KCdBcnJvd2xpbmUnLCBvYmplY3QsIGNhbGxiYWNrKTtcbn07XG4iLCJpbXBvcnQge2ZhYnJpY30gZnJvbSAnZmFicmljJ1xuaW1wb3J0IHtDb25zdGFudHN9IGZyb20gJy4vY29uc3RhbnRzJ1xuaW1wb3J0IHtMaW5lfSBmcm9tICcuL2xpbmUnXG5cbmV4cG9ydCBjbGFzcyBDYW52YXMgZXh0ZW5kcyBmYWJyaWMuQ2FudmFzIHtcblxuICAgIGNvbnN0cnVjdG9yKGRvbUVsZW1lbmRJZCkge1xuICAgICAgICBzdXBlcihkb21FbGVtZW5kSWQpXG4gICAgICAgIHRoaXMuZG9tRWxlbWVuZElkID0gZG9tRWxlbWVuZElkXG4gICAgICAgIHRoaXMuc2NhbGUgPSB7dmFsdWU6IG51bGwsIHNoYXBlOiBudWxsfVxuICAgICAgICB0aGlzLmN1c3RvbUJhY2tncm91bmRJbWFnZSA9IG51bGxcbiAgICAgICAgLy8gdGhpcy5fbG9ja09iamVjdHNUb0JvdW5kYXJpZXMoKVxuICAgIH1cblxuICAgIGFkZEltYWdlKGltYWdlRmlsZSkge1xuICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpXG5cbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpXG5cbiAgICAgICAgICAgIGltZy5zcmMgPSByZWFkZXIucmVzdWx0XG5cbiAgICAgICAgICAgIHRoaXMuY3VzdG9tQmFja2dyb3VuZEltYWdlID0gbmV3IGZhYnJpYy5JbWFnZShpbWcpXG4gICAgICAgICAgICB0aGlzLmN1c3RvbUJhY2tncm91bmRJbWFnZS5zY2FsZSh0aGlzLmhlaWdodCAvIHRoaXMuY3VzdG9tQmFja2dyb3VuZEltYWdlLmhlaWdodClcbiAgICAgICAgICAgIHRoaXMuYWRkKHRoaXMuY3VzdG9tQmFja2dyb3VuZEltYWdlKVxuICAgICAgICAgICAgdGhpcy5yZW5kZXJBbGwoKVxuICAgICAgICB9O1xuXG4gICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGltYWdlRmlsZSk7XG4gICAgfVxuXG4gICAgbG9ja0ltYWdlKCkge1xuICAgICAgICB0aGlzLmN1c3RvbUJhY2tncm91bmRJbWFnZS5zZW5kVG9CYWNrKClcbiAgICAgICAgdGhpcy5jdXN0b21CYWNrZ3JvdW5kSW1hZ2UuaGFzQ29udHJvbHMgPSBmYWxzZVxuICAgICAgICB0aGlzLmN1c3RvbUJhY2tncm91bmRJbWFnZS5zZWxlY3RhYmxlID0gZmFsc2VcbiAgICAgICAgdGhpcy5kaXNjYXJkQWN0aXZlT2JqZWN0KCk7XG4gICAgICAgIHRoaXMucmVuZGVyQWxsKClcbiAgICB9XG5cbiAgICBfbG9ja09iamVjdHNUb0JvdW5kYXJpZXMoKSB7XG4gICAgICAgIHRoaXMub24oJ29iamVjdDptb3ZpbmcnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgdmFyIG9iaiA9IGUudGFyZ2V0O1xuXG4gICAgICAgICAgICAvLyBpZiBvYmplY3QgaXMgdG9vIGJpZyBpZ25vcmVcbiAgICAgICAgICAgIGlmIChvYmouY3VycmVudEhlaWdodCA+IHRoaXMuaGVpZ2h0IHx8IG9iai5jdXJyZW50V2lkdGggPiB0aGlzLndpZHRoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb2JqLnNldENvb3JkcygpO1xuICAgICAgICAgICAgLy8gdG9wLWxlZnQgIGNvcm5lclxuICAgICAgICAgICAgaWYgKG9iai5nZXRCb3VuZGluZ1JlY3QoKS50b3AgPCAwIHx8IG9iai5nZXRCb3VuZGluZ1JlY3QoKS5sZWZ0IDwgMCkge1xuICAgICAgICAgICAgICAgIG9iai50b3AgPSBNYXRoLm1heChvYmoudG9wLCBvYmoudG9wIC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLnRvcCk7XG4gICAgICAgICAgICAgICAgb2JqLmxlZnQgPSBNYXRoLm1heChvYmoubGVmdCwgb2JqLmxlZnQgLSBvYmouZ2V0Qm91bmRpbmdSZWN0KCkubGVmdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBib3QtcmlnaHQgY29ybmVyXG4gICAgICAgICAgICBpZiAob2JqLmdldEJvdW5kaW5nUmVjdCgpLnRvcCArIG9iai5nZXRCb3VuZGluZ1JlY3QoKS5oZWlnaHQgPiB0aGlzLmhlaWdodCB8fFxuICAgICAgICAgICAgICAgICAgICBvYmouZ2V0Qm91bmRpbmdSZWN0KCkubGVmdCArIG9iai5nZXRCb3VuZGluZ1JlY3QoKS53aWR0aCA+IHRoaXMud2lkdGgpIHtcbiAgICAgICAgICAgICAgICBvYmoudG9wID0gTWF0aC5taW4ob2JqLnRvcCwgdGhpcy5oZWlnaHQgLSBvYmouZ2V0Qm91bmRpbmdSZWN0KCkuaGVpZ2h0ICtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnRvcCAtIG9iai5nZXRCb3VuZGluZ1JlY3QoKS50b3ApO1xuICAgICAgICAgICAgICAgIG9iai5sZWZ0ID0gTWF0aC5taW4ob2JqLmxlZnQsIHRoaXMud2lkdGggLSBvYmouZ2V0Qm91bmRpbmdSZWN0KCkud2lkdGggK1xuICAgICAgICAgICAgICAgICAgICBvYmoubGVmdCAtIG9iai5nZXRCb3VuZGluZ1JlY3QoKS5sZWZ0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2V0U2NhbGUoc2NhbGVEZWZpbml0aW9uKSB7XG4gICAgICAgIGlmIChzY2FsZURlZmluaXRpb24uc2hhcGUpIHtcbiAgICAgICAgICAgIHRoaXMuc2NhbGUuc2hhcGUgPSBzY2FsZURlZmluaXRpb24uc2hhcGVcbiAgICAgICAgICAgIHRoaXMuc2NhbGUuc2hhcGUuaGFzQ29udHJvbHMgPSBmYWxzZVxuICAgICAgICB9XG4gICAgICAgIGlmIChzY2FsZURlZmluaXRpb24udmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc2NhbGUudmFsdWUgPSBzY2FsZURlZmluaXRpb24udmFsdWVcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldFNjYWxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zY2FsZVxuICAgIH1cblxuICAgIGxvY2tTY2FsZSgpIHtcbiAgICAgICAgdGhpcy5zY2FsZS5zaGFwZS5oYXNDb250cm9scyA9IGZhbHNlXG4gICAgfVxuXG4gICAgcmVtb3ZlKG9iamVjdHMpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2JpY2hlJylcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkob2JqZWN0cykpIHtcbiAgICAgICAgICAgIG9iamVjdHMuZm9yRWFjaCgob2JqZWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG9iamVjdC5oYXNPd25Qcm9wZXJ0eSgnY2xlYXInKSkge1xuICAgICAgICAgICAgICAgICAgICBvYmplY3QuY2xlYXIoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAob2JqZWN0cy5oYXNPd25Qcm9wZXJ0eSgnY2xlYXInKSkge1xuICAgICAgICAgICAgICAgIG9iamVjdHMuY2xlYXIoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2FsbFN1cGVyKCdyZW1vdmUnLCBvYmplY3RzKVxuICAgIH1cblxuICAgIGNsZWFyU2NhbGUoKSB7XG4gICAgfVxuXG4gICAgLypcbiAgICAgKiBAcGFyYW0gY2hvaWNlczogYSBsaXN0IG9mIChsYWJlbCwgY29sb3IpXG4gICAgICogIGV4YW1wbGU6IFtcbiAgICAgKiAgICAgIHtsYWJlbDogJ2xhYmVsMScsIGNvbG9yOiAnYmx1ZSd9LFxuICAgICAqICAgICAge2xhYmVsOiAnbGFiZWwyJywgY29sb3I6ICdyZ2JhKDI1NSwwLDAsMC41KSd9XG4gICAgICogICBdXG4gICAgICogQHJldHVybiBhIERPTSBzZWxlY3Qgb2JqZWN0IHdpdGggY29ycmVzcG9uZGluZyBvcHRpb25zXG4gICAgICovXG4gICAgbGlzdFRvU2VsZWN0RE9NKGNob2ljZXMpIHtcbiAgICAgICAgY29uc3QgY2FudmFzaG9sZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5kb21FbGVtZW5kSWQpXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFuZCBhcHBlbmQgc2VsZWN0IGxpc3RcbiAgICAgICAgY29uc3Qgc2VsZWN0TGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpXG5cbiAgICAgICAgc2VsZWN0TGlzdC5pZCA9ICdmYWJyaWNhc2hhcGVTaGFwZUNob2ljZXMnXG4gICAgICAgIGNhbnZhc2hvbGRlci5wYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKHNlbGVjdExpc3QpXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFuZCBhcHBlbmQgdGhlIG9wdGlvbnNcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaG9pY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKVxuXG4gICAgICAgICAgICBvcHRpb24udmFsdWUgPSBjaG9pY2VzW2ldLmxhYmVsXG4gICAgICAgICAgICBvcHRpb24udGV4dCA9IGNob2ljZXNbaV0ubGFiZWxcbiAgICAgICAgICAgIG9wdGlvbi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjaG9pY2VzW2ldLmNvbG9yXG4gICAgICAgICAgICBzZWxlY3RMaXN0LmFwcGVuZENoaWxkKG9wdGlvbilcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2VsZWN0TGlzdFxuICAgIH1cblxuICAgIHNldFNoYXBlQ2hvaWNlcyhjaG9pY2VzKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdE9iamVjdCA9IHRoaXMubGlzdFRvU2VsZWN0RE9NKGNob2ljZXMpXG5cbiAgICAgICAgdGhpcy5jcmVhdGVSZWZlcmVuY2VMaW5lKHNlbGVjdE9iamVjdClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbGluZSB1c2VyIGNhbiBjbGljayBvbiB0byBkdXBsaWNhdGUgaXQgYW5kIHVzZSB0aGUgZHVwbGljYXRlIGludG8gdGhlIHNjZW5lLlxuICAgICAqL1xuICAgIGNyZWF0ZVJlZmVyZW5jZUxpbmUoc2VsZWN0T2JqZWN0KSB7XG4gICAgICAgIGNvbnN0IHJlZmVyZW5jZUxpbmUgPSBuZXcgZmFicmljLlJlY3Qoe1xuICAgICAgICAgICAgdG9wOiA1LCBsZWZ0OiA1LCB3aWR0aDogODAsIGhlaWdodDogMTcsXG4gICAgICAgICAgICBmaWxsOiBzZWxlY3RPYmplY3Qub3B0aW9uc1tzZWxlY3RPYmplY3Quc2VsZWN0ZWRJbmRleF0uc3R5bGUuYmFja2dyb3VuZENvbG9yXG4gICAgICAgIH0pXG5cbiAgICAgICAgdGhpcy5hZGQocmVmZXJlbmNlTGluZSlcbiAgICAgICAgdGhpcy5pdGVtKHRoaXMuc2l6ZSgpIC0gMSkuaGFzQ29udHJvbHMgPSBmYWxzZVxuICAgICAgICB0aGlzLnJlcXVlc3RSZW5kZXJBbGwoKVxuXG4gICAgICAgIGNvbnN0IGZpbGxSZWZlcmVuY2VMaW5lID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpc1xuICAgICAgICAgICAgICAgIC5pdGVtKHRoaXMuc2l6ZSgpIC0gMSlcbiAgICAgICAgICAgICAgICAuc2V0KCdmaWxsJywgc2VsZWN0T2JqZWN0Lm9wdGlvbnNbc2VsZWN0T2JqZWN0LnNlbGVjdGVkSW5kZXhdLnN0eWxlLmJhY2tncm91bmRDb2xvcilcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQWxsKClcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGR1cGxpY2F0ZVJlZmVyZW5jZUxpbmUgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVJlZmVyZW5jZUxpbmUoc2VsZWN0T2JqZWN0KVxuICAgICAgICAgICAgcmVmZXJlbmNlTGluZS5oYXNDb250cm9scyA9IHRydWVcbiAgICAgICAgICAgIENvbnN0YW50cy5SRUNUX0RJU0FCTEVEX0NPTlRST0xTLmZvckVhY2goKGNvbnRyb2wpID0+IHtcbiAgICAgICAgICAgICAgICByZWZlcmVuY2VMaW5lLnNldENvbnRyb2xWaXNpYmxlKGNvbnRyb2wsIGZhbHNlKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIHJlZmVyZW5jZUxpbmUub24oJ21vdXNlZG93bicsICgpID0+IHtcbiAgICAgICAgICAgIGR1cGxpY2F0ZVJlZmVyZW5jZUxpbmUoKVxuICAgICAgICAgICAgcmVmZXJlbmNlTGluZS5vZmYoJ21vdXNlZG93bicpXG4gICAgICAgIH0pXG5cbiAgICAgICAgc2VsZWN0T2JqZWN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZpbGxSZWZlcmVuY2VMaW5lKVxuICAgICAgICBzZWxlY3RPYmplY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZmlsbFJlZmVyZW5jZUxpbmUpXG4gICAgfVxuXG4gICAgY3JlYXRlU2NhbGVkTGluZShvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHNjYWxlID0gKHRoaXMuc2NhbGUuc2hhcGUud2lkdGggKiB0aGlzLnNjYWxlLnNoYXBlLnNjYWxlWCkgLyB0aGlzLnNjYWxlLnZhbHVlXG5cbiAgICAgICAgb3B0aW9ucy50b3AgPSBvcHRpb25zLnRvcCAqIHNjYWxlXG4gICAgICAgIG9wdGlvbnMubGVmdCA9IG9wdGlvbnMubGVmdCAqIHNjYWxlXG4gICAgICAgIG9wdGlvbnMud2lkdGggPSBvcHRpb25zLndpZHRoICogc2NhbGVcbiAgICAgICAgb3B0aW9ucy5oZWlnaHQgPSBvcHRpb25zLnN0cm9rZSAqIHNjYWxlXG5cbiAgICAgICAgcmV0dXJuIG5ldyBMaW5lKG9wdGlvbnMpXG4gICAgfVxuXG59XG4iXSwic291cmNlUm9vdCI6IiJ9