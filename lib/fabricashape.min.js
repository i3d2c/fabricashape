!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("fabric")):"function"==typeof define&&define.amd?define("fabricashape",["fabric"],e):"object"==typeof exports?exports.fabricashape=e(require("fabric")):t.fabricashape=e(t.fabric)}("undefined"!=typeof self?self:this,function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(e,n){e.exports=t},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Line=void 0;var i=n(0),o=n(2),s=i.fabric.util.createClass(i.fabric.Rect,{type:"line",components:[],hasControls:!0,initialize:function(t){var e=this;t||(t={}),this.callSuper("initialize",t),this.bodyFill=t.fill||"",t.hasOwnProperty("bodyFill")&&(this.bodyFill=t.bodyFill),this.bodyText=t.text||"",t.hasOwnProperty("bodyText")&&(this.bodyText=t.bodyText),o.Constants.RECT_DISABLED_CONTROLS.forEach(function(t){e.setControlVisible(t,!1)}),this.set("fill","transparent"),this.on({added:this._initComponents,modified:this._setComponentsPosition,scaling:this._setComponentsPosition,moving:this._setComponentsPosition,rotating:this._setComponentsPosition})},_initComponents:function(){this.text=new i.fabric.Text("",{visible:!1}),this.body=new i.fabric.Rect({width:this.width,height:this.height,top:this.top,left:this.left,fill:this.bodyFill}),this.components=[this.text,this.body],this._setupComponents(),this.setText(this.bodyText)},_setupComponents:function(){var t=this;this.components.forEach(function(e){e.set({excludeFromExport:!0,hasControls:!1,selectable:!1}),t.canvas.add(e),e.sendBackwards()})},_setComponentsPosition:function(){var t=this.height*this.scaleY,e=this.width*this.scaleX,n=this.getBoundingRect();this.text&&this.text.set({top:n.top+.5*(n.height-this.text.height),left:n.left+.5*(n.width-this.text.width)}),this.body.set({top:this.top,left:this.left,width:e,height:t,angle:this.angle})},getComponents:function(){return this.components},setText:function(t){this.bodyText=t,"m"!==t.slice(-1)&&(t+="m"),this.text.set({text:t}),this._setComponentsPosition()},_render:function(t){this.callSuper("_render",t)},clear:function(){this.canvas.remove(this.components)},toObject:function(){return i.fabric.util.object.extend(this.callSuper("toObject"),{bodyFill:this.get("bodyFill"),bodyText:this.get("bodyText")})}});e.Line=s,i.fabric.Line=s,i.fabric.Line.fromObject=function(t,e){return i.fabric.Object._fromObject("Line",t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Constants=void 0;e.Constants={RECT_DISABLED_CONTROLS:["tl","tr","bl","br","mt","mb"]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Arrowline",{enumerable:!0,get:function(){return i.Arrowline}}),Object.defineProperty(e,"Canvas",{enumerable:!0,get:function(){return o.Canvas}}),Object.defineProperty(e,"Line",{enumerable:!0,get:function(){return s.Line}}),Object.defineProperty(e,"Constants",{enumerable:!0,get:function(){return r.Constants}});var i=n(4),o=n(5),s=n(1),r=n(2)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Arrowline=void 0;var i=n(0),o=n(1),s=i.fabric.util.createClass(o.Line,{type:"arrowline",_initComponents:function(){this.text=new i.fabric.Text(this.bodyText,{backgroundColor:"white"}),this.body=new i.fabric.Rect({fill:this.bodyFill}),this.leftTriangle=new i.fabric.Triangle({fill:this.bodyFill}),this.rightTriangle=new i.fabric.Triangle({fill:this.bodyFill}),this._setComponentsPosition(),this.components=[this.body,this.leftTriangle,this.rightTriangle,this.text],this._setupComponents(),this.setText(this.bodyText)},_setComponentsPosition:function(){var t=Math.PI/180,e=this.height*this.scaleY,n=this.width*this.scaleX,i=Math.cos(this.angle*t),o=Math.sin(this.angle*t),s=this.getBoundingRect();this.text.set({top:s.top+.5*(s.height-this.text.height),left:s.left+.5*(s.width-this.text.width),fontSize:18}),this.body.set({top:this.top+e*o+e/4*i,left:this.left+e*i-e/4*o,width:n-2*e,height:e/2,angle:this.angle}),this.leftTriangle.set({top:this.top+e*i,left:this.left-e*o,width:e,height:e,angle:this.angle-90}),this.rightTriangle.set({top:this.top+n*o,left:this.left+n*i,width:e,height:e,angle:this.angle+90})}});e.Arrowline=s,i.fabric.Arrowline=s,i.fabric.Arrowline.fromObject=function(t,e){return i.fabric.Object._fromObject("Arrowline",t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Canvas=void 0;var i=n(0),o=n(2),s=n(1);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var h=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))).domElemendId=t,n.scale={value:null,shape:null},n.customBackgroundImage=null,n}var n,r,h;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,i.fabric.Canvas),n=e,(r=[{key:"addImage",value:function(t){var e=this,n=new FileReader;n.onload=function(){var t=document.createElement("img");t.src=n.result,e.customBackgroundImage=new i.fabric.Image(t),e.customBackgroundImage.scale(e.height/e.customBackgroundImage.height),e.add(e.customBackgroundImage),e.renderAll()},n.readAsDataURL(t)}},{key:"lockImage",value:function(){this.customBackgroundImage.sendToBack(),this.customBackgroundImage.hasControls=!1,this.customBackgroundImage.selectable=!1,this.discardActiveObject(),this.renderAll()}},{key:"_lockObjectsToBoundaries",value:function(){this.on("object:moving",function(t){var e=t.target;e.currentHeight>this.height||e.currentWidth>this.width||(e.setCoords(),(e.getBoundingRect().top<0||e.getBoundingRect().left<0)&&(e.top=Math.max(e.top,e.top-e.getBoundingRect().top),e.left=Math.max(e.left,e.left-e.getBoundingRect().left)),(e.getBoundingRect().top+e.getBoundingRect().height>this.height||e.getBoundingRect().left+e.getBoundingRect().width>this.width)&&(e.top=Math.min(e.top,this.height-e.getBoundingRect().height+e.top-e.getBoundingRect().top),e.left=Math.min(e.left,this.width-e.getBoundingRect().width+e.left-e.getBoundingRect().left)))})}},{key:"setScale",value:function(t){t.shape&&(this.scale.shape=t.shape,this.scale.shape.hasControls=!1),t.value&&(this.scale.value=t.value)}},{key:"getScale",value:function(){return this.scale}},{key:"lockScale",value:function(){this.scale.shape.hasControls=!1}},{key:"clearScale",value:function(){this.scale.shape&&(console.log("clearScale"),console.log(this.scale.shape),this.clear(),this.remove(this.scale.shape),this.remove(this.scale.shape),this.renderAll())}},{key:"listToSelectDOM",value:function(t){var e=document.getElementById(this.domElemendId),n=document.createElement("select");n.id="fabricashapeShapeChoices",e.parentElement.appendChild(n);for(var i=0;i<t.length;i++){var o=document.createElement("option");o.value=t[i].label,o.text=t[i].label,o.style.backgroundColor=t[i].color,n.appendChild(o)}return n}},{key:"setShapeChoices",value:function(t){var e=this.listToSelectDOM(t);this.createReferenceLine(e)}},{key:"createReferenceLine",value:function(t){var e=this,n=new i.fabric.Rect({top:5,left:5,width:80,height:17,fill:t.options[t.selectedIndex].style.backgroundColor});this.add(n),this.item(this.size()-1).hasControls=!1,this.requestRenderAll();var s=function(){e.item(e.size()-1).set("fill",t.options[t.selectedIndex].style.backgroundColor),e.renderAll()};n.on("mousedown",function(){e.createReferenceLine(t),n.hasControls=!0,o.Constants.RECT_DISABLED_CONTROLS.forEach(function(t){n.setControlVisible(t,!1)}),n.off("mousedown")}),t.removeEventListener("change",s),t.addEventListener("change",s)}},{key:"createScaledLine",value:function(t){var e=this.scale.shape.width*this.scale.shape.scaleX/this.scale.value;return t.top=t.top*e,t.left=t.left*e,t.width=t.width*e,t.height=t.stroke*e,new s.Line(t)}}])&&a(n.prototype,r),h&&a(n,h),e}();e.Canvas=h}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvZXh0ZXJuYWwgXCJmYWJyaWNcIiIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvbGluZS5qcyIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvYXJyb3dsaW5lLmpzIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS8uL3NyYy9jYW52YXMuanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIl9mYWJyaWMiLCJfY29uc3RhbnRzIiwiTGluZSIsImZhYnJpYyIsInV0aWwiLCJjcmVhdGVDbGFzcyIsIlJlY3QiLCJ0eXBlIiwiY29tcG9uZW50cyIsImhhc0NvbnRyb2xzIiwiaW5pdGlhbGl6ZSIsIm9wdGlvbnMiLCJfdGhpcyIsImNhbGxTdXBlciIsImJvZHlGaWxsIiwiZmlsbCIsImJvZHlUZXh0IiwidGV4dCIsIkNvbnN0YW50cyIsIlJFQ1RfRElTQUJMRURfQ09OVFJPTFMiLCJmb3JFYWNoIiwiY29udHJvbCIsInNldENvbnRyb2xWaXNpYmxlIiwic2V0Iiwib24iLCJhZGRlZCIsIl9pbml0Q29tcG9uZW50cyIsIm1vZGlmaWVkIiwiX3NldENvbXBvbmVudHNQb3NpdGlvbiIsInNjYWxpbmciLCJtb3ZpbmciLCJyb3RhdGluZyIsIlRleHQiLCJ2aXNpYmxlIiwiYm9keSIsIndpZHRoIiwiaGVpZ2h0IiwidG9wIiwibGVmdCIsIl9zZXR1cENvbXBvbmVudHMiLCJzZXRUZXh0IiwiX3RoaXMyIiwiY29tcG9uZW50IiwiZXhjbHVkZUZyb21FeHBvcnQiLCJzZWxlY3RhYmxlIiwiY2FudmFzIiwiYWRkIiwic2VuZEJhY2t3YXJkcyIsInNjYWxlWSIsInNjYWxlWCIsImJvdW5kaW5nUmVjdCIsImdldEJvdW5kaW5nUmVjdCIsImFuZ2xlIiwiZ2V0Q29tcG9uZW50cyIsInNsaWNlIiwiX3JlbmRlciIsImN0eCIsImNsZWFyIiwicmVtb3ZlIiwidG9PYmplY3QiLCJleHRlbmQiLCJmcm9tT2JqZWN0IiwiY2FsbGJhY2siLCJfZnJvbU9iamVjdCIsIl9hcnJvd2xpbmUiLCJfY2FudmFzIiwiX2xpbmUiLCJBcnJvd2xpbmUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJsZWZ0VHJpYW5nbGUiLCJUcmlhbmdsZSIsInJpZ2h0VHJpYW5nbGUiLCJkZWdyZWVzVG9SYWRpYW5zUmF0aW8iLCJNYXRoIiwiUEkiLCJjb3NUZXRhIiwiY29zIiwic2luVGV0YSIsInNpbiIsImZvbnRTaXplIiwiQ2FudmFzIiwiZG9tRWxlbWVuZElkIiwiX2NsYXNzQ2FsbENoZWNrIiwiX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iLCJfX3Byb3RvX18iLCJnZXRQcm90b3R5cGVPZiIsInNjYWxlIiwic2hhcGUiLCJjdXN0b21CYWNrZ3JvdW5kSW1hZ2UiLCJpbWFnZUZpbGUiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkIiwiaW1nIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwic3JjIiwicmVzdWx0IiwiSW1hZ2UiLCJyZW5kZXJBbGwiLCJyZWFkQXNEYXRhVVJMIiwic2VuZFRvQmFjayIsImRpc2NhcmRBY3RpdmVPYmplY3QiLCJlIiwib2JqIiwidGFyZ2V0IiwiY3VycmVudEhlaWdodCIsImN1cnJlbnRXaWR0aCIsInNldENvb3JkcyIsIm1heCIsIm1pbiIsInNjYWxlRGVmaW5pdGlvbiIsImNvbnNvbGUiLCJsb2ciLCJjaG9pY2VzIiwiY2FudmFzaG9sZGVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJzZWxlY3RMaXN0IiwiaWQiLCJwYXJlbnRFbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJsZW5ndGgiLCJvcHRpb24iLCJsYWJlbCIsInN0eWxlIiwiY29sb3IiLCJzZWxlY3RPYmplY3QiLCJsaXN0VG9TZWxlY3RET00iLCJjcmVhdGVSZWZlcmVuY2VMaW5lIiwiX3RoaXMzIiwicmVmZXJlbmNlTGluZSIsInNlbGVjdGVkSW5kZXgiLCJpdGVtIiwic2l6ZSIsInJlcXVlc3RSZW5kZXJBbGwiLCJmaWxsUmVmZXJlbmNlTGluZSIsIm9mZiIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwic3Ryb2tlIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxHQUNBLGlCQUFBQyxTQUFBLGlCQUFBQyxPQUNBQSxPQUFBRCxRQUFBRCxFQUFBRyxRQUFBLFdBQ0EsbUJBQUFDLGVBQUFDLElBQ0FELE9BQUEsMEJBQUFKLEdBQ0EsaUJBQUFDLFFBQ0FBLFFBQUEsYUFBQUQsRUFBQUcsUUFBQSxXQUVBSixFQUFBLGFBQUFDLEVBQUFELEVBQUEsUUFSQSxDQVNDLG9CQUFBTyxVQUFBQyxLQUFBLFNBQUFDLEdBQ0QsbUJDVEEsSUFBQUMsRUFBQSxHQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYs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LEVBQWMxRyxHQUFHLFlBQWEsV0FQMUJ5RyxFQUFLRCxvQkFBb0JGLEdBQ3pCSSxFQUFjekgsYUFBYyxFQUM1QlIsRUFBQWlCLFVBQVVDLHVCQUF1QkMsUUFBUSxTQUFDQyxHQUN0QzZHLEVBQWM1RyxrQkFBa0JELEdBQVMsS0FNN0M2RyxFQUFjTSxJQUFJLGVBR3RCVixFQUFhVyxvQkFBb0IsU0FBVUYsR0FDM0NULEVBQWFZLGlCQUFpQixTQUFVSCw0Q0FHM0I1SCxHQUNiLElBQU0yRSxFQUFTM0gsS0FBSzJILE1BQU1DLE1BQU1wRCxNQUFReEUsS0FBSzJILE1BQU1DLE1BQU10QyxPQUFVdEYsS0FBSzJILE1BQU1yRyxNQU85RSxPQUxBMEIsRUFBUTBCLElBQU0xQixFQUFRMEIsSUFBTWlELEVBQzVCM0UsRUFBUTJCLEtBQU8zQixFQUFRMkIsS0FBT2dELEVBQzlCM0UsRUFBUXdCLE1BQVF4QixFQUFRd0IsTUFBUW1ELEVBQ2hDM0UsRUFBUXlCLE9BQVN6QixFQUFRZ0ksT0FBU3JELEVBRTNCLElBQUFwQixFQUFBaEUsS0FBU1MiLCJmaWxlIjoiZmFicmljYXNoYXBlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZShcImZhYnJpY1wiKSk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShcImZhYnJpY2FzaGFwZVwiLCBbXCJmYWJyaWNcIl0sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiZmFicmljYXNoYXBlXCJdID0gZmFjdG9yeShyZXF1aXJlKFwiZmFicmljXCIpKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJmYWJyaWNhc2hhcGVcIl0gPSBmYWN0b3J5KHJvb3RbXCJmYWJyaWNcIl0pO1xufSkodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHRoaXMsIGZ1bmN0aW9uKF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzBfXykge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAzKTtcbiIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fOyIsImltcG9ydCB7ZmFicmljfSBmcm9tICdmYWJyaWMnXG5pbXBvcnQge0NvbnN0YW50c30gZnJvbSAnLi9jb25zdGFudHMnXG5cbmV4cG9ydCBjb25zdCBMaW5lID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLlJlY3QsIHtcblxuICAgIHR5cGU6ICdsaW5lJyxcbiAgICBjb21wb25lbnRzOiBbXSxcbiAgICBoYXNDb250cm9sczogdHJ1ZSxcblxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7IH0pO1xuICAgICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMuYm9keUZpbGwgPSBvcHRpb25zLmZpbGwgfHwgJydcbiAgICAgICAgaWYgKG9wdGlvbnMuaGFzT3duUHJvcGVydHkoJ2JvZHlGaWxsJykpIHtcbiAgICAgICAgICAgIHRoaXMuYm9keUZpbGwgPSBvcHRpb25zLmJvZHlGaWxsXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ib2R5VGV4dCA9IG9wdGlvbnMudGV4dCB8fCAnJ1xuICAgICAgICBpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgnYm9keVRleHQnKSkge1xuICAgICAgICAgICAgdGhpcy5ib2R5VGV4dCA9IG9wdGlvbnMuYm9keVRleHRcbiAgICAgICAgfVxuICAgICAgICBDb25zdGFudHMuUkVDVF9ESVNBQkxFRF9DT05UUk9MUy5mb3JFYWNoKChjb250cm9sKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldENvbnRyb2xWaXNpYmxlKGNvbnRyb2wsIGZhbHNlKVxuICAgICAgICB9KVxuICAgICAgICB0aGlzLnNldCgnZmlsbCcsICd0cmFuc3BhcmVudCcpXG5cbiAgICAgICAgdGhpcy5vbihcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAnYWRkZWQnOiB0aGlzLl9pbml0Q29tcG9uZW50cyxcbiAgICAgICAgICAgICAgICAnbW9kaWZpZWQnOiB0aGlzLl9zZXRDb21wb25lbnRzUG9zaXRpb24sXG4gICAgICAgICAgICAgICAgJ3NjYWxpbmcnOiB0aGlzLl9zZXRDb21wb25lbnRzUG9zaXRpb24sXG4gICAgICAgICAgICAgICAgJ21vdmluZyc6IHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbixcbiAgICAgICAgICAgICAgICAncm90YXRpbmcnOiB0aGlzLl9zZXRDb21wb25lbnRzUG9zaXRpb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgIH0sXG5cbiAgICBfaW5pdENvbXBvbmVudHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy50ZXh0ID0gbmV3IGZhYnJpYy5UZXh0KCcnLCB7dmlzaWJsZTogZmFsc2V9KVxuICAgICAgICB0aGlzLmJvZHkgPSBuZXcgZmFicmljLlJlY3Qoe1xuICAgICAgICAgICAgd2lkdGg6IHRoaXMud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0LFxuICAgICAgICAgICAgdG9wOiB0aGlzLnRvcCxcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMubGVmdCxcbiAgICAgICAgICAgIGZpbGw6IHRoaXMuYm9keUZpbGxcbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5jb21wb25lbnRzID0gW3RoaXMudGV4dCwgdGhpcy5ib2R5XVxuXG4gICAgICAgIHRoaXMuX3NldHVwQ29tcG9uZW50cygpXG4gICAgICAgIHRoaXMuc2V0VGV4dCh0aGlzLmJvZHlUZXh0KVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBfc2V0dXBDb21wb25lbnRzOiBhZGQgdGhlIGNvbXBvbmVudCB0byB0aGUgY2FudmFzIGFuZCBzZXQgc29tZSBvcHRpb25zXG4gICAgICogdG8gYXZvaWQgdGhlbSBmcm9tIGJlaW5nIGV4cG9ydGVkL3NlbGVjdGVkXG4gICAgICovXG4gICAgX3NldHVwQ29tcG9uZW50czogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmNvbXBvbmVudHMuZm9yRWFjaCgoY29tcG9uZW50KSA9PiB7XG4gICAgICAgICAgICBjb21wb25lbnQuc2V0KHtcbiAgICAgICAgICAgICAgICBleGNsdWRlRnJvbUV4cG9ydDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBoYXNDb250cm9sczogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2VsZWN0YWJsZTogZmFsc2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5hZGQoY29tcG9uZW50KVxuICAgICAgICAgICAgY29tcG9uZW50LnNlbmRCYWNrd2FyZHMoKVxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICBfc2V0Q29tcG9uZW50c1Bvc2l0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuaGVpZ2h0ICogdGhpcy5zY2FsZVksXG4gICAgICAgICAgICB3aWR0aCA9IHRoaXMud2lkdGggKiB0aGlzLnNjYWxlWCxcbiAgICAgICAgICAgIGJvdW5kaW5nUmVjdCA9IHRoaXMuZ2V0Qm91bmRpbmdSZWN0KClcblxuICAgICAgICBpZiAodGhpcy50ZXh0KSB7XG4gICAgICAgICAgICB0aGlzLnRleHQuc2V0KHtcbiAgICAgICAgICAgICAgICB0b3A6IGJvdW5kaW5nUmVjdC50b3AgKyAwLjUgKiAoYm91bmRpbmdSZWN0LmhlaWdodCAtIHRoaXMudGV4dC5oZWlnaHQpLFxuICAgICAgICAgICAgICAgIGxlZnQ6IGJvdW5kaW5nUmVjdC5sZWZ0ICsgMC41ICogKGJvdW5kaW5nUmVjdC53aWR0aCAtIHRoaXMudGV4dC53aWR0aClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmJvZHkuc2V0KHtcbiAgICAgICAgICAgIHRvcDogdGhpcy50b3AsXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLmxlZnQsXG4gICAgICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgIGFuZ2xlOiB0aGlzLmFuZ2xlXG4gICAgICAgIH0pXG5cbiAgICB9LFxuXG4gICAgZ2V0Q29tcG9uZW50czogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21wb25lbnRzXG4gICAgfSxcblxuICAgIHNldFRleHQ6IGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgIHRoaXMuYm9keVRleHQgPSB0ZXh0XG4gICAgICAgIGlmICh0ZXh0LnNsaWNlKC0xKSAhPT0gJ20nKSB7XG4gICAgICAgICAgICB0ZXh0ICs9ICdtJ1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudGV4dC5zZXQoe1xuICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICB9KVxuICAgICAgICB0aGlzLl9zZXRDb21wb25lbnRzUG9zaXRpb24oKVxuICAgIH0sXG5cbiAgICBfcmVuZGVyOiBmdW5jdGlvbiAoY3R4KSB7XG4gICAgICAgIHRoaXMuY2FsbFN1cGVyKCdfcmVuZGVyJywgY3R4KTtcbiAgICB9LFxuXG4gICAgY2xlYXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5jYW52YXMucmVtb3ZlKHRoaXMuY29tcG9uZW50cylcbiAgICB9LFxuXG4gICAgdG9PYmplY3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQodGhpcy5jYWxsU3VwZXIoJ3RvT2JqZWN0JyksIHtcbiAgICAgICAgICAgIGJvZHlGaWxsOiB0aGlzLmdldCgnYm9keUZpbGwnKSxcbiAgICAgICAgICAgIGJvZHlUZXh0OiB0aGlzLmdldCgnYm9keVRleHQnKVxuICAgICAgICB9KTtcbiAgICB9XG5cbn0pXG5cbmZhYnJpYy5MaW5lID0gTGluZVxuXG5mYWJyaWMuTGluZS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gZmFicmljLk9iamVjdC5fZnJvbU9iamVjdCgnTGluZScsIG9iamVjdCwgY2FsbGJhY2spO1xufTtcbiIsIi8vIGNvbnRyb2xzOiAndGwnLCAndHInLCAnYnInLCAnYmwnLCAnbWwnLCAnbXQnLCAnbXInLCAnbWInLCAnbXRyJ1xuZXhwb3J0IGNvbnN0IENvbnN0YW50cyA9IHtcbiAgICBSRUNUX0RJU0FCTEVEX0NPTlRST0xTOiBbICd0bCcsICd0cicsICdibCcsICdicicsICdtdCcsICdtYicgXVxufVxuIiwiaW1wb3J0IHtBcnJvd2xpbmV9IGZyb20gJy4vYXJyb3dsaW5lLmpzJztcbmltcG9ydCB7Q2FudmFzfSBmcm9tICcuL2NhbnZhcy5qcyc7XG5pbXBvcnQge0xpbmV9IGZyb20gJy4vbGluZS5qcyc7XG5pbXBvcnQge0NvbnN0YW50c30gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuZXhwb3J0IHtBcnJvd2xpbmUsIENhbnZhcywgTGluZSwgQ29uc3RhbnRzfTtcbiIsImltcG9ydCB7ZmFicmljfSBmcm9tICdmYWJyaWMnXG5pbXBvcnQge0xpbmV9IGZyb20gJy4vbGluZSdcblxuLyoqXG4gKiBBbiBBcnJvd2xpbmUgaXMgYSBncm91cCB0aGF0IGxvb2tzIGxpa2UgYSBkb3VibGUgYXJyb3dlZCBsaW5lOlxuICogICAgICAgPC0tLS0tLS0+XG4gKi9cbmV4cG9ydCBjb25zdCBBcnJvd2xpbmUgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhMaW5lLCB7XG5cbiAgICB0eXBlOiAnYXJyb3dsaW5lJyxcblxuICAgIF9pbml0Q29tcG9uZW50czogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnRleHQgPSBuZXcgZmFicmljLlRleHQodGhpcy5ib2R5VGV4dCwge2JhY2tncm91bmRDb2xvcjogJ3doaXRlJ30pXG4gICAgICAgIHRoaXMuYm9keSA9IG5ldyBmYWJyaWMuUmVjdCh7ZmlsbDogdGhpcy5ib2R5RmlsbH0pXG4gICAgICAgIHRoaXMubGVmdFRyaWFuZ2xlID0gbmV3IGZhYnJpYy5UcmlhbmdsZSh7ZmlsbDogdGhpcy5ib2R5RmlsbH0pXG4gICAgICAgIHRoaXMucmlnaHRUcmlhbmdsZSA9IG5ldyBmYWJyaWMuVHJpYW5nbGUoe2ZpbGw6IHRoaXMuYm9keUZpbGx9KVxuXG4gICAgICAgIHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbigpXG5cbiAgICAgICAgdGhpcy5jb21wb25lbnRzID0gW3RoaXMuYm9keSwgdGhpcy5sZWZ0VHJpYW5nbGUsIHRoaXMucmlnaHRUcmlhbmdsZSwgdGhpcy50ZXh0XVxuXG4gICAgICAgIHRoaXMuX3NldHVwQ29tcG9uZW50cygpXG4gICAgICAgIHRoaXMuc2V0VGV4dCh0aGlzLmJvZHlUZXh0KVxuICAgIH0sXG5cbiAgICBfc2V0Q29tcG9uZW50c1Bvc2l0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGRlZ3JlZXNUb1JhZGlhbnNSYXRpbyA9IE1hdGguUEkgLyAxODAsXG4gICAgICAgICAgICBoZWlnaHQgPSB0aGlzLmhlaWdodCAqIHRoaXMuc2NhbGVZLFxuICAgICAgICAgICAgd2lkdGggPSB0aGlzLndpZHRoICogdGhpcy5zY2FsZVgsXG4gICAgICAgICAgICBjb3NUZXRhID0gTWF0aC5jb3ModGhpcy5hbmdsZSAqIGRlZ3JlZXNUb1JhZGlhbnNSYXRpbyksXG4gICAgICAgICAgICBzaW5UZXRhID0gTWF0aC5zaW4odGhpcy5hbmdsZSAqIGRlZ3JlZXNUb1JhZGlhbnNSYXRpbyksXG4gICAgICAgICAgICBib3VuZGluZ1JlY3QgPSB0aGlzLmdldEJvdW5kaW5nUmVjdCgpXG5cbiAgICAgICAgdGhpcy50ZXh0LnNldCh7XG4gICAgICAgICAgICB0b3A6IGJvdW5kaW5nUmVjdC50b3AgKyAwLjUgKiAoYm91bmRpbmdSZWN0LmhlaWdodCAtIHRoaXMudGV4dC5oZWlnaHQpLFxuICAgICAgICAgICAgbGVmdDogYm91bmRpbmdSZWN0LmxlZnQgKyAwLjUgKiAoYm91bmRpbmdSZWN0LndpZHRoIC0gdGhpcy50ZXh0LndpZHRoKSxcbiAgICAgICAgICAgIGZvbnRTaXplOiAxOFxuICAgICAgICB9KVxuXG4gICAgICAgIHRoaXMuYm9keS5zZXQoe1xuICAgICAgICAgICAgdG9wOiB0aGlzLnRvcCArIGhlaWdodCAqIHNpblRldGEgKyAoaGVpZ2h0IC8gNCkgKiBjb3NUZXRhLFxuICAgICAgICAgICAgbGVmdDogdGhpcy5sZWZ0ICsgaGVpZ2h0ICogY29zVGV0YSAtIChoZWlnaHQgLyA0KSAqIHNpblRldGEsXG4gICAgICAgICAgICB3aWR0aDogd2lkdGggLSAyICogaGVpZ2h0LFxuICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQgLyAyLFxuICAgICAgICAgICAgYW5nbGU6IHRoaXMuYW5nbGVcbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLmxlZnRUcmlhbmdsZS5zZXQoe1xuICAgICAgICAgICAgdG9wOiB0aGlzLnRvcCArIGhlaWdodCAqIGNvc1RldGEsXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLmxlZnQgLSBoZWlnaHQgKiBzaW5UZXRhLFxuICAgICAgICAgICAgd2lkdGg6IGhlaWdodCxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICAgICAgYW5nbGU6IHRoaXMuYW5nbGUgLSA5MFxuICAgICAgICB9KVxuXG4gICAgICAgIHRoaXMucmlnaHRUcmlhbmdsZS5zZXQoe1xuICAgICAgICAgICAgdG9wOiB0aGlzLnRvcCArIHdpZHRoICogc2luVGV0YSxcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMubGVmdCArIHdpZHRoICogY29zVGV0YSxcbiAgICAgICAgICAgIHdpZHRoOiBoZWlnaHQsXG4gICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgIGFuZ2xlOiB0aGlzLmFuZ2xlICsgOTBcbiAgICAgICAgfSlcbiAgICB9XG5cbn0pXG5cbmZhYnJpYy5BcnJvd2xpbmUgPSBBcnJvd2xpbmVcblxuZmFicmljLkFycm93bGluZS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gZmFicmljLk9iamVjdC5fZnJvbU9iamVjdCgnQXJyb3dsaW5lJywgb2JqZWN0LCBjYWxsYmFjayk7XG59O1xuIiwiaW1wb3J0IHtmYWJyaWN9IGZyb20gJ2ZhYnJpYydcbmltcG9ydCB7Q29uc3RhbnRzfSBmcm9tICcuL2NvbnN0YW50cydcbmltcG9ydCB7TGluZX0gZnJvbSAnLi9saW5lJ1xuXG5leHBvcnQgY2xhc3MgQ2FudmFzIGV4dGVuZHMgZmFicmljLkNhbnZhcyB7XG5cbiAgICBjb25zdHJ1Y3Rvcihkb21FbGVtZW5kSWQpIHtcbiAgICAgICAgc3VwZXIoZG9tRWxlbWVuZElkKVxuICAgICAgICB0aGlzLmRvbUVsZW1lbmRJZCA9IGRvbUVsZW1lbmRJZFxuICAgICAgICB0aGlzLnNjYWxlID0ge3ZhbHVlOiBudWxsLCBzaGFwZTogbnVsbH1cbiAgICAgICAgdGhpcy5jdXN0b21CYWNrZ3JvdW5kSW1hZ2UgPSBudWxsXG4gICAgICAgIC8vIHRoaXMuX2xvY2tPYmplY3RzVG9Cb3VuZGFyaWVzKClcbiAgICB9XG5cbiAgICBhZGRJbWFnZShpbWFnZUZpbGUpIHtcbiAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxuXG4gICAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKVxuXG4gICAgICAgICAgICBpbWcuc3JjID0gcmVhZGVyLnJlc3VsdFxuXG4gICAgICAgICAgICB0aGlzLmN1c3RvbUJhY2tncm91bmRJbWFnZSA9IG5ldyBmYWJyaWMuSW1hZ2UoaW1nKVxuICAgICAgICAgICAgdGhpcy5jdXN0b21CYWNrZ3JvdW5kSW1hZ2Uuc2NhbGUodGhpcy5oZWlnaHQgLyB0aGlzLmN1c3RvbUJhY2tncm91bmRJbWFnZS5oZWlnaHQpXG4gICAgICAgICAgICB0aGlzLmFkZCh0aGlzLmN1c3RvbUJhY2tncm91bmRJbWFnZSlcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQWxsKClcbiAgICAgICAgfTtcblxuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpbWFnZUZpbGUpO1xuICAgIH1cblxuICAgIGxvY2tJbWFnZSgpIHtcbiAgICAgICAgdGhpcy5jdXN0b21CYWNrZ3JvdW5kSW1hZ2Uuc2VuZFRvQmFjaygpXG4gICAgICAgIHRoaXMuY3VzdG9tQmFja2dyb3VuZEltYWdlLmhhc0NvbnRyb2xzID0gZmFsc2VcbiAgICAgICAgdGhpcy5jdXN0b21CYWNrZ3JvdW5kSW1hZ2Uuc2VsZWN0YWJsZSA9IGZhbHNlXG4gICAgICAgIHRoaXMuZGlzY2FyZEFjdGl2ZU9iamVjdCgpO1xuICAgICAgICB0aGlzLnJlbmRlckFsbCgpXG4gICAgfVxuXG4gICAgX2xvY2tPYmplY3RzVG9Cb3VuZGFyaWVzKCkge1xuICAgICAgICB0aGlzLm9uKCdvYmplY3Q6bW92aW5nJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHZhciBvYmogPSBlLnRhcmdldDtcblxuICAgICAgICAgICAgLy8gaWYgb2JqZWN0IGlzIHRvbyBiaWcgaWdub3JlXG4gICAgICAgICAgICBpZiAob2JqLmN1cnJlbnRIZWlnaHQgPiB0aGlzLmhlaWdodCB8fCBvYmouY3VycmVudFdpZHRoID4gdGhpcy53aWR0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9iai5zZXRDb29yZHMoKTtcbiAgICAgICAgICAgIC8vIHRvcC1sZWZ0ICBjb3JuZXJcbiAgICAgICAgICAgIGlmIChvYmouZ2V0Qm91bmRpbmdSZWN0KCkudG9wIDwgMCB8fCBvYmouZ2V0Qm91bmRpbmdSZWN0KCkubGVmdCA8IDApIHtcbiAgICAgICAgICAgICAgICBvYmoudG9wID0gTWF0aC5tYXgob2JqLnRvcCwgb2JqLnRvcCAtIG9iai5nZXRCb3VuZGluZ1JlY3QoKS50b3ApO1xuICAgICAgICAgICAgICAgIG9iai5sZWZ0ID0gTWF0aC5tYXgob2JqLmxlZnQsIG9iai5sZWZ0IC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLmxlZnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gYm90LXJpZ2h0IGNvcm5lclxuICAgICAgICAgICAgaWYgKG9iai5nZXRCb3VuZGluZ1JlY3QoKS50b3AgKyBvYmouZ2V0Qm91bmRpbmdSZWN0KCkuaGVpZ2h0ID4gdGhpcy5oZWlnaHQgfHxcbiAgICAgICAgICAgICAgICAgICAgb2JqLmdldEJvdW5kaW5nUmVjdCgpLmxlZnQgKyBvYmouZ2V0Qm91bmRpbmdSZWN0KCkud2lkdGggPiB0aGlzLndpZHRoKSB7XG4gICAgICAgICAgICAgICAgb2JqLnRvcCA9IE1hdGgubWluKG9iai50b3AsIHRoaXMuaGVpZ2h0IC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLmhlaWdodCArXG4gICAgICAgICAgICAgICAgICAgIG9iai50b3AgLSBvYmouZ2V0Qm91bmRpbmdSZWN0KCkudG9wKTtcbiAgICAgICAgICAgICAgICBvYmoubGVmdCA9IE1hdGgubWluKG9iai5sZWZ0LCB0aGlzLndpZHRoIC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLndpZHRoICtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmxlZnQgLSBvYmouZ2V0Qm91bmRpbmdSZWN0KCkubGVmdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHNldFNjYWxlKHNjYWxlRGVmaW5pdGlvbikge1xuICAgICAgICBpZiAoc2NhbGVEZWZpbml0aW9uLnNoYXBlKSB7XG4gICAgICAgICAgICB0aGlzLnNjYWxlLnNoYXBlID0gc2NhbGVEZWZpbml0aW9uLnNoYXBlXG4gICAgICAgICAgICB0aGlzLnNjYWxlLnNoYXBlLmhhc0NvbnRyb2xzID0gZmFsc2VcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2NhbGVEZWZpbml0aW9uLnZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnNjYWxlLnZhbHVlID0gc2NhbGVEZWZpbml0aW9uLnZhbHVlXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRTY2FsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NhbGVcbiAgICB9XG5cbiAgICBsb2NrU2NhbGUoKSB7XG4gICAgICAgIHRoaXMuc2NhbGUuc2hhcGUuaGFzQ29udHJvbHMgPSBmYWxzZVxuICAgIH1cblxuICAgIGNsZWFyU2NhbGUoKSB7XG4gICAgICAgIGlmICh0aGlzLnNjYWxlLnNoYXBlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY2xlYXJTY2FsZScpXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnNjYWxlLnNoYXBlKVxuICAgICAgICAgICAgdGhpcy5jbGVhcigpXG4gICAgICAgICAgICB0aGlzLnJlbW92ZSh0aGlzLnNjYWxlLnNoYXBlKVxuICAgICAgICAgICAgdGhpcy5yZW1vdmUodGhpcy5zY2FsZS5zaGFwZSlcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQWxsKClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qXG4gICAgICogQHBhcmFtIGNob2ljZXM6IGEgbGlzdCBvZiAobGFiZWwsIGNvbG9yKVxuICAgICAqICBleGFtcGxlOiBbXG4gICAgICogICAgICB7bGFiZWw6ICdsYWJlbDEnLCBjb2xvcjogJ2JsdWUnfSxcbiAgICAgKiAgICAgIHtsYWJlbDogJ2xhYmVsMicsIGNvbG9yOiAncmdiYSgyNTUsMCwwLDAuNSknfVxuICAgICAqICAgXVxuICAgICAqIEByZXR1cm4gYSBET00gc2VsZWN0IG9iamVjdCB3aXRoIGNvcnJlc3BvbmRpbmcgb3B0aW9uc1xuICAgICAqL1xuICAgIGxpc3RUb1NlbGVjdERPTShjaG9pY2VzKSB7XG4gICAgICAgIGNvbnN0IGNhbnZhc2hvbGRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuZG9tRWxlbWVuZElkKVxuXG4gICAgICAgIC8vIENyZWF0ZSBhbmQgYXBwZW5kIHNlbGVjdCBsaXN0XG4gICAgICAgIGNvbnN0IHNlbGVjdExpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWxlY3QnKVxuXG4gICAgICAgIHNlbGVjdExpc3QuaWQgPSAnZmFicmljYXNoYXBlU2hhcGVDaG9pY2VzJ1xuICAgICAgICBjYW52YXNob2xkZXIucGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChzZWxlY3RMaXN0KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhbmQgYXBwZW5kIHRoZSBvcHRpb25zXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hvaWNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJylcblxuICAgICAgICAgICAgb3B0aW9uLnZhbHVlID0gY2hvaWNlc1tpXS5sYWJlbFxuICAgICAgICAgICAgb3B0aW9uLnRleHQgPSBjaG9pY2VzW2ldLmxhYmVsXG4gICAgICAgICAgICBvcHRpb24uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY2hvaWNlc1tpXS5jb2xvclxuICAgICAgICAgICAgc2VsZWN0TGlzdC5hcHBlbmRDaGlsZChvcHRpb24pXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNlbGVjdExpc3RcbiAgICB9XG5cbiAgICBzZXRTaGFwZUNob2ljZXMoY2hvaWNlcykge1xuICAgICAgICBjb25zdCBzZWxlY3RPYmplY3QgPSB0aGlzLmxpc3RUb1NlbGVjdERPTShjaG9pY2VzKVxuXG4gICAgICAgIHRoaXMuY3JlYXRlUmVmZXJlbmNlTGluZShzZWxlY3RPYmplY3QpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGxpbmUgdXNlciBjYW4gY2xpY2sgb24gdG8gZHVwbGljYXRlIGl0IGFuZCB1c2UgdGhlIGR1cGxpY2F0ZSBpbnRvIHRoZSBzY2VuZS5cbiAgICAgKi9cbiAgICBjcmVhdGVSZWZlcmVuY2VMaW5lKHNlbGVjdE9iamVjdCkge1xuICAgICAgICBjb25zdCByZWZlcmVuY2VMaW5lID0gbmV3IGZhYnJpYy5SZWN0KHtcbiAgICAgICAgICAgIHRvcDogNSwgbGVmdDogNSwgd2lkdGg6IDgwLCBoZWlnaHQ6IDE3LFxuICAgICAgICAgICAgZmlsbDogc2VsZWN0T2JqZWN0Lm9wdGlvbnNbc2VsZWN0T2JqZWN0LnNlbGVjdGVkSW5kZXhdLnN0eWxlLmJhY2tncm91bmRDb2xvclxuICAgICAgICB9KVxuXG4gICAgICAgIHRoaXMuYWRkKHJlZmVyZW5jZUxpbmUpXG4gICAgICAgIHRoaXMuaXRlbSh0aGlzLnNpemUoKSAtIDEpLmhhc0NvbnRyb2xzID0gZmFsc2VcbiAgICAgICAgdGhpcy5yZXF1ZXN0UmVuZGVyQWxsKClcblxuICAgICAgICBjb25zdCBmaWxsUmVmZXJlbmNlTGluZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXNcbiAgICAgICAgICAgICAgICAuaXRlbSh0aGlzLnNpemUoKSAtIDEpXG4gICAgICAgICAgICAgICAgLnNldCgnZmlsbCcsIHNlbGVjdE9iamVjdC5vcHRpb25zW3NlbGVjdE9iamVjdC5zZWxlY3RlZEluZGV4XS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IpXG4gICAgICAgICAgICB0aGlzLnJlbmRlckFsbCgpXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBkdXBsaWNhdGVSZWZlcmVuY2VMaW5lID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVSZWZlcmVuY2VMaW5lKHNlbGVjdE9iamVjdClcbiAgICAgICAgICAgIHJlZmVyZW5jZUxpbmUuaGFzQ29udHJvbHMgPSB0cnVlXG4gICAgICAgICAgICBDb25zdGFudHMuUkVDVF9ESVNBQkxFRF9DT05UUk9MUy5mb3JFYWNoKChjb250cm9sKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVmZXJlbmNlTGluZS5zZXRDb250cm9sVmlzaWJsZShjb250cm9sLCBmYWxzZSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICByZWZlcmVuY2VMaW5lLm9uKCdtb3VzZWRvd24nLCAoKSA9PiB7XG4gICAgICAgICAgICBkdXBsaWNhdGVSZWZlcmVuY2VMaW5lKClcbiAgICAgICAgICAgIHJlZmVyZW5jZUxpbmUub2ZmKCdtb3VzZWRvd24nKVxuICAgICAgICB9KVxuXG4gICAgICAgIHNlbGVjdE9iamVjdC5yZW1vdmVFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmaWxsUmVmZXJlbmNlTGluZSlcbiAgICAgICAgc2VsZWN0T2JqZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZpbGxSZWZlcmVuY2VMaW5lKVxuICAgIH1cblxuICAgIGNyZWF0ZVNjYWxlZExpbmUob3B0aW9ucykge1xuICAgICAgICBjb25zdCBzY2FsZSA9ICh0aGlzLnNjYWxlLnNoYXBlLndpZHRoICogdGhpcy5zY2FsZS5zaGFwZS5zY2FsZVgpIC8gdGhpcy5zY2FsZS52YWx1ZVxuXG4gICAgICAgIG9wdGlvbnMudG9wID0gb3B0aW9ucy50b3AgKiBzY2FsZVxuICAgICAgICBvcHRpb25zLmxlZnQgPSBvcHRpb25zLmxlZnQgKiBzY2FsZVxuICAgICAgICBvcHRpb25zLndpZHRoID0gb3B0aW9ucy53aWR0aCAqIHNjYWxlXG4gICAgICAgIG9wdGlvbnMuaGVpZ2h0ID0gb3B0aW9ucy5zdHJva2UgKiBzY2FsZVxuXG4gICAgICAgIHJldHVybiBuZXcgTGluZShvcHRpb25zKVxuICAgIH1cblxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==