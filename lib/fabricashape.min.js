!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("fabric")):"function"==typeof define&&define.amd?define("fabricashape",["fabric"],e):"object"==typeof exports?exports.fabricashape=e(require("fabric")):t.fabricashape=e(t.fabric)}("undefined"!=typeof self?self:this,function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(e,n){e.exports=t},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Line=void 0;var i=n(0),o=n(2),r=i.fabric.util.createClass(i.fabric.Rect,{type:"line",components:[],hasControls:!0,initialize:function(t){var e=this;t||(t={}),this.callSuper("initialize",t),this.bodyFill=t.fill||"",t.hasOwnProperty("bodyFill")&&(this.bodyFill=t.bodyFill),this.bodyText=t.text||"",o.Constants.RECT_DISABLED_CONTROLS.forEach(function(t){e.setControlVisible(t,!1)}),this.set("fill","transparent"),this.on({added:this._initComponents,modified:this._setComponentsPosition,scaling:this._setComponentsPosition,moving:this._setComponentsPosition,rotating:this._setComponentsPosition})},_initComponents:function(){this.text=new i.fabric.Text("",{visible:!1}),this.body=new i.fabric.Rect({width:this.width,height:this.height,top:this.top,left:this.left,fill:this.bodyFill}),this.components=[this.text,this.body],this._setupComponents(),this.setText(this.bodyText)},_setupComponents:function(){var t=this;this.components.forEach(function(e){e.set({excludeFromExport:!0,hasControls:!1,selectable:!1}),t.canvas.add(e),e.sendBackwards()})},_setComponentsPosition:function(){var t=this.height*this.scaleY,e=this.width*this.scaleX,n=this.getBoundingRect();this.text&&this.text.set({top:n.top+.5*(n.height-this.text.height),left:n.left+.5*(n.width-this.text.width)}),this.body.set({top:this.top,left:this.left,width:e,height:t,angle:this.angle})},getComponents:function(){return this.components},setText:function(t){"m"!==t.slice(-1)&&(t+="m"),this.text.set({text:t}),this._setComponentsPosition()},toObject:function(){return i.fabric.util.object.extend(this.callSuper("toObject"),{bodyFill:this.get("bodyFill"),bodyText:this.get("bodyText")})},_render:function(t){this.callSuper("_render",t)}});e.Line=r,i.fabric.Line=r,i.fabric.Line.fromObject=function(t,e){return i.fabric.Object._fromObject("Line",t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Constants=void 0;e.Constants={RECT_DISABLED_CONTROLS:["tl","tr","bl","br","mt","mb"]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Arrowline",{enumerable:!0,get:function(){return i.Arrowline}}),Object.defineProperty(e,"Canvas",{enumerable:!0,get:function(){return o.Canvas}}),Object.defineProperty(e,"Line",{enumerable:!0,get:function(){return r.Line}}),Object.defineProperty(e,"Constants",{enumerable:!0,get:function(){return s.Constants}});var i=n(4),o=n(5),r=n(1),s=n(2)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Arrowline=void 0;var i=n(0),o=n(1),r=i.fabric.util.createClass(o.Line,{type:"arrowline",_initComponents:function(){this.text=new i.fabric.Text("",{backgroundColor:"white"}),this.body=new i.fabric.Rect({fill:this.bodyFill}),this.leftTriangle=new i.fabric.Triangle({fill:this.bodyFill}),this.rightTriangle=new i.fabric.Triangle({fill:this.bodyFill}),this._setComponentsPosition(),this.components=[this.body,this.leftTriangle,this.rightTriangle,this.text],this._setupComponents(),this.setText(this.bodyText)},_setComponentsPosition:function(){var t=Math.PI/180,e=this.height*this.scaleY,n=this.width*this.scaleX,i=Math.cos(this.angle*t),o=Math.sin(this.angle*t),r=this.getBoundingRect();this.text.set({top:r.top+.5*(r.height-this.text.height),left:r.left+.5*(r.width-this.text.width),fontSize:18}),this.body.set({top:this.top+e*o+e/4*i,left:this.left+e*i-e/4*o,width:n-2*e,height:e/2,angle:this.angle}),this.leftTriangle.set({top:this.top+e*i,left:this.left-e*o,width:e,height:e,angle:this.angle-90}),this.rightTriangle.set({top:this.top+n*o,left:this.left+n*i,width:e,height:e,angle:this.angle+90})}});e.Arrowline=r,i.fabric.Arrowline=r,i.fabric.Arrowline.fromObject=function(t,e){return i.fabric.Object._fromObject("Arrowline",t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Canvas=void 0;var i=n(0),o=n(2),r=n(1);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var h=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))).domElemendId=t,n.scale={value:null,shape:null},n.backgroundImage=null,n}var n,s,h;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,i.fabric.Canvas),n=e,(s=[{key:"addImage",value:function(t){var e=this,n=new FileReader;n.onload=function(){var t=document.createElement("img");t.src=n.result,e.backgroundImage=new i.fabric.Image(t),e.backgroundImage.scale(e.height/e.backgroundImage.height),e.add(e.backgroundImage),e.renderAll()},n.readAsDataURL(t)}},{key:"lockImage",value:function(){this.backgroundImage.sendToBack(),this.backgroundImage.hasControls=!1,this.backgroundImage.selectable=!1,this.discardActiveObject(),this.renderAll()}},{key:"_lockObjectsToBoundaries",value:function(){this.on("object:moving",function(t){var e=t.target;e.currentHeight>this.height||e.currentWidth>this.width||(e.setCoords(),(e.getBoundingRect().top<0||e.getBoundingRect().left<0)&&(e.top=Math.max(e.top,e.top-e.getBoundingRect().top),e.left=Math.max(e.left,e.left-e.getBoundingRect().left)),(e.getBoundingRect().top+e.getBoundingRect().height>this.height||e.getBoundingRect().left+e.getBoundingRect().width>this.width)&&(e.top=Math.min(e.top,this.height-e.getBoundingRect().height+e.top-e.getBoundingRect().top),e.left=Math.min(e.left,this.width-e.getBoundingRect().width+e.left-e.getBoundingRect().left)))})}},{key:"setScale",value:function(t){t.shape&&(this.scale.shape=t.shape),t.value&&(this.scale.value=t.value)}},{key:"getScale",value:function(){return this.scale}},{key:"lockScale",value:function(){this.scale.shape.hasControls=!1}},{key:"listToSelectDOM",value:function(t){var e=document.getElementById(this.domElemendId),n=document.createElement("select");n.id="fabricashapeShapeChoices",e.parentElement.appendChild(n);for(var i=0;i<t.length;i++){var o=document.createElement("option");o.value=t[i].label,o.text=t[i].label,o.style.backgroundColor=t[i].color,n.appendChild(o)}return n}},{key:"setShapeChoices",value:function(t){var e=this.listToSelectDOM(t);this.createReferenceLine(e)}},{key:"createReferenceLine",value:function(t){var e=this,n=new i.fabric.Rect({top:5,left:5,width:80,height:17,fill:t.options[t.selectedIndex].style.backgroundColor});this.add(n),this.item(this.size()-1).hasControls=!1,this.requestRenderAll();var r=function(){e.item(e.size()-1).set("fill",t.options[t.selectedIndex].style.backgroundColor),e.renderAll()};n.on("mousedown",function(){e.createReferenceLine(t),n.hasControls=!0,o.Constants.RECT_DISABLED_CONTROLS.forEach(function(t){n.setControlVisible(t,!1)}),n.off("mousedown")}),t.removeEventListener("change",r),t.addEventListener("change",r)}},{key:"createScaledLine",value:function(t){var e=this.scale.shape.width*this.scale.shape.scaleX/this.scale.value;return t.top=t.top*e,t.left=t.left*e,t.width=t.width*e,t.height=t.stroke*e,new r.Line(t)}}])&&l(n.prototype,s),h&&l(n,h),e}();e.Canvas=h}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvZXh0ZXJuYWwgXCJmYWJyaWNcIiIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvbGluZS5qcyIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvYXJyb3dsaW5lLmpzIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS8uL3NyYy9jYW52YXMuanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIl9mYWJyaWMiLCJfY29uc3RhbnRzIiwiTGluZSIsImZhYnJpYyIsInV0aWwiLCJjcmVhdGVDbGFzcyIsIlJlY3QiLCJ0eXBlIiwiY29tcG9uZW50cyIsImhhc0NvbnRyb2xzIiwiaW5pdGlhbGl6ZSIsIm9wdGlvbnMiLCJfdGhpcyIsImNhbGxTdXBlciIsImJvZHlGaWxsIiwiZmlsbCIsImJvZHlUZXh0IiwidGV4dCIsIkNvbnN0YW50cyIsIlJFQ1RfRElTQUJMRURfQ09OVFJPTFMiLCJmb3JFYWNoIiwiY29udHJvbCIsInNldENvbnRyb2xWaXNpYmxlIiwic2V0Iiwib24iLCJhZGRlZCIsIl9pbml0Q29tcG9uZW50cyIsIm1vZGlmaWVkIiwiX3NldENvbXBvbmVudHNQb3NpdGlvbiIsInNjYWxpbmciLCJtb3ZpbmciLCJyb3RhdGluZyIsIlRleHQiLCJ2aXNpYmxlIiwiYm9keSIsIndpZHRoIiwiaGVpZ2h0IiwidG9wIiwibGVmdCIsIl9zZXR1cENvbXBvbmVudHMiLCJzZXRUZXh0IiwiX3RoaXMyIiwiY29tcG9uZW50IiwiZXhjbHVkZUZyb21FeHBvcnQiLCJzZWxlY3RhYmxlIiwiY2FudmFzIiwiYWRkIiwic2VuZEJhY2t3YXJkcyIsInNjYWxlWSIsInNjYWxlWCIsImJvdW5kaW5nUmVjdCIsImdldEJvdW5kaW5nUmVjdCIsImFuZ2xlIiwiZ2V0Q29tcG9uZW50cyIsInNsaWNlIiwidG9PYmplY3QiLCJleHRlbmQiLCJfcmVuZGVyIiwiY3R4IiwiZnJvbU9iamVjdCIsImNhbGxiYWNrIiwiX2Zyb21PYmplY3QiLCJfYXJyb3dsaW5lIiwiX2NhbnZhcyIsIl9saW5lIiwiQXJyb3dsaW5lIiwiYmFja2dyb3VuZENvbG9yIiwibGVmdFRyaWFuZ2xlIiwiVHJpYW5nbGUiLCJyaWdodFRyaWFuZ2xlIiwiZGVncmVlc1RvUmFkaWFuc1JhdGlvIiwiTWF0aCIsIlBJIiwiY29zVGV0YSIsImNvcyIsInNpblRldGEiLCJzaW4iLCJmb250U2l6ZSIsIkNhbnZhcyIsImRvbUVsZW1lbmRJZCIsIl9jbGFzc0NhbGxDaGVjayIsIl9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIiwiX19wcm90b19fIiwiZ2V0UHJvdG90eXBlT2YiLCJzY2FsZSIsInNoYXBlIiwiYmFja2dyb3VuZEltYWdlIiwiaW1hZ2VGaWxlIiwicmVhZGVyIiwiRmlsZVJlYWRlciIsIm9ubG9hZCIsImltZyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNyYyIsInJlc3VsdCIsIkltYWdlIiwicmVuZGVyQWxsIiwicmVhZEFzRGF0YVVSTCIsInNlbmRUb0JhY2siLCJkaXNjYXJkQWN0aXZlT2JqZWN0IiwiZSIsIm9iaiIsInRhcmdldCIsImN1cnJlbnRIZWlnaHQiLCJjdXJyZW50V2lkdGgiLCJzZXRDb29yZHMiLCJtYXgiLCJtaW4iLCJzY2FsZURlZmluaXRpb24iLCJjaG9pY2VzIiwiY2FudmFzaG9sZGVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJzZWxlY3RMaXN0IiwiaWQiLCJwYXJlbnRFbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJsZW5ndGgiLCJvcHRpb24iLCJsYWJlbCIsInN0eWxlIiwiY29sb3IiLCJzZWxlY3RPYmplY3QiLCJsaXN0VG9TZWxlY3RET00iLCJjcmVhdGVSZWZlcmVuY2VMaW5lIiwiX3RoaXMzIiwicmVmZXJlbmNlTGluZSIsInNlbGVjdGVkSW5kZXgiLCJpdGVtIiwic2l6ZSIsInJlcXVlc3RSZW5kZXJBbGwiLCJmaWxsUmVmZXJlbmNlTGluZSIsIm9mZiIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwic3Ryb2tlIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxHQUNBLGlCQUFBQyxTQUFBLGlCQUFBQyxPQUNBQSxPQUFBRCxRQUFBRCxFQUFBRyxRQUFBLFdBQ0EsbUJBQUFDLGVBQUFDLElBQ0FELE9BQUEsMEJBQUFKLEdBQ0EsaUJBQUFDLFFBQ0FBLFFBQUEsYUFBQUQsRUFBQUcsUUFBQSxXQUVBSixFQUFBLGFBQUFDLEVBQUFELEVBQUEsUUFSQSxDQVNDLG9CQUFBTyxVQUFBQyxLQUFBLFNBQUFDLEdBQ0QsbUJDVEEsSUFBQUMsRUFBQSxHQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBVixRQUdBLElBQUFD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QixLQUFPOEMsRUFDOUJ6RSxFQUFRd0IsTUFBUXhCLEVBQVF3QixNQUFRaUQsRUFDaEN6RSxFQUFReUIsT0FBU3pCLEVBQVE0SCxPQUFTbkQsRUFFM0IsSUFBQXBCLEVBQUE5RCxLQUFTUyIsImZpbGUiOiJmYWJyaWNhc2hhcGUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKFwiZmFicmljXCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFwiZmFicmljYXNoYXBlXCIsIFtcImZhYnJpY1wiXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJmYWJyaWNhc2hhcGVcIl0gPSBmYWN0b3J5KHJlcXVpcmUoXCJmYWJyaWNcIikpO1xuXHRlbHNlXG5cdFx0cm9vdFtcImZhYnJpY2FzaGFwZVwiXSA9IGZhY3Rvcnkocm9vdFtcImZhYnJpY1wiXSk7XG59KSh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDogdGhpcywgZnVuY3Rpb24oX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fKSB7XG5yZXR1cm4gIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDMpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18wX187IiwiaW1wb3J0IHtmYWJyaWN9IGZyb20gJ2ZhYnJpYydcbmltcG9ydCB7Q29uc3RhbnRzfSBmcm9tICcuL2NvbnN0YW50cydcblxuZXhwb3J0IGNvbnN0IExpbmUgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuUmVjdCwge1xuXG4gICAgdHlwZTogJ2xpbmUnLFxuICAgIGNvbXBvbmVudHM6IFtdLFxuICAgIGhhc0NvbnRyb2xzOiB0cnVlLFxuXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHsgfSk7XG4gICAgICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgb3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5ib2R5RmlsbCA9IG9wdGlvbnMuZmlsbCB8fCAnJ1xuICAgICAgICBpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgnYm9keUZpbGwnKSkge1xuICAgICAgICAgICAgdGhpcy5ib2R5RmlsbCA9IG9wdGlvbnMuYm9keUZpbGxcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmJvZHlUZXh0ID0gb3B0aW9ucy50ZXh0IHx8ICcnXG4gICAgICAgIENvbnN0YW50cy5SRUNUX0RJU0FCTEVEX0NPTlRST0xTLmZvckVhY2goKGNvbnRyb2wpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0Q29udHJvbFZpc2libGUoY29udHJvbCwgZmFsc2UpXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuc2V0KCdmaWxsJywgJ3RyYW5zcGFyZW50JylcblxuICAgICAgICB0aGlzLm9uKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICdhZGRlZCc6IHRoaXMuX2luaXRDb21wb25lbnRzLFxuICAgICAgICAgICAgICAgICdtb2RpZmllZCc6IHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbixcbiAgICAgICAgICAgICAgICAnc2NhbGluZyc6IHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbixcbiAgICAgICAgICAgICAgICAnbW92aW5nJzogdGhpcy5fc2V0Q29tcG9uZW50c1Bvc2l0aW9uLFxuICAgICAgICAgICAgICAgICdyb3RhdGluZyc6IHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvblxuICAgICAgICAgICAgfVxuICAgICAgICApXG4gICAgfSxcblxuICAgIF9pbml0Q29tcG9uZW50czogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnRleHQgPSBuZXcgZmFicmljLlRleHQoJycsIHt2aXNpYmxlOiBmYWxzZX0pXG4gICAgICAgIHRoaXMuYm9keSA9IG5ldyBmYWJyaWMuUmVjdCh7XG4gICAgICAgICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQsXG4gICAgICAgICAgICB0b3A6IHRoaXMudG9wLFxuICAgICAgICAgICAgbGVmdDogdGhpcy5sZWZ0LFxuICAgICAgICAgICAgZmlsbDogdGhpcy5ib2R5RmlsbFxuICAgICAgICB9KVxuICAgICAgICB0aGlzLmNvbXBvbmVudHMgPSBbdGhpcy50ZXh0LCB0aGlzLmJvZHldXG5cbiAgICAgICAgdGhpcy5fc2V0dXBDb21wb25lbnRzKClcbiAgICAgICAgdGhpcy5zZXRUZXh0KHRoaXMuYm9keVRleHQpXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIF9zZXR1cENvbXBvbmVudHM6IGFkZCB0aGUgY29tcG9uZW50IHRvIHRoZSBjYW52YXMgYW5kIHNldCBzb21lIG9wdGlvbnNcbiAgICAgKiB0byBhdm9pZCB0aGVtIGZyb20gYmVpbmcgZXhwb3J0ZWQvc2VsZWN0ZWRcbiAgICAgKi9cbiAgICBfc2V0dXBDb21wb25lbnRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY29tcG9uZW50cy5mb3JFYWNoKChjb21wb25lbnQpID0+IHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5zZXQoe1xuICAgICAgICAgICAgICAgIGV4Y2x1ZGVGcm9tRXhwb3J0OiB0cnVlLFxuICAgICAgICAgICAgICAgIGhhc0NvbnRyb2xzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzZWxlY3RhYmxlOiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLmFkZChjb21wb25lbnQpXG4gICAgICAgICAgICBjb21wb25lbnQuc2VuZEJhY2t3YXJkcygpXG4gICAgICAgIH0pXG4gICAgfSxcblxuICAgIF9zZXRDb21wb25lbnRzUG9zaXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5oZWlnaHQgKiB0aGlzLnNjYWxlWSxcbiAgICAgICAgICAgIHdpZHRoID0gdGhpcy53aWR0aCAqIHRoaXMuc2NhbGVYLFxuICAgICAgICAgICAgYm91bmRpbmdSZWN0ID0gdGhpcy5nZXRCb3VuZGluZ1JlY3QoKVxuXG4gICAgICAgIGlmICh0aGlzLnRleHQpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dC5zZXQoe1xuICAgICAgICAgICAgICAgIHRvcDogYm91bmRpbmdSZWN0LnRvcCArIDAuNSAqIChib3VuZGluZ1JlY3QuaGVpZ2h0IC0gdGhpcy50ZXh0LmhlaWdodCksXG4gICAgICAgICAgICAgICAgbGVmdDogYm91bmRpbmdSZWN0LmxlZnQgKyAwLjUgKiAoYm91bmRpbmdSZWN0LndpZHRoIC0gdGhpcy50ZXh0LndpZHRoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYm9keS5zZXQoe1xuICAgICAgICAgICAgdG9wOiB0aGlzLnRvcCxcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMubGVmdCxcbiAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICAgICAgYW5nbGU6IHRoaXMuYW5nbGVcbiAgICAgICAgfSlcblxuICAgIH0sXG5cbiAgICBnZXRDb21wb25lbnRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudHNcbiAgICB9LFxuXG4gICAgc2V0VGV4dDogZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgICAgaWYgKHRleHQuc2xpY2UoLTEpICE9PSAnbScpIHtcbiAgICAgICAgICAgIHRleHQgKz0gJ20nXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50ZXh0LnNldCh7XG4gICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbigpXG4gICAgfSxcblxuICAgIHRvT2JqZWN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHRoaXMuY2FsbFN1cGVyKCd0b09iamVjdCcpLCB7XG4gICAgICAgICAgICBib2R5RmlsbDogdGhpcy5nZXQoJ2JvZHlGaWxsJyksXG4gICAgICAgICAgICBib2R5VGV4dDogdGhpcy5nZXQoJ2JvZHlUZXh0JylcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIF9yZW5kZXI6IGZ1bmN0aW9uIChjdHgpIHtcbiAgICAgICAgdGhpcy5jYWxsU3VwZXIoJ19yZW5kZXInLCBjdHgpO1xuICAgIH1cblxufSlcblxuZmFicmljLkxpbmUgPSBMaW5lXG5cbmZhYnJpYy5MaW5lLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0LCBjYWxsYmFjaykge1xuICAgIHJldHVybiBmYWJyaWMuT2JqZWN0Ll9mcm9tT2JqZWN0KCdMaW5lJywgb2JqZWN0LCBjYWxsYmFjayk7XG59O1xuIiwiLy8gY29udHJvbHM6ICd0bCcsICd0cicsICdicicsICdibCcsICdtbCcsICdtdCcsICdtcicsICdtYicsICdtdHInXG5leHBvcnQgY29uc3QgQ29uc3RhbnRzID0ge1xuICAgIFJFQ1RfRElTQUJMRURfQ09OVFJPTFM6IFsgJ3RsJywgJ3RyJywgJ2JsJywgJ2JyJywgJ210JywgJ21iJyBdXG59XG4iLCJpbXBvcnQge0Fycm93bGluZX0gZnJvbSAnLi9hcnJvd2xpbmUuanMnO1xuaW1wb3J0IHtDYW52YXN9IGZyb20gJy4vY2FudmFzLmpzJztcbmltcG9ydCB7TGluZX0gZnJvbSAnLi9saW5lLmpzJztcbmltcG9ydCB7Q29uc3RhbnRzfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5leHBvcnQge0Fycm93bGluZSwgQ2FudmFzLCBMaW5lLCBDb25zdGFudHN9O1xuIiwiaW1wb3J0IHtmYWJyaWN9IGZyb20gJ2ZhYnJpYydcbmltcG9ydCB7TGluZX0gZnJvbSAnLi9saW5lJ1xuXG4vKipcbiAqIEFuIEFycm93bGluZSBpcyBhIGdyb3VwIHRoYXQgbG9va3MgbGlrZSBhIGRvdWJsZSBhcnJvd2VkIGxpbmU6XG4gKiAgICAgICA8LS0tLS0tLT5cbiAqL1xuZXhwb3J0IGNvbnN0IEFycm93bGluZSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKExpbmUsIHtcblxuICAgIHR5cGU6ICdhcnJvd2xpbmUnLFxuXG4gICAgX2luaXRDb21wb25lbnRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudGV4dCA9IG5ldyBmYWJyaWMuVGV4dCgnJywge2JhY2tncm91bmRDb2xvcjogJ3doaXRlJ30pXG4gICAgICAgIHRoaXMuYm9keSA9IG5ldyBmYWJyaWMuUmVjdCh7ZmlsbDogdGhpcy5ib2R5RmlsbH0pXG4gICAgICAgIHRoaXMubGVmdFRyaWFuZ2xlID0gbmV3IGZhYnJpYy5UcmlhbmdsZSh7ZmlsbDogdGhpcy5ib2R5RmlsbH0pXG4gICAgICAgIHRoaXMucmlnaHRUcmlhbmdsZSA9IG5ldyBmYWJyaWMuVHJpYW5nbGUoe2ZpbGw6IHRoaXMuYm9keUZpbGx9KVxuXG4gICAgICAgIHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbigpXG5cbiAgICAgICAgdGhpcy5jb21wb25lbnRzID0gW3RoaXMuYm9keSwgdGhpcy5sZWZ0VHJpYW5nbGUsIHRoaXMucmlnaHRUcmlhbmdsZSwgdGhpcy50ZXh0XVxuXG4gICAgICAgIHRoaXMuX3NldHVwQ29tcG9uZW50cygpXG4gICAgICAgIHRoaXMuc2V0VGV4dCh0aGlzLmJvZHlUZXh0KVxuICAgIH0sXG5cbiAgICBfc2V0Q29tcG9uZW50c1Bvc2l0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGRlZ3JlZXNUb1JhZGlhbnNSYXRpbyA9IE1hdGguUEkgLyAxODAsXG4gICAgICAgICAgICBoZWlnaHQgPSB0aGlzLmhlaWdodCAqIHRoaXMuc2NhbGVZLFxuICAgICAgICAgICAgd2lkdGggPSB0aGlzLndpZHRoICogdGhpcy5zY2FsZVgsXG4gICAgICAgICAgICBjb3NUZXRhID0gTWF0aC5jb3ModGhpcy5hbmdsZSAqIGRlZ3JlZXNUb1JhZGlhbnNSYXRpbyksXG4gICAgICAgICAgICBzaW5UZXRhID0gTWF0aC5zaW4odGhpcy5hbmdsZSAqIGRlZ3JlZXNUb1JhZGlhbnNSYXRpbyksXG4gICAgICAgICAgICBib3VuZGluZ1JlY3QgPSB0aGlzLmdldEJvdW5kaW5nUmVjdCgpXG5cbiAgICAgICAgdGhpcy50ZXh0LnNldCh7XG4gICAgICAgICAgICB0b3A6IGJvdW5kaW5nUmVjdC50b3AgKyAwLjUgKiAoYm91bmRpbmdSZWN0LmhlaWdodCAtIHRoaXMudGV4dC5oZWlnaHQpLFxuICAgICAgICAgICAgbGVmdDogYm91bmRpbmdSZWN0LmxlZnQgKyAwLjUgKiAoYm91bmRpbmdSZWN0LndpZHRoIC0gdGhpcy50ZXh0LndpZHRoKSxcbiAgICAgICAgICAgIGZvbnRTaXplOiAxOFxuICAgICAgICB9KVxuXG4gICAgICAgIHRoaXMuYm9keS5zZXQoe1xuICAgICAgICAgICAgdG9wOiB0aGlzLnRvcCArIGhlaWdodCAqIHNpblRldGEgKyAoaGVpZ2h0IC8gNCkgKiBjb3NUZXRhLFxuICAgICAgICAgICAgbGVmdDogdGhpcy5sZWZ0ICsgaGVpZ2h0ICogY29zVGV0YSAtIChoZWlnaHQgLyA0KSAqIHNpblRldGEsXG4gICAgICAgICAgICB3aWR0aDogd2lkdGggLSAyICogaGVpZ2h0LFxuICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQgLyAyLFxuICAgICAgICAgICAgYW5nbGU6IHRoaXMuYW5nbGVcbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLmxlZnRUcmlhbmdsZS5zZXQoe1xuICAgICAgICAgICAgdG9wOiB0aGlzLnRvcCArIGhlaWdodCAqIGNvc1RldGEsXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLmxlZnQgLSBoZWlnaHQgKiBzaW5UZXRhLFxuICAgICAgICAgICAgd2lkdGg6IGhlaWdodCxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICAgICAgYW5nbGU6IHRoaXMuYW5nbGUgLSA5MFxuICAgICAgICB9KVxuXG4gICAgICAgIHRoaXMucmlnaHRUcmlhbmdsZS5zZXQoe1xuICAgICAgICAgICAgdG9wOiB0aGlzLnRvcCArIHdpZHRoICogc2luVGV0YSxcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMubGVmdCArIHdpZHRoICogY29zVGV0YSxcbiAgICAgICAgICAgIHdpZHRoOiBoZWlnaHQsXG4gICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgIGFuZ2xlOiB0aGlzLmFuZ2xlICsgOTBcbiAgICAgICAgfSlcbiAgICB9XG5cbn0pXG5cbmZhYnJpYy5BcnJvd2xpbmUgPSBBcnJvd2xpbmVcblxuZmFicmljLkFycm93bGluZS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gZmFicmljLk9iamVjdC5fZnJvbU9iamVjdCgnQXJyb3dsaW5lJywgb2JqZWN0LCBjYWxsYmFjayk7XG59O1xuIiwiaW1wb3J0IHtmYWJyaWN9IGZyb20gJ2ZhYnJpYydcbmltcG9ydCB7Q29uc3RhbnRzfSBmcm9tICcuL2NvbnN0YW50cydcbmltcG9ydCB7TGluZX0gZnJvbSAnLi9saW5lJ1xuXG5leHBvcnQgY2xhc3MgQ2FudmFzIGV4dGVuZHMgZmFicmljLkNhbnZhcyB7XG5cbiAgICBjb25zdHJ1Y3Rvcihkb21FbGVtZW5kSWQpIHtcbiAgICAgICAgc3VwZXIoZG9tRWxlbWVuZElkKVxuICAgICAgICB0aGlzLmRvbUVsZW1lbmRJZCA9IGRvbUVsZW1lbmRJZFxuICAgICAgICB0aGlzLnNjYWxlID0ge3ZhbHVlOiBudWxsLCBzaGFwZTogbnVsbH1cbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UgPSBudWxsXG4gICAgICAgIC8vIHRoaXMuX2xvY2tPYmplY3RzVG9Cb3VuZGFyaWVzKClcbiAgICB9XG5cbiAgICBhZGRJbWFnZShpbWFnZUZpbGUpIHtcbiAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxuXG4gICAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKVxuXG4gICAgICAgICAgICBpbWcuc3JjID0gcmVhZGVyLnJlc3VsdFxuXG4gICAgICAgICAgICB0aGlzLmJhY2tncm91bmRJbWFnZSA9IG5ldyBmYWJyaWMuSW1hZ2UoaW1nKVxuICAgICAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2Uuc2NhbGUodGhpcy5oZWlnaHQgLyB0aGlzLmJhY2tncm91bmRJbWFnZS5oZWlnaHQpXG4gICAgICAgICAgICB0aGlzLmFkZCh0aGlzLmJhY2tncm91bmRJbWFnZSlcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQWxsKClcbiAgICAgICAgfTtcblxuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpbWFnZUZpbGUpO1xuICAgIH1cblxuICAgIGxvY2tJbWFnZSgpIHtcbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2Uuc2VuZFRvQmFjaygpXG4gICAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLmhhc0NvbnRyb2xzID0gZmFsc2VcbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2Uuc2VsZWN0YWJsZSA9IGZhbHNlXG4gICAgICAgIHRoaXMuZGlzY2FyZEFjdGl2ZU9iamVjdCgpO1xuICAgICAgICB0aGlzLnJlbmRlckFsbCgpXG4gICAgfVxuXG4gICAgX2xvY2tPYmplY3RzVG9Cb3VuZGFyaWVzKCkge1xuICAgICAgICB0aGlzLm9uKCdvYmplY3Q6bW92aW5nJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHZhciBvYmogPSBlLnRhcmdldDtcblxuICAgICAgICAgICAgLy8gaWYgb2JqZWN0IGlzIHRvbyBiaWcgaWdub3JlXG4gICAgICAgICAgICBpZiAob2JqLmN1cnJlbnRIZWlnaHQgPiB0aGlzLmhlaWdodCB8fCBvYmouY3VycmVudFdpZHRoID4gdGhpcy53aWR0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9iai5zZXRDb29yZHMoKTtcbiAgICAgICAgICAgIC8vIHRvcC1sZWZ0ICBjb3JuZXJcbiAgICAgICAgICAgIGlmIChvYmouZ2V0Qm91bmRpbmdSZWN0KCkudG9wIDwgMCB8fCBvYmouZ2V0Qm91bmRpbmdSZWN0KCkubGVmdCA8IDApIHtcbiAgICAgICAgICAgICAgICBvYmoudG9wID0gTWF0aC5tYXgob2JqLnRvcCwgb2JqLnRvcCAtIG9iai5nZXRCb3VuZGluZ1JlY3QoKS50b3ApO1xuICAgICAgICAgICAgICAgIG9iai5sZWZ0ID0gTWF0aC5tYXgob2JqLmxlZnQsIG9iai5sZWZ0IC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLmxlZnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gYm90LXJpZ2h0IGNvcm5lclxuICAgICAgICAgICAgaWYgKG9iai5nZXRCb3VuZGluZ1JlY3QoKS50b3AgKyBvYmouZ2V0Qm91bmRpbmdSZWN0KCkuaGVpZ2h0ID4gdGhpcy5oZWlnaHQgfHxcbiAgICAgICAgICAgICAgICAgICAgb2JqLmdldEJvdW5kaW5nUmVjdCgpLmxlZnQgKyBvYmouZ2V0Qm91bmRpbmdSZWN0KCkud2lkdGggPiB0aGlzLndpZHRoKSB7XG4gICAgICAgICAgICAgICAgb2JqLnRvcCA9IE1hdGgubWluKG9iai50b3AsIHRoaXMuaGVpZ2h0IC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLmhlaWdodCArXG4gICAgICAgICAgICAgICAgICAgIG9iai50b3AgLSBvYmouZ2V0Qm91bmRpbmdSZWN0KCkudG9wKTtcbiAgICAgICAgICAgICAgICBvYmoubGVmdCA9IE1hdGgubWluKG9iai5sZWZ0LCB0aGlzLndpZHRoIC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLndpZHRoICtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmxlZnQgLSBvYmouZ2V0Qm91bmRpbmdSZWN0KCkubGVmdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHNldFNjYWxlKHNjYWxlRGVmaW5pdGlvbikge1xuICAgICAgICBpZiAoc2NhbGVEZWZpbml0aW9uLnNoYXBlKSB7XG4gICAgICAgICAgICB0aGlzLnNjYWxlLnNoYXBlID0gc2NhbGVEZWZpbml0aW9uLnNoYXBlXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNjYWxlRGVmaW5pdGlvbi52YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zY2FsZS52YWx1ZSA9IHNjYWxlRGVmaW5pdGlvbi52YWx1ZVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0U2NhbGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNjYWxlXG4gICAgfVxuXG4gICAgbG9ja1NjYWxlKCkge1xuICAgICAgICB0aGlzLnNjYWxlLnNoYXBlLmhhc0NvbnRyb2xzID0gZmFsc2VcbiAgICB9XG5cbiAgICAvKlxuICAgICAqIEBwYXJhbSBjaG9pY2VzOiBhIGxpc3Qgb2YgKGxhYmVsLCBjb2xvcilcbiAgICAgKiAgZXhhbXBsZTogW1xuICAgICAqICAgICAge2xhYmVsOiAnbGFiZWwxJywgY29sb3I6ICdibHVlJ30sXG4gICAgICogICAgICB7bGFiZWw6ICdsYWJlbDInLCBjb2xvcjogJ3JnYmEoMjU1LDAsMCwwLjUpJ31cbiAgICAgKiAgIF1cbiAgICAgKiBAcmV0dXJuIGEgRE9NIHNlbGVjdCBvYmplY3Qgd2l0aCBjb3JyZXNwb25kaW5nIG9wdGlvbnNcbiAgICAgKi9cbiAgICBsaXN0VG9TZWxlY3RET00oY2hvaWNlcykge1xuICAgICAgICBjb25zdCBjYW52YXNob2xkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmRvbUVsZW1lbmRJZClcblxuICAgICAgICAvLyBDcmVhdGUgYW5kIGFwcGVuZCBzZWxlY3QgbGlzdFxuICAgICAgICBjb25zdCBzZWxlY3RMaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VsZWN0JylcblxuICAgICAgICBzZWxlY3RMaXN0LmlkID0gJ2ZhYnJpY2FzaGFwZVNoYXBlQ2hvaWNlcydcbiAgICAgICAgY2FudmFzaG9sZGVyLnBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoc2VsZWN0TGlzdClcblxuICAgICAgICAvLyBDcmVhdGUgYW5kIGFwcGVuZCB0aGUgb3B0aW9uc1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNob2ljZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpXG5cbiAgICAgICAgICAgIG9wdGlvbi52YWx1ZSA9IGNob2ljZXNbaV0ubGFiZWxcbiAgICAgICAgICAgIG9wdGlvbi50ZXh0ID0gY2hvaWNlc1tpXS5sYWJlbFxuICAgICAgICAgICAgb3B0aW9uLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNob2ljZXNbaV0uY29sb3JcbiAgICAgICAgICAgIHNlbGVjdExpc3QuYXBwZW5kQ2hpbGQob3B0aW9uKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZWxlY3RMaXN0XG4gICAgfVxuXG4gICAgc2V0U2hhcGVDaG9pY2VzKGNob2ljZXMpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0T2JqZWN0ID0gdGhpcy5saXN0VG9TZWxlY3RET00oY2hvaWNlcylcblxuICAgICAgICB0aGlzLmNyZWF0ZVJlZmVyZW5jZUxpbmUoc2VsZWN0T2JqZWN0KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBsaW5lIHVzZXIgY2FuIGNsaWNrIG9uIHRvIGR1cGxpY2F0ZSBpdCBhbmQgdXNlIHRoZSBkdXBsaWNhdGUgaW50byB0aGUgc2NlbmUuXG4gICAgICovXG4gICAgY3JlYXRlUmVmZXJlbmNlTGluZShzZWxlY3RPYmplY3QpIHtcbiAgICAgICAgY29uc3QgcmVmZXJlbmNlTGluZSA9IG5ldyBmYWJyaWMuUmVjdCh7XG4gICAgICAgICAgICB0b3A6IDUsIGxlZnQ6IDUsIHdpZHRoOiA4MCwgaGVpZ2h0OiAxNyxcbiAgICAgICAgICAgIGZpbGw6IHNlbGVjdE9iamVjdC5vcHRpb25zW3NlbGVjdE9iamVjdC5zZWxlY3RlZEluZGV4XS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3JcbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLmFkZChyZWZlcmVuY2VMaW5lKVxuICAgICAgICB0aGlzLml0ZW0odGhpcy5zaXplKCkgLSAxKS5oYXNDb250cm9scyA9IGZhbHNlXG4gICAgICAgIHRoaXMucmVxdWVzdFJlbmRlckFsbCgpXG5cbiAgICAgICAgY29uc3QgZmlsbFJlZmVyZW5jZUxpbmUgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzXG4gICAgICAgICAgICAgICAgLml0ZW0odGhpcy5zaXplKCkgLSAxKVxuICAgICAgICAgICAgICAgIC5zZXQoJ2ZpbGwnLCBzZWxlY3RPYmplY3Qub3B0aW9uc1tzZWxlY3RPYmplY3Quc2VsZWN0ZWRJbmRleF0uc3R5bGUuYmFja2dyb3VuZENvbG9yKVxuICAgICAgICAgICAgdGhpcy5yZW5kZXJBbGwoKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZHVwbGljYXRlUmVmZXJlbmNlTGluZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlUmVmZXJlbmNlTGluZShzZWxlY3RPYmplY3QpXG4gICAgICAgICAgICByZWZlcmVuY2VMaW5lLmhhc0NvbnRyb2xzID0gdHJ1ZVxuICAgICAgICAgICAgQ29uc3RhbnRzLlJFQ1RfRElTQUJMRURfQ09OVFJPTFMuZm9yRWFjaCgoY29udHJvbCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlZmVyZW5jZUxpbmUuc2V0Q29udHJvbFZpc2libGUoY29udHJvbCwgZmFsc2UpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgcmVmZXJlbmNlTGluZS5vbignbW91c2Vkb3duJywgKCkgPT4ge1xuICAgICAgICAgICAgZHVwbGljYXRlUmVmZXJlbmNlTGluZSgpXG4gICAgICAgICAgICByZWZlcmVuY2VMaW5lLm9mZignbW91c2Vkb3duJylcbiAgICAgICAgfSlcblxuICAgICAgICBzZWxlY3RPYmplY3QucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZmlsbFJlZmVyZW5jZUxpbmUpXG4gICAgICAgIHNlbGVjdE9iamVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmaWxsUmVmZXJlbmNlTGluZSlcbiAgICB9XG5cbiAgICBjcmVhdGVTY2FsZWRMaW5lKG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3Qgc2NhbGUgPSAodGhpcy5zY2FsZS5zaGFwZS53aWR0aCAqIHRoaXMuc2NhbGUuc2hhcGUuc2NhbGVYKSAvIHRoaXMuc2NhbGUudmFsdWVcblxuICAgICAgICBvcHRpb25zLnRvcCA9IG9wdGlvbnMudG9wICogc2NhbGVcbiAgICAgICAgb3B0aW9ucy5sZWZ0ID0gb3B0aW9ucy5sZWZ0ICogc2NhbGVcbiAgICAgICAgb3B0aW9ucy53aWR0aCA9IG9wdGlvbnMud2lkdGggKiBzY2FsZVxuICAgICAgICBvcHRpb25zLmhlaWdodCA9IG9wdGlvbnMuc3Ryb2tlICogc2NhbGVcblxuICAgICAgICByZXR1cm4gbmV3IExpbmUob3B0aW9ucylcbiAgICB9XG5cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=