!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("fabric")):"function"==typeof define&&define.amd?define("fabricashape",["fabric"],e):"object"==typeof exports?exports.fabricashape=e(require("fabric")):t.fabricashape=e(t.fabric)}("undefined"!=typeof self?self:this,function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(e,n){e.exports=t},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Line=void 0;var i=n(0),o=n(2),r=i.fabric.util.createClass(i.fabric.Rect,{type:"line",components:[],hasControls:!0,initialize:function(t){var e=this;t||(t={}),this.callSuper("initialize",t),this.bodyFill=t.fill||"",t.hasOwnProperty("bodyFill")&&(this.bodyFill=t.bodyFill),this.bodyText=t.text||"",t.hasOwnProperty("bodyText")&&(this.bodyText=t.bodyText),o.Constants.RECT_DISABLED_CONTROLS.forEach(function(t){e.setControlVisible(t,!1)}),this.set("fill","transparent"),this.on({added:this._initComponents,modified:this._setComponentsPosition,scaling:this._setComponentsPosition,moving:this._setComponentsPosition,rotating:this._setComponentsPosition})},_initComponents:function(){this.text=new i.fabric.Text("",{visible:!1}),this.body=new i.fabric.Rect({width:this.width,height:this.height,top:this.top,left:this.left,fill:this.bodyFill}),this.components=[this.text,this.body],this._setupComponents(),this.setText(this.bodyText)},_setupComponents:function(){var t=this;this.components.forEach(function(e){e.set({excludeFromExport:!0,hasControls:!1,selectable:!1}),t.canvas.add(e),e.sendBackwards()})},_setComponentsPosition:function(){var t=this.height*this.scaleY,e=this.width*this.scaleX,n=this.getBoundingRect();this.text&&this.text.set({top:n.top+.5*(n.height-this.text.height),left:n.left+.5*(n.width-this.text.width)}),this.body.set({top:this.top,left:this.left,width:e,height:t,angle:this.angle})},getComponents:function(){return this.components},setText:function(t){this.bodyText=t,"m"!==t.slice(-1)&&(t+="m"),this.text.set({text:t}),this._setComponentsPosition()},_render:function(t){this.callSuper("_render",t)},toObject:function(){return i.fabric.util.object.extend(this.callSuper("toObject"),{bodyFill:this.get("bodyFill"),bodyText:this.get("bodyText")})}});e.Line=r,i.fabric.Line=r,i.fabric.Line.fromObject=function(t,e){return i.fabric.Object._fromObject("Line",t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Constants=void 0;e.Constants={RECT_DISABLED_CONTROLS:["tl","tr","bl","br","mt","mb"]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Arrowline",{enumerable:!0,get:function(){return i.Arrowline}}),Object.defineProperty(e,"Canvas",{enumerable:!0,get:function(){return o.Canvas}}),Object.defineProperty(e,"Line",{enumerable:!0,get:function(){return r.Line}}),Object.defineProperty(e,"Constants",{enumerable:!0,get:function(){return s.Constants}});var i=n(4),o=n(5),r=n(1),s=n(2)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Arrowline=void 0;var i=n(0),o=n(1),r=i.fabric.util.createClass(o.Line,{type:"arrowline",_initComponents:function(){this.text=new i.fabric.Text(this.bodyText,{backgroundColor:"white"}),this.body=new i.fabric.Rect({fill:this.bodyFill}),this.leftTriangle=new i.fabric.Triangle({fill:this.bodyFill}),this.rightTriangle=new i.fabric.Triangle({fill:this.bodyFill}),this._setComponentsPosition(),this.components=[this.body,this.leftTriangle,this.rightTriangle,this.text],this._setupComponents(),this.setText(this.bodyText)},_setComponentsPosition:function(){var t=Math.PI/180,e=this.height*this.scaleY,n=this.width*this.scaleX,i=Math.cos(this.angle*t),o=Math.sin(this.angle*t),r=this.getBoundingRect();this.text.set({top:r.top+.5*(r.height-this.text.height),left:r.left+.5*(r.width-this.text.width),fontSize:18}),this.body.set({top:this.top+e*o+e/4*i,left:this.left+e*i-e/4*o,width:n-2*e,height:e/2,angle:this.angle}),this.leftTriangle.set({top:this.top+e*i,left:this.left-e*o,width:e,height:e,angle:this.angle-90}),this.rightTriangle.set({top:this.top+n*o,left:this.left+n*i,width:e,height:e,angle:this.angle+90})}});e.Arrowline=r,i.fabric.Arrowline=r,i.fabric.Arrowline.fromObject=function(t,e){return i.fabric.Object._fromObject("Arrowline",t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Canvas=void 0;var i=n(0),o=n(2),r=n(1);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var h=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))).domElemendId=t,n.scale={value:null,shape:null},n.backgroundImage=null,n}var n,s,h;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,i.fabric.Canvas),n=e,(s=[{key:"addImage",value:function(t){var e=this,n=new FileReader;n.onload=function(){var t=document.createElement("img");t.src=n.result,e.backgroundImage=new i.fabric.Image(t),e.backgroundImage.scale(e.height/e.backgroundImage.height),e.add(e.backgroundImage),e.renderAll()},n.readAsDataURL(t)}},{key:"lockImage",value:function(){this.backgroundImage.sendToBack(),this.backgroundImage.hasControls=!1,this.backgroundImage.selectable=!1,this.discardActiveObject(),this.renderAll()}},{key:"_lockObjectsToBoundaries",value:function(){this.on("object:moving",function(t){var e=t.target;e.currentHeight>this.height||e.currentWidth>this.width||(e.setCoords(),(e.getBoundingRect().top<0||e.getBoundingRect().left<0)&&(e.top=Math.max(e.top,e.top-e.getBoundingRect().top),e.left=Math.max(e.left,e.left-e.getBoundingRect().left)),(e.getBoundingRect().top+e.getBoundingRect().height>this.height||e.getBoundingRect().left+e.getBoundingRect().width>this.width)&&(e.top=Math.min(e.top,this.height-e.getBoundingRect().height+e.top-e.getBoundingRect().top),e.left=Math.min(e.left,this.width-e.getBoundingRect().width+e.left-e.getBoundingRect().left)))})}},{key:"setScale",value:function(t){t.shape&&(this.scale.shape=t.shape),t.value&&(this.scale.value=t.value)}},{key:"getScale",value:function(){return this.scale}},{key:"lockScale",value:function(){this.scale.shape.hasControls=!1}},{key:"listToSelectDOM",value:function(t){var e=document.getElementById(this.domElemendId),n=document.createElement("select");n.id="fabricashapeShapeChoices",e.parentElement.appendChild(n);for(var i=0;i<t.length;i++){var o=document.createElement("option");o.value=t[i].label,o.text=t[i].label,o.style.backgroundColor=t[i].color,n.appendChild(o)}return n}},{key:"setShapeChoices",value:function(t){var e=this.listToSelectDOM(t);this.createReferenceLine(e)}},{key:"createReferenceLine",value:function(t){var e=this,n=new i.fabric.Rect({top:5,left:5,width:80,height:17,fill:t.options[t.selectedIndex].style.backgroundColor});this.add(n),this.item(this.size()-1).hasControls=!1,this.requestRenderAll();var r=function(){e.item(e.size()-1).set("fill",t.options[t.selectedIndex].style.backgroundColor),e.renderAll()};n.on("mousedown",function(){e.createReferenceLine(t),n.hasControls=!0,o.Constants.RECT_DISABLED_CONTROLS.forEach(function(t){n.setControlVisible(t,!1)}),n.off("mousedown")}),t.removeEventListener("change",r),t.addEventListener("change",r)}},{key:"createScaledLine",value:function(t){var e=this.scale.shape.width*this.scale.shape.scaleX/this.scale.value;return t.top=t.top*e,t.left=t.left*e,t.width=t.width*e,t.height=t.stroke*e,new r.Line(t)}}])&&a(n.prototype,s),h&&a(n,h),e}();e.Canvas=h}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvZXh0ZXJuYWwgXCJmYWJyaWNcIiIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvbGluZS5qcyIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvYXJyb3dsaW5lLmpzIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS8uL3NyYy9jYW52YXMuanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIl9mYWJyaWMiLCJfY29uc3RhbnRzIiwiTGluZSIsImZhYnJpYyIsInV0aWwiLCJjcmVhdGVDbGFzcyIsIlJlY3QiLCJ0eXBlIiwiY29tcG9uZW50cyIsImhhc0NvbnRyb2xzIiwiaW5pdGlhbGl6ZSIsIm9wdGlvbnMiLCJfdGhpcyIsImNhbGxTdXBlciIsImJvZHlGaWxsIiwiZmlsbCIsImJvZHlUZXh0IiwidGV4dCIsIkNvbnN0YW50cyIsIlJFQ1RfRElTQUJMRURfQ09OVFJPTFMiLCJmb3JFYWNoIiwiY29udHJvbCIsInNldENvbnRyb2xWaXNpYmxlIiwic2V0Iiwib24iLCJhZGRlZCIsIl9pbml0Q29tcG9uZW50cyIsIm1vZGlmaWVkIiwiX3NldENvbXBvbmVudHNQb3NpdGlvbiIsInNjYWxpbmciLCJtb3ZpbmciLCJyb3RhdGluZyIsIlRleHQiLCJ2aXNpYmxlIiwiYm9keSIsIndpZHRoIiwiaGVpZ2h0IiwidG9wIiwibGVmdCIsIl9zZXR1cENvbXBvbmVudHMiLCJzZXRUZXh0IiwiX3RoaXMyIiwiY29tcG9uZW50IiwiZXhjbHVkZUZyb21FeHBvcnQiLCJzZWxlY3RhYmxlIiwiY2FudmFzIiwiYWRkIiwic2VuZEJhY2t3YXJkcyIsInNjYWxlWSIsInNjYWxlWCIsImJvdW5kaW5nUmVjdCIsImdldEJvdW5kaW5nUmVjdCIsImFuZ2xlIiwiZ2V0Q29tcG9uZW50cyIsInNsaWNlIiwiX3JlbmRlciIsImN0eCIsInRvT2JqZWN0IiwiZXh0ZW5kIiwiZnJvbU9iamVjdCIsImNhbGxiYWNrIiwiX2Zyb21PYmplY3QiLCJfYXJyb3dsaW5lIiwiX2NhbnZhcyIsIl9saW5lIiwiQXJyb3dsaW5lIiwiYmFja2dyb3VuZENvbG9yIiwibGVmdFRyaWFuZ2xlIiwiVHJpYW5nbGUiLCJyaWdodFRyaWFuZ2xlIiwiZGVncmVlc1RvUmFkaWFuc1JhdGlvIiwiTWF0aCIsIlBJIiwiY29zVGV0YSIsImNvcyIsInNpblRldGEiLCJzaW4iLCJmb250U2l6ZSIsIkNhbnZhcyIsImRvbUVsZW1lbmRJZCIsIl9jbGFzc0NhbGxDaGVjayIsIl9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIiwiX19wcm90b19fIiwiZ2V0UHJvdG90eXBlT2YiLCJzY2FsZSIsInNoYXBlIiwiYmFja2dyb3VuZEltYWdlIiwiaW1hZ2VGaWxlIiwicmVhZGVyIiwiRmlsZVJlYWRlciIsIm9ubG9hZCIsImltZyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNyYyIsInJlc3VsdCIsIkltYWdlIiwicmVuZGVyQWxsIiwicmVhZEFzRGF0YVVSTCIsInNlbmRUb0JhY2siLCJkaXNjYXJkQWN0aXZlT2JqZWN0IiwiZSIsIm9iaiIsInRhcmdldCIsImN1cnJlbnRIZWlnaHQiLCJjdXJyZW50V2lkdGgiLCJzZXRDb29yZHMiLCJtYXgiLCJtaW4iLCJzY2FsZURlZmluaXRpb24iLCJjaG9pY2VzIiwiY2FudmFzaG9sZGVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJzZWxlY3RMaXN0IiwiaWQiLCJwYXJlbnRFbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJsZW5ndGgiLCJvcHRpb24iLCJsYWJlbCIsInN0eWxlIiwiY29sb3IiLCJzZWxlY3RPYmplY3QiLCJsaXN0VG9TZWxlY3RET00iLCJjcmVhdGVSZWZlcmVuY2VMaW5lIiwiX3RoaXMzIiwicmVmZXJlbmNlTGluZSIsInNlbGVjdGVkSW5kZXgiLCJpdGVtIiwic2l6ZSIsInJlcXVlc3RSZW5kZXJBbGwiLCJmaWxsUmVmZXJlbmNlTGluZSIsIm9mZiIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwic3Ryb2tlIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxHQUNBLGlCQUFBQyxTQUFBLGlCQUFBQyxPQUNBQSxPQUFBRCxRQUFBRCxFQUFBRyxRQUFBLFdBQ0EsbUJBQUFDLGVBQUFDLElBQ0FELE9BQUEsMEJBQUFKLEdBQ0EsaUJBQUFDLFFBQ0FBLFFBQUEsYUFBQUQsRUFBQUcsUUFBQSxXQUVBSixFQUFBLGFBQUFDLEVBQUFELEVBQUEsUUFSQSxDQVNDLG9CQUFBTyxVQUFBQyxLQUFBLFNBQUFDLEdBQ0QsbUJDVEEsSUFBQUMsRUFBQSxHQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBVixRQUdBLElBQUFD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QU1uRyxNQU85RSxPQUxBMEIsRUFBUTBCLElBQU0xQixFQUFRMEIsSUFBTStDLEVBQzVCekUsRUFBUTJCLEtBQU8zQixFQUFRMkIsS0FBTzhDLEVBQzlCekUsRUFBUXdCLE1BQVF4QixFQUFRd0IsTUFBUWlELEVBQ2hDekUsRUFBUXlCLE9BQVN6QixFQUFRNEgsT0FBU25ELEVBRTNCLElBQUFwQixFQUFBOUQsS0FBU1MiLCJmaWxlIjoiZmFicmljYXNoYXBlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZShcImZhYnJpY1wiKSk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShcImZhYnJpY2FzaGFwZVwiLCBbXCJmYWJyaWNcIl0sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiZmFicmljYXNoYXBlXCJdID0gZmFjdG9yeShyZXF1aXJlKFwiZmFicmljXCIpKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJmYWJyaWNhc2hhcGVcIl0gPSBmYWN0b3J5KHJvb3RbXCJmYWJyaWNcIl0pO1xufSkodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHRoaXMsIGZ1bmN0aW9uKF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzBfXykge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAzKTtcbiIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fOyIsImltcG9ydCB7ZmFicmljfSBmcm9tICdmYWJyaWMnXG5pbXBvcnQge0NvbnN0YW50c30gZnJvbSAnLi9jb25zdGFudHMnXG5cbmV4cG9ydCBjb25zdCBMaW5lID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLlJlY3QsIHtcblxuICAgIHR5cGU6ICdsaW5lJyxcbiAgICBjb21wb25lbnRzOiBbXSxcbiAgICBoYXNDb250cm9sczogdHJ1ZSxcblxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7IH0pO1xuICAgICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMuYm9keUZpbGwgPSBvcHRpb25zLmZpbGwgfHwgJydcbiAgICAgICAgaWYgKG9wdGlvbnMuaGFzT3duUHJvcGVydHkoJ2JvZHlGaWxsJykpIHtcbiAgICAgICAgICAgIHRoaXMuYm9keUZpbGwgPSBvcHRpb25zLmJvZHlGaWxsXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ib2R5VGV4dCA9IG9wdGlvbnMudGV4dCB8fCAnJ1xuICAgICAgICBpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgnYm9keVRleHQnKSkge1xuICAgICAgICAgICAgdGhpcy5ib2R5VGV4dCA9IG9wdGlvbnMuYm9keVRleHRcbiAgICAgICAgfVxuICAgICAgICBDb25zdGFudHMuUkVDVF9ESVNBQkxFRF9DT05UUk9MUy5mb3JFYWNoKChjb250cm9sKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldENvbnRyb2xWaXNpYmxlKGNvbnRyb2wsIGZhbHNlKVxuICAgICAgICB9KVxuICAgICAgICB0aGlzLnNldCgnZmlsbCcsICd0cmFuc3BhcmVudCcpXG5cbiAgICAgICAgdGhpcy5vbihcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAnYWRkZWQnOiB0aGlzLl9pbml0Q29tcG9uZW50cyxcbiAgICAgICAgICAgICAgICAnbW9kaWZpZWQnOiB0aGlzLl9zZXRDb21wb25lbnRzUG9zaXRpb24sXG4gICAgICAgICAgICAgICAgJ3NjYWxpbmcnOiB0aGlzLl9zZXRDb21wb25lbnRzUG9zaXRpb24sXG4gICAgICAgICAgICAgICAgJ21vdmluZyc6IHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbixcbiAgICAgICAgICAgICAgICAncm90YXRpbmcnOiB0aGlzLl9zZXRDb21wb25lbnRzUG9zaXRpb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgIH0sXG5cbiAgICBfaW5pdENvbXBvbmVudHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy50ZXh0ID0gbmV3IGZhYnJpYy5UZXh0KCcnLCB7dmlzaWJsZTogZmFsc2V9KVxuICAgICAgICB0aGlzLmJvZHkgPSBuZXcgZmFicmljLlJlY3Qoe1xuICAgICAgICAgICAgd2lkdGg6IHRoaXMud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0LFxuICAgICAgICAgICAgdG9wOiB0aGlzLnRvcCxcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMubGVmdCxcbiAgICAgICAgICAgIGZpbGw6IHRoaXMuYm9keUZpbGxcbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5jb21wb25lbnRzID0gW3RoaXMudGV4dCwgdGhpcy5ib2R5XVxuXG4gICAgICAgIHRoaXMuX3NldHVwQ29tcG9uZW50cygpXG4gICAgICAgIHRoaXMuc2V0VGV4dCh0aGlzLmJvZHlUZXh0KVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBfc2V0dXBDb21wb25lbnRzOiBhZGQgdGhlIGNvbXBvbmVudCB0byB0aGUgY2FudmFzIGFuZCBzZXQgc29tZSBvcHRpb25zXG4gICAgICogdG8gYXZvaWQgdGhlbSBmcm9tIGJlaW5nIGV4cG9ydGVkL3NlbGVjdGVkXG4gICAgICovXG4gICAgX3NldHVwQ29tcG9uZW50czogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmNvbXBvbmVudHMuZm9yRWFjaCgoY29tcG9uZW50KSA9PiB7XG4gICAgICAgICAgICBjb21wb25lbnQuc2V0KHtcbiAgICAgICAgICAgICAgICBleGNsdWRlRnJvbUV4cG9ydDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBoYXNDb250cm9sczogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2VsZWN0YWJsZTogZmFsc2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5hZGQoY29tcG9uZW50KVxuICAgICAgICAgICAgY29tcG9uZW50LnNlbmRCYWNrd2FyZHMoKVxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICBfc2V0Q29tcG9uZW50c1Bvc2l0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuaGVpZ2h0ICogdGhpcy5zY2FsZVksXG4gICAgICAgICAgICB3aWR0aCA9IHRoaXMud2lkdGggKiB0aGlzLnNjYWxlWCxcbiAgICAgICAgICAgIGJvdW5kaW5nUmVjdCA9IHRoaXMuZ2V0Qm91bmRpbmdSZWN0KClcblxuICAgICAgICBpZiAodGhpcy50ZXh0KSB7XG4gICAgICAgICAgICB0aGlzLnRleHQuc2V0KHtcbiAgICAgICAgICAgICAgICB0b3A6IGJvdW5kaW5nUmVjdC50b3AgKyAwLjUgKiAoYm91bmRpbmdSZWN0LmhlaWdodCAtIHRoaXMudGV4dC5oZWlnaHQpLFxuICAgICAgICAgICAgICAgIGxlZnQ6IGJvdW5kaW5nUmVjdC5sZWZ0ICsgMC41ICogKGJvdW5kaW5nUmVjdC53aWR0aCAtIHRoaXMudGV4dC53aWR0aClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmJvZHkuc2V0KHtcbiAgICAgICAgICAgIHRvcDogdGhpcy50b3AsXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLmxlZnQsXG4gICAgICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgIGFuZ2xlOiB0aGlzLmFuZ2xlXG4gICAgICAgIH0pXG5cbiAgICB9LFxuXG4gICAgZ2V0Q29tcG9uZW50czogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21wb25lbnRzXG4gICAgfSxcblxuICAgIHNldFRleHQ6IGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgIHRoaXMuYm9keVRleHQgPSB0ZXh0XG4gICAgICAgIGlmICh0ZXh0LnNsaWNlKC0xKSAhPT0gJ20nKSB7XG4gICAgICAgICAgICB0ZXh0ICs9ICdtJ1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudGV4dC5zZXQoe1xuICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICB9KVxuICAgICAgICB0aGlzLl9zZXRDb21wb25lbnRzUG9zaXRpb24oKVxuICAgIH0sXG5cbiAgICBfcmVuZGVyOiBmdW5jdGlvbiAoY3R4KSB7XG4gICAgICAgIHRoaXMuY2FsbFN1cGVyKCdfcmVuZGVyJywgY3R4KTtcbiAgICB9LFxuXG4gICAgdG9PYmplY3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQodGhpcy5jYWxsU3VwZXIoJ3RvT2JqZWN0JyksIHtcbiAgICAgICAgICAgIGJvZHlGaWxsOiB0aGlzLmdldCgnYm9keUZpbGwnKSxcbiAgICAgICAgICAgIGJvZHlUZXh0OiB0aGlzLmdldCgnYm9keVRleHQnKVxuICAgICAgICB9KTtcbiAgICB9XG5cbn0pXG5cbmZhYnJpYy5MaW5lID0gTGluZVxuXG5mYWJyaWMuTGluZS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gZmFicmljLk9iamVjdC5fZnJvbU9iamVjdCgnTGluZScsIG9iamVjdCwgY2FsbGJhY2spO1xufTtcbiIsIi8vIGNvbnRyb2xzOiAndGwnLCAndHInLCAnYnInLCAnYmwnLCAnbWwnLCAnbXQnLCAnbXInLCAnbWInLCAnbXRyJ1xuZXhwb3J0IGNvbnN0IENvbnN0YW50cyA9IHtcbiAgICBSRUNUX0RJU0FCTEVEX0NPTlRST0xTOiBbICd0bCcsICd0cicsICdibCcsICdicicsICdtdCcsICdtYicgXVxufVxuIiwiaW1wb3J0IHtBcnJvd2xpbmV9IGZyb20gJy4vYXJyb3dsaW5lLmpzJztcbmltcG9ydCB7Q2FudmFzfSBmcm9tICcuL2NhbnZhcy5qcyc7XG5pbXBvcnQge0xpbmV9IGZyb20gJy4vbGluZS5qcyc7XG5pbXBvcnQge0NvbnN0YW50c30gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuZXhwb3J0IHtBcnJvd2xpbmUsIENhbnZhcywgTGluZSwgQ29uc3RhbnRzfTtcbiIsImltcG9ydCB7ZmFicmljfSBmcm9tICdmYWJyaWMnXG5pbXBvcnQge0xpbmV9IGZyb20gJy4vbGluZSdcblxuLyoqXG4gKiBBbiBBcnJvd2xpbmUgaXMgYSBncm91cCB0aGF0IGxvb2tzIGxpa2UgYSBkb3VibGUgYXJyb3dlZCBsaW5lOlxuICogICAgICAgPC0tLS0tLS0+XG4gKi9cbmV4cG9ydCBjb25zdCBBcnJvd2xpbmUgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhMaW5lLCB7XG5cbiAgICB0eXBlOiAnYXJyb3dsaW5lJyxcblxuICAgIF9pbml0Q29tcG9uZW50czogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnRleHQgPSBuZXcgZmFicmljLlRleHQodGhpcy5ib2R5VGV4dCwge2JhY2tncm91bmRDb2xvcjogJ3doaXRlJ30pXG4gICAgICAgIHRoaXMuYm9keSA9IG5ldyBmYWJyaWMuUmVjdCh7ZmlsbDogdGhpcy5ib2R5RmlsbH0pXG4gICAgICAgIHRoaXMubGVmdFRyaWFuZ2xlID0gbmV3IGZhYnJpYy5UcmlhbmdsZSh7ZmlsbDogdGhpcy5ib2R5RmlsbH0pXG4gICAgICAgIHRoaXMucmlnaHRUcmlhbmdsZSA9IG5ldyBmYWJyaWMuVHJpYW5nbGUoe2ZpbGw6IHRoaXMuYm9keUZpbGx9KVxuXG4gICAgICAgIHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbigpXG5cbiAgICAgICAgdGhpcy5jb21wb25lbnRzID0gW3RoaXMuYm9keSwgdGhpcy5sZWZ0VHJpYW5nbGUsIHRoaXMucmlnaHRUcmlhbmdsZSwgdGhpcy50ZXh0XVxuXG4gICAgICAgIHRoaXMuX3NldHVwQ29tcG9uZW50cygpXG4gICAgICAgIHRoaXMuc2V0VGV4dCh0aGlzLmJvZHlUZXh0KVxuICAgIH0sXG5cbiAgICBfc2V0Q29tcG9uZW50c1Bvc2l0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGRlZ3JlZXNUb1JhZGlhbnNSYXRpbyA9IE1hdGguUEkgLyAxODAsXG4gICAgICAgICAgICBoZWlnaHQgPSB0aGlzLmhlaWdodCAqIHRoaXMuc2NhbGVZLFxuICAgICAgICAgICAgd2lkdGggPSB0aGlzLndpZHRoICogdGhpcy5zY2FsZVgsXG4gICAgICAgICAgICBjb3NUZXRhID0gTWF0aC5jb3ModGhpcy5hbmdsZSAqIGRlZ3JlZXNUb1JhZGlhbnNSYXRpbyksXG4gICAgICAgICAgICBzaW5UZXRhID0gTWF0aC5zaW4odGhpcy5hbmdsZSAqIGRlZ3JlZXNUb1JhZGlhbnNSYXRpbyksXG4gICAgICAgICAgICBib3VuZGluZ1JlY3QgPSB0aGlzLmdldEJvdW5kaW5nUmVjdCgpXG5cbiAgICAgICAgdGhpcy50ZXh0LnNldCh7XG4gICAgICAgICAgICB0b3A6IGJvdW5kaW5nUmVjdC50b3AgKyAwLjUgKiAoYm91bmRpbmdSZWN0LmhlaWdodCAtIHRoaXMudGV4dC5oZWlnaHQpLFxuICAgICAgICAgICAgbGVmdDogYm91bmRpbmdSZWN0LmxlZnQgKyAwLjUgKiAoYm91bmRpbmdSZWN0LndpZHRoIC0gdGhpcy50ZXh0LndpZHRoKSxcbiAgICAgICAgICAgIGZvbnRTaXplOiAxOFxuICAgICAgICB9KVxuXG4gICAgICAgIHRoaXMuYm9keS5zZXQoe1xuICAgICAgICAgICAgdG9wOiB0aGlzLnRvcCArIGhlaWdodCAqIHNpblRldGEgKyAoaGVpZ2h0IC8gNCkgKiBjb3NUZXRhLFxuICAgICAgICAgICAgbGVmdDogdGhpcy5sZWZ0ICsgaGVpZ2h0ICogY29zVGV0YSAtIChoZWlnaHQgLyA0KSAqIHNpblRldGEsXG4gICAgICAgICAgICB3aWR0aDogd2lkdGggLSAyICogaGVpZ2h0LFxuICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQgLyAyLFxuICAgICAgICAgICAgYW5nbGU6IHRoaXMuYW5nbGVcbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLmxlZnRUcmlhbmdsZS5zZXQoe1xuICAgICAgICAgICAgdG9wOiB0aGlzLnRvcCArIGhlaWdodCAqIGNvc1RldGEsXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLmxlZnQgLSBoZWlnaHQgKiBzaW5UZXRhLFxuICAgICAgICAgICAgd2lkdGg6IGhlaWdodCxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICAgICAgYW5nbGU6IHRoaXMuYW5nbGUgLSA5MFxuICAgICAgICB9KVxuXG4gICAgICAgIHRoaXMucmlnaHRUcmlhbmdsZS5zZXQoe1xuICAgICAgICAgICAgdG9wOiB0aGlzLnRvcCArIHdpZHRoICogc2luVGV0YSxcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMubGVmdCArIHdpZHRoICogY29zVGV0YSxcbiAgICAgICAgICAgIHdpZHRoOiBoZWlnaHQsXG4gICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgIGFuZ2xlOiB0aGlzLmFuZ2xlICsgOTBcbiAgICAgICAgfSlcbiAgICB9XG5cbn0pXG5cbmZhYnJpYy5BcnJvd2xpbmUgPSBBcnJvd2xpbmVcblxuZmFicmljLkFycm93bGluZS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gZmFicmljLk9iamVjdC5fZnJvbU9iamVjdCgnQXJyb3dsaW5lJywgb2JqZWN0LCBjYWxsYmFjayk7XG59O1xuIiwiaW1wb3J0IHtmYWJyaWN9IGZyb20gJ2ZhYnJpYydcbmltcG9ydCB7Q29uc3RhbnRzfSBmcm9tICcuL2NvbnN0YW50cydcbmltcG9ydCB7TGluZX0gZnJvbSAnLi9saW5lJ1xuXG5leHBvcnQgY2xhc3MgQ2FudmFzIGV4dGVuZHMgZmFicmljLkNhbnZhcyB7XG5cbiAgICBjb25zdHJ1Y3Rvcihkb21FbGVtZW5kSWQpIHtcbiAgICAgICAgc3VwZXIoZG9tRWxlbWVuZElkKVxuICAgICAgICB0aGlzLmRvbUVsZW1lbmRJZCA9IGRvbUVsZW1lbmRJZFxuICAgICAgICB0aGlzLnNjYWxlID0ge3ZhbHVlOiBudWxsLCBzaGFwZTogbnVsbH1cbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UgPSBudWxsXG4gICAgICAgIC8vIHRoaXMuX2xvY2tPYmplY3RzVG9Cb3VuZGFyaWVzKClcbiAgICB9XG5cbiAgICBhZGRJbWFnZShpbWFnZUZpbGUpIHtcbiAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxuXG4gICAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKVxuXG4gICAgICAgICAgICBpbWcuc3JjID0gcmVhZGVyLnJlc3VsdFxuXG4gICAgICAgICAgICB0aGlzLmJhY2tncm91bmRJbWFnZSA9IG5ldyBmYWJyaWMuSW1hZ2UoaW1nKVxuICAgICAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2Uuc2NhbGUodGhpcy5oZWlnaHQgLyB0aGlzLmJhY2tncm91bmRJbWFnZS5oZWlnaHQpXG4gICAgICAgICAgICB0aGlzLmFkZCh0aGlzLmJhY2tncm91bmRJbWFnZSlcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQWxsKClcbiAgICAgICAgfTtcblxuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpbWFnZUZpbGUpO1xuICAgIH1cblxuICAgIGxvY2tJbWFnZSgpIHtcbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2Uuc2VuZFRvQmFjaygpXG4gICAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLmhhc0NvbnRyb2xzID0gZmFsc2VcbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2Uuc2VsZWN0YWJsZSA9IGZhbHNlXG4gICAgICAgIHRoaXMuZGlzY2FyZEFjdGl2ZU9iamVjdCgpO1xuICAgICAgICB0aGlzLnJlbmRlckFsbCgpXG4gICAgfVxuXG4gICAgX2xvY2tPYmplY3RzVG9Cb3VuZGFyaWVzKCkge1xuICAgICAgICB0aGlzLm9uKCdvYmplY3Q6bW92aW5nJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHZhciBvYmogPSBlLnRhcmdldDtcblxuICAgICAgICAgICAgLy8gaWYgb2JqZWN0IGlzIHRvbyBiaWcgaWdub3JlXG4gICAgICAgICAgICBpZiAob2JqLmN1cnJlbnRIZWlnaHQgPiB0aGlzLmhlaWdodCB8fCBvYmouY3VycmVudFdpZHRoID4gdGhpcy53aWR0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9iai5zZXRDb29yZHMoKTtcbiAgICAgICAgICAgIC8vIHRvcC1sZWZ0ICBjb3JuZXJcbiAgICAgICAgICAgIGlmIChvYmouZ2V0Qm91bmRpbmdSZWN0KCkudG9wIDwgMCB8fCBvYmouZ2V0Qm91bmRpbmdSZWN0KCkubGVmdCA8IDApIHtcbiAgICAgICAgICAgICAgICBvYmoudG9wID0gTWF0aC5tYXgob2JqLnRvcCwgb2JqLnRvcCAtIG9iai5nZXRCb3VuZGluZ1JlY3QoKS50b3ApO1xuICAgICAgICAgICAgICAgIG9iai5sZWZ0ID0gTWF0aC5tYXgob2JqLmxlZnQsIG9iai5sZWZ0IC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLmxlZnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gYm90LXJpZ2h0IGNvcm5lclxuICAgICAgICAgICAgaWYgKG9iai5nZXRCb3VuZGluZ1JlY3QoKS50b3AgKyBvYmouZ2V0Qm91bmRpbmdSZWN0KCkuaGVpZ2h0ID4gdGhpcy5oZWlnaHQgfHxcbiAgICAgICAgICAgICAgICAgICAgb2JqLmdldEJvdW5kaW5nUmVjdCgpLmxlZnQgKyBvYmouZ2V0Qm91bmRpbmdSZWN0KCkud2lkdGggPiB0aGlzLndpZHRoKSB7XG4gICAgICAgICAgICAgICAgb2JqLnRvcCA9IE1hdGgubWluKG9iai50b3AsIHRoaXMuaGVpZ2h0IC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLmhlaWdodCArXG4gICAgICAgICAgICAgICAgICAgIG9iai50b3AgLSBvYmouZ2V0Qm91bmRpbmdSZWN0KCkudG9wKTtcbiAgICAgICAgICAgICAgICBvYmoubGVmdCA9IE1hdGgubWluKG9iai5sZWZ0LCB0aGlzLndpZHRoIC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLndpZHRoICtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmxlZnQgLSBvYmouZ2V0Qm91bmRpbmdSZWN0KCkubGVmdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHNldFNjYWxlKHNjYWxlRGVmaW5pdGlvbikge1xuICAgICAgICBpZiAoc2NhbGVEZWZpbml0aW9uLnNoYXBlKSB7XG4gICAgICAgICAgICB0aGlzLnNjYWxlLnNoYXBlID0gc2NhbGVEZWZpbml0aW9uLnNoYXBlXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNjYWxlRGVmaW5pdGlvbi52YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zY2FsZS52YWx1ZSA9IHNjYWxlRGVmaW5pdGlvbi52YWx1ZVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0U2NhbGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNjYWxlXG4gICAgfVxuXG4gICAgbG9ja1NjYWxlKCkge1xuICAgICAgICB0aGlzLnNjYWxlLnNoYXBlLmhhc0NvbnRyb2xzID0gZmFsc2VcbiAgICB9XG5cbiAgICAvKlxuICAgICAqIEBwYXJhbSBjaG9pY2VzOiBhIGxpc3Qgb2YgKGxhYmVsLCBjb2xvcilcbiAgICAgKiAgZXhhbXBsZTogW1xuICAgICAqICAgICAge2xhYmVsOiAnbGFiZWwxJywgY29sb3I6ICdibHVlJ30sXG4gICAgICogICAgICB7bGFiZWw6ICdsYWJlbDInLCBjb2xvcjogJ3JnYmEoMjU1LDAsMCwwLjUpJ31cbiAgICAgKiAgIF1cbiAgICAgKiBAcmV0dXJuIGEgRE9NIHNlbGVjdCBvYmplY3Qgd2l0aCBjb3JyZXNwb25kaW5nIG9wdGlvbnNcbiAgICAgKi9cbiAgICBsaXN0VG9TZWxlY3RET00oY2hvaWNlcykge1xuICAgICAgICBjb25zdCBjYW52YXNob2xkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmRvbUVsZW1lbmRJZClcblxuICAgICAgICAvLyBDcmVhdGUgYW5kIGFwcGVuZCBzZWxlY3QgbGlzdFxuICAgICAgICBjb25zdCBzZWxlY3RMaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VsZWN0JylcblxuICAgICAgICBzZWxlY3RMaXN0LmlkID0gJ2ZhYnJpY2FzaGFwZVNoYXBlQ2hvaWNlcydcbiAgICAgICAgY2FudmFzaG9sZGVyLnBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoc2VsZWN0TGlzdClcblxuICAgICAgICAvLyBDcmVhdGUgYW5kIGFwcGVuZCB0aGUgb3B0aW9uc1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNob2ljZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpXG5cbiAgICAgICAgICAgIG9wdGlvbi52YWx1ZSA9IGNob2ljZXNbaV0ubGFiZWxcbiAgICAgICAgICAgIG9wdGlvbi50ZXh0ID0gY2hvaWNlc1tpXS5sYWJlbFxuICAgICAgICAgICAgb3B0aW9uLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNob2ljZXNbaV0uY29sb3JcbiAgICAgICAgICAgIHNlbGVjdExpc3QuYXBwZW5kQ2hpbGQob3B0aW9uKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZWxlY3RMaXN0XG4gICAgfVxuXG4gICAgc2V0U2hhcGVDaG9pY2VzKGNob2ljZXMpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0T2JqZWN0ID0gdGhpcy5saXN0VG9TZWxlY3RET00oY2hvaWNlcylcblxuICAgICAgICB0aGlzLmNyZWF0ZVJlZmVyZW5jZUxpbmUoc2VsZWN0T2JqZWN0KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBsaW5lIHVzZXIgY2FuIGNsaWNrIG9uIHRvIGR1cGxpY2F0ZSBpdCBhbmQgdXNlIHRoZSBkdXBsaWNhdGUgaW50byB0aGUgc2NlbmUuXG4gICAgICovXG4gICAgY3JlYXRlUmVmZXJlbmNlTGluZShzZWxlY3RPYmplY3QpIHtcbiAgICAgICAgY29uc3QgcmVmZXJlbmNlTGluZSA9IG5ldyBmYWJyaWMuUmVjdCh7XG4gICAgICAgICAgICB0b3A6IDUsIGxlZnQ6IDUsIHdpZHRoOiA4MCwgaGVpZ2h0OiAxNyxcbiAgICAgICAgICAgIGZpbGw6IHNlbGVjdE9iamVjdC5vcHRpb25zW3NlbGVjdE9iamVjdC5zZWxlY3RlZEluZGV4XS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3JcbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLmFkZChyZWZlcmVuY2VMaW5lKVxuICAgICAgICB0aGlzLml0ZW0odGhpcy5zaXplKCkgLSAxKS5oYXNDb250cm9scyA9IGZhbHNlXG4gICAgICAgIHRoaXMucmVxdWVzdFJlbmRlckFsbCgpXG5cbiAgICAgICAgY29uc3QgZmlsbFJlZmVyZW5jZUxpbmUgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzXG4gICAgICAgICAgICAgICAgLml0ZW0odGhpcy5zaXplKCkgLSAxKVxuICAgICAgICAgICAgICAgIC5zZXQoJ2ZpbGwnLCBzZWxlY3RPYmplY3Qub3B0aW9uc1tzZWxlY3RPYmplY3Quc2VsZWN0ZWRJbmRleF0uc3R5bGUuYmFja2dyb3VuZENvbG9yKVxuICAgICAgICAgICAgdGhpcy5yZW5kZXJBbGwoKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZHVwbGljYXRlUmVmZXJlbmNlTGluZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlUmVmZXJlbmNlTGluZShzZWxlY3RPYmplY3QpXG4gICAgICAgICAgICByZWZlcmVuY2VMaW5lLmhhc0NvbnRyb2xzID0gdHJ1ZVxuICAgICAgICAgICAgQ29uc3RhbnRzLlJFQ1RfRElTQUJMRURfQ09OVFJPTFMuZm9yRWFjaCgoY29udHJvbCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlZmVyZW5jZUxpbmUuc2V0Q29udHJvbFZpc2libGUoY29udHJvbCwgZmFsc2UpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgcmVmZXJlbmNlTGluZS5vbignbW91c2Vkb3duJywgKCkgPT4ge1xuICAgICAgICAgICAgZHVwbGljYXRlUmVmZXJlbmNlTGluZSgpXG4gICAgICAgICAgICByZWZlcmVuY2VMaW5lLm9mZignbW91c2Vkb3duJylcbiAgICAgICAgfSlcblxuICAgICAgICBzZWxlY3RPYmplY3QucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZmlsbFJlZmVyZW5jZUxpbmUpXG4gICAgICAgIHNlbGVjdE9iamVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmaWxsUmVmZXJlbmNlTGluZSlcbiAgICB9XG5cbiAgICBjcmVhdGVTY2FsZWRMaW5lKG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3Qgc2NhbGUgPSAodGhpcy5zY2FsZS5zaGFwZS53aWR0aCAqIHRoaXMuc2NhbGUuc2hhcGUuc2NhbGVYKSAvIHRoaXMuc2NhbGUudmFsdWVcblxuICAgICAgICBvcHRpb25zLnRvcCA9IG9wdGlvbnMudG9wICogc2NhbGVcbiAgICAgICAgb3B0aW9ucy5sZWZ0ID0gb3B0aW9ucy5sZWZ0ICogc2NhbGVcbiAgICAgICAgb3B0aW9ucy53aWR0aCA9IG9wdGlvbnMud2lkdGggKiBzY2FsZVxuICAgICAgICBvcHRpb25zLmhlaWdodCA9IG9wdGlvbnMuc3Ryb2tlICogc2NhbGVcblxuICAgICAgICByZXR1cm4gbmV3IExpbmUob3B0aW9ucylcbiAgICB9XG5cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=