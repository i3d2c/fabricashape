!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("fabric")):"function"==typeof define&&define.amd?define("fabricashape",["fabric"],e):"object"==typeof exports?exports.fabricashape=e(require("fabric")):t.fabricashape=e(t.fabric)}("undefined"!=typeof self?self:this,(function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(e,n){e.exports=t},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Line=void 0;var i=n(0),o=n(2),s=i.fabric.util.createClass(i.fabric.Rect,{type:"line",components:[],hasControls:!0,initialize:function(t){var e=this;t||(t={}),this.callSuper("initialize",t),this.bodyFill=t.fill||"",t.hasOwnProperty("bodyFill")&&(this.bodyFill=t.bodyFill),this.bodyText=t.text||"",t.hasOwnProperty("bodyText")&&(this.bodyText=t.bodyText),o.Constants.RECT_DISABLED_CONTROLS.forEach((function(t){e.setControlVisible(t,!1)})),this.set("fill","transparent"),this.on({added:this._initComponents,modified:this._setComponentsPosition,scaling:this._setComponentsPosition,moving:this._setComponentsPosition,rotating:this._setComponentsPosition})},_initComponents:function(){this.text=new i.fabric.Text("",{visible:!1}),this.body=new i.fabric.Rect({width:this.width,height:this.height,top:this.top,left:this.left,fill:this.bodyFill}),this.components=[this.text,this.body],this._setupComponents(),this.setText(this.bodyText)},_setupComponents:function(){var t=this;this.components.forEach((function(e){e.set({excludeFromExport:!0,hasControls:!1,selectable:!1}),t.canvas.add(e),e.sendBackwards()}))},_setComponentsPosition:function(){var t=this.height*this.scaleY,e=this.width*this.scaleX,n=this.getBoundingRect();this.text&&this.text.set({top:n.top+.5*(n.height-this.text.height),left:n.left+.5*(n.width-this.text.width)}),this.body.set({top:this.top,left:this.left,width:e,height:t,angle:this.angle})},getComponents:function(){return this.components},setText:function(t){this.bodyText=t,"m"!==t.slice(-1)&&(t+="m"),this.text.set({text:t}),this._setComponentsPosition()},_render:function(t){this.callSuper("_render",t)},clear:function(){this.canvas.remove(this.components)},toObject:function(){return i.fabric.util.object.extend(this.callSuper("toObject"),{bodyFill:this.get("bodyFill"),bodyText:this.get("bodyText")})}});e.Line=s,i.fabric.Line=s,i.fabric.Line.fromObject=function(t,e){return i.fabric.Object._fromObject("Line",t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Constants=void 0;e.Constants={RECT_DISABLED_CONTROLS:["tl","tr","bl","br","mt","mb"]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Arrowline",{enumerable:!0,get:function(){return i.Arrowline}}),Object.defineProperty(e,"Canvas",{enumerable:!0,get:function(){return o.Canvas}}),Object.defineProperty(e,"Line",{enumerable:!0,get:function(){return s.Line}}),Object.defineProperty(e,"Constants",{enumerable:!0,get:function(){return r.Constants}});var i=n(4),o=n(5),s=n(1),r=n(2)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Arrowline=void 0;var i=n(0),o=n(1),s=i.fabric.util.createClass(o.Line,{type:"arrowline",_initComponents:function(){this.text=new i.fabric.Text(this.bodyText,{backgroundColor:"white"}),this.body=new i.fabric.Rect({fill:this.bodyFill}),this.leftTriangle=new i.fabric.Triangle({fill:this.bodyFill}),this.rightTriangle=new i.fabric.Triangle({fill:this.bodyFill}),this._setComponentsPosition(),this.components=[this.body,this.leftTriangle,this.rightTriangle,this.text],this._setupComponents(),this.setText(this.bodyText)},_setComponentsPosition:function(){var t=Math.PI/180,e=this.height*this.scaleY,n=this.width*this.scaleX,i=Math.cos(this.angle*t),o=Math.sin(this.angle*t),s=this.getBoundingRect();this.text.set({top:s.top+.5*(s.height-this.text.height),left:s.left+.5*(s.width-this.text.width),fontSize:18}),this.body.set({top:this.top+e*o+e/4*i,left:this.left+e*i-e/4*o,width:n-2*e,height:e/2,angle:this.angle}),this.leftTriangle.set({top:this.top+e*i,left:this.left-e*o,width:e,height:e,angle:this.angle-90}),this.rightTriangle.set({top:this.top+n*o,left:this.left+n*i,width:e,height:e,angle:this.angle+90})}});e.Arrowline=s,i.fabric.Arrowline=s,i.fabric.Arrowline.fromObject=function(t,e){return i.fabric.Object._fromObject("Arrowline",t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Canvas=void 0;var i=n(0),o=n(2),s=n(1);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var h=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))).domElemendId=t,n.scale={value:null,shape:null},n.customBackgroundImage=null,n}var n,r,h;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,t),n=e,(r=[{key:"addImage",value:function(t){var e=this,n=new FileReader;n.onload=function(){var t=document.createElement("img");t.src=n.result,e.customBackgroundImage=new i.fabric.Image(t),e.customBackgroundImage.scale(e.height/e.customBackgroundImage.height),e.add(e.customBackgroundImage),e.renderAll()},n.readAsDataURL(t)}},{key:"lockImage",value:function(){this.customBackgroundImage.sendToBack(),this.customBackgroundImage.hasControls=!1,this.customBackgroundImage.selectable=!1,this.discardActiveObject(),this.renderAll()}},{key:"_lockObjectsToBoundaries",value:function(){this.on("object:moving",(function(t){var e=t.target;e.currentHeight>this.height||e.currentWidth>this.width||(e.setCoords(),(e.getBoundingRect().top<0||e.getBoundingRect().left<0)&&(e.top=Math.max(e.top,e.top-e.getBoundingRect().top),e.left=Math.max(e.left,e.left-e.getBoundingRect().left)),(e.getBoundingRect().top+e.getBoundingRect().height>this.height||e.getBoundingRect().left+e.getBoundingRect().width>this.width)&&(e.top=Math.min(e.top,this.height-e.getBoundingRect().height+e.top-e.getBoundingRect().top),e.left=Math.min(e.left,this.width-e.getBoundingRect().width+e.left-e.getBoundingRect().left)))}))}},{key:"setScale",value:function(t){t.shape&&(this.scale.shape=t.shape,this.scale.shape.hasControls=!1),t.value&&(this.scale.value=t.value)}},{key:"getScale",value:function(){return this.scale}},{key:"lockScale",value:function(){this.scale.shape.hasControls=!1}},{key:"remove",value:function(t){console.log("biche"),Array.isArray(t)?t.forEach((function(t){t.hasOwnProperty("clear")&&t.clear()})):t.hasOwnProperty("clear")&&t.clear(),this.callSuper("remove",t)}},{key:"clearScale",value:function(){console.log("clear scales ujbjg"),this.scale.shape&&(console.log("clear scale"),this.clear(),this.remove(this.scale.shape))}},{key:"listToSelectDOM",value:function(t){var e=document.getElementById(this.domElemendId),n=document.createElement("select");n.id="fabricashapeShapeChoices",e.parentElement.appendChild(n);for(var i=0;i<t.length;i++){var o=document.createElement("option");o.value=t[i].label,o.text=t[i].label,o.style.backgroundColor=t[i].color,n.appendChild(o)}return n}},{key:"setShapeChoices",value:function(t){var e=this.listToSelectDOM(t);this.createReferenceLine(e)}},{key:"createReferenceLine",value:function(t){var e=this,n=new i.fabric.Rect({top:5,left:5,width:80,height:17,fill:t.options[t.selectedIndex].style.backgroundColor});this.add(n),this.item(this.size()-1).hasControls=!1,this.requestRenderAll();var s=function(){e.item(e.size()-1).set("fill",t.options[t.selectedIndex].style.backgroundColor),e.renderAll()};n.on("mousedown",(function(){e.createReferenceLine(t),n.hasControls=!0,o.Constants.RECT_DISABLED_CONTROLS.forEach((function(t){n.setControlVisible(t,!1)})),n.off("mousedown")})),t.removeEventListener("change",s),t.addEventListener("change",s)}},{key:"createScaledLine",value:function(t){var e=this.scale.shape.width*this.scale.shape.scaleX/this.scale.value;return t.top=t.top*e,t.left=t.left*e,t.width=t.width*e,t.height=t.stroke*e,new s.Line(t)}}])&&a(n.prototype,r),h&&a(n,h),e}(i.fabric.Canvas);e.Canvas=h}])}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvZXh0ZXJuYWwgXCJmYWJyaWNcIiIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvbGluZS5qcyIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly9mYWJyaWNhc2hhcGUvLi9zcmMvYXJyb3dsaW5lLmpzIiwid2VicGFjazovL2ZhYnJpY2FzaGFwZS8uL3NyYy9jYW52YXMuanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIkxpbmUiLCJmYWJyaWMiLCJ1dGlsIiwiY3JlYXRlQ2xhc3MiLCJSZWN0IiwidHlwZSIsImNvbXBvbmVudHMiLCJoYXNDb250cm9scyIsImluaXRpYWxpemUiLCJvcHRpb25zIiwiY2FsbFN1cGVyIiwiYm9keUZpbGwiLCJmaWxsIiwiYm9keVRleHQiLCJ0ZXh0IiwiQ29uc3RhbnRzIiwiUkVDVF9ESVNBQkxFRF9DT05UUk9MUyIsImZvckVhY2giLCJjb250cm9sIiwic2V0Q29udHJvbFZpc2libGUiLCJzZXQiLCJvbiIsIl9pbml0Q29tcG9uZW50cyIsIl9zZXRDb21wb25lbnRzUG9zaXRpb24iLCJUZXh0IiwidmlzaWJsZSIsImJvZHkiLCJ3aWR0aCIsImhlaWdodCIsInRvcCIsImxlZnQiLCJfc2V0dXBDb21wb25lbnRzIiwic2V0VGV4dCIsImNvbXBvbmVudCIsImV4Y2x1ZGVGcm9tRXhwb3J0Iiwic2VsZWN0YWJsZSIsImNhbnZhcyIsImFkZCIsInNlbmRCYWNrd2FyZHMiLCJzY2FsZVkiLCJzY2FsZVgiLCJib3VuZGluZ1JlY3QiLCJnZXRCb3VuZGluZ1JlY3QiLCJhbmdsZSIsImdldENvbXBvbmVudHMiLCJzbGljZSIsIl9yZW5kZXIiLCJjdHgiLCJjbGVhciIsInJlbW92ZSIsInRvT2JqZWN0IiwiZXh0ZW5kIiwiZnJvbU9iamVjdCIsImNhbGxiYWNrIiwiX2Zyb21PYmplY3QiLCJBcnJvd2xpbmUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJsZWZ0VHJpYW5nbGUiLCJUcmlhbmdsZSIsInJpZ2h0VHJpYW5nbGUiLCJkZWdyZWVzVG9SYWRpYW5zUmF0aW8iLCJNYXRoIiwiUEkiLCJjb3NUZXRhIiwiY29zIiwic2luVGV0YSIsInNpbiIsImZvbnRTaXplIiwiQ2FudmFzIiwiZG9tRWxlbWVuZElkIiwic2NhbGUiLCJzaGFwZSIsImN1c3RvbUJhY2tncm91bmRJbWFnZSIsImltYWdlRmlsZSIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJpbWciLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzcmMiLCJyZXN1bHQiLCJJbWFnZSIsInJlbmRlckFsbCIsInJlYWRBc0RhdGFVUkwiLCJzZW5kVG9CYWNrIiwiZGlzY2FyZEFjdGl2ZU9iamVjdCIsImUiLCJvYmoiLCJ0YXJnZXQiLCJjdXJyZW50SGVpZ2h0IiwiY3VycmVudFdpZHRoIiwic2V0Q29vcmRzIiwibWF4IiwibWluIiwic2NhbGVEZWZpbml0aW9uIiwib2JqZWN0cyIsImNvbnNvbGUiLCJsb2ciLCJBcnJheSIsImlzQXJyYXkiLCJjaG9pY2VzIiwiY2FudmFzaG9sZGVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJzZWxlY3RMaXN0IiwiaWQiLCJwYXJlbnRFbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJsZW5ndGgiLCJvcHRpb24iLCJsYWJlbCIsInN0eWxlIiwiY29sb3IiLCJzZWxlY3RPYmplY3QiLCJsaXN0VG9TZWxlY3RET00iLCJjcmVhdGVSZWZlcmVuY2VMaW5lIiwicmVmZXJlbmNlTGluZSIsInNlbGVjdGVkSW5kZXgiLCJpdGVtIiwic2l6ZSIsInJlcXVlc3RSZW5kZXJBbGwiLCJmaWxsUmVmZXJlbmNlTGluZSIsIm9mZiIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwic3Ryb2tlIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUEyQ0EsRUFBTUMsR0FDMUIsaUJBQVpDLFNBQTBDLGlCQUFYQyxPQUN4Q0EsT0FBT0QsUUFBVUQsRUFBUUcsUUFBUSxXQUNSLG1CQUFYQyxRQUF5QkEsT0FBT0MsSUFDOUNELE9BQU8sZUFBZ0IsQ0FBQyxVQUFXSixHQUNULGlCQUFaQyxRQUNkQSxRQUFzQixhQUFJRCxFQUFRRyxRQUFRLFdBRTFDSixFQUFtQixhQUFJQyxFQUFRRCxFQUFhLFFBUjlDLENBU21CLG9CQUFUTyxLQUF1QkEsS0FBT0MsTUFBTSxTQUFTQyxHQUN2RCxPLFlDVEUsSUFBSUMsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVVYsUUFHbkMsSUFBSUMsRUFBU08sRUFBaUJFLEdBQVksQ0FDekNDLEVBQUdELEVBQ0hFLEdBQUcsRUFDSFosUUFBUyxJQVVWLE9BTkFhLEVBQVFILEdBQVVJLEtBQUtiLEVBQU9ELFFBQVND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LEVBQVFvQixJQUFNeUMsRUFDNUI3RCxFQUFRcUIsS0FBT3JCLEVBQVFxQixLQUFPd0MsRUFDOUI3RCxFQUFRa0IsTUFBUWxCLEVBQVFrQixNQUFRMkMsRUFDaEM3RCxFQUFRbUIsT0FBU25CLEVBQVFvSCxPQUFTdkQsRUFFM0IsSUFBSSxFQUFKLEtBQVM3RCxRLDhCQXZMSSxFQUFBUixPQUFPbUUsUSIsImZpbGUiOiJmYWJyaWNhc2hhcGUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKFwiZmFicmljXCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFwiZmFicmljYXNoYXBlXCIsIFtcImZhYnJpY1wiXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJmYWJyaWNhc2hhcGVcIl0gPSBmYWN0b3J5KHJlcXVpcmUoXCJmYWJyaWNcIikpO1xuXHRlbHNlXG5cdFx0cm9vdFtcImZhYnJpY2FzaGFwZVwiXSA9IGZhY3Rvcnkocm9vdFtcImZhYnJpY1wiXSk7XG59KSh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDogdGhpcywgZnVuY3Rpb24oX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fKSB7XG5yZXR1cm4gIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDMpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18wX187IiwiaW1wb3J0IHtmYWJyaWN9IGZyb20gJ2ZhYnJpYydcbmltcG9ydCB7Q29uc3RhbnRzfSBmcm9tICcuL2NvbnN0YW50cydcblxuZXhwb3J0IGNvbnN0IExpbmUgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuUmVjdCwge1xuXG4gICAgdHlwZTogJ2xpbmUnLFxuICAgIGNvbXBvbmVudHM6IFtdLFxuICAgIGhhc0NvbnRyb2xzOiB0cnVlLFxuXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHsgfSk7XG4gICAgICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgb3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5ib2R5RmlsbCA9IG9wdGlvbnMuZmlsbCB8fCAnJ1xuICAgICAgICBpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgnYm9keUZpbGwnKSkge1xuICAgICAgICAgICAgdGhpcy5ib2R5RmlsbCA9IG9wdGlvbnMuYm9keUZpbGxcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmJvZHlUZXh0ID0gb3B0aW9ucy50ZXh0IHx8ICcnXG4gICAgICAgIGlmIChvcHRpb25zLmhhc093blByb3BlcnR5KCdib2R5VGV4dCcpKSB7XG4gICAgICAgICAgICB0aGlzLmJvZHlUZXh0ID0gb3B0aW9ucy5ib2R5VGV4dFxuICAgICAgICB9XG4gICAgICAgIENvbnN0YW50cy5SRUNUX0RJU0FCTEVEX0NPTlRST0xTLmZvckVhY2goKGNvbnRyb2wpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0Q29udHJvbFZpc2libGUoY29udHJvbCwgZmFsc2UpXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuc2V0KCdmaWxsJywgJ3RyYW5zcGFyZW50JylcblxuICAgICAgICB0aGlzLm9uKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICdhZGRlZCc6IHRoaXMuX2luaXRDb21wb25lbnRzLFxuICAgICAgICAgICAgICAgICdtb2RpZmllZCc6IHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbixcbiAgICAgICAgICAgICAgICAnc2NhbGluZyc6IHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbixcbiAgICAgICAgICAgICAgICAnbW92aW5nJzogdGhpcy5fc2V0Q29tcG9uZW50c1Bvc2l0aW9uLFxuICAgICAgICAgICAgICAgICdyb3RhdGluZyc6IHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvblxuICAgICAgICAgICAgfVxuICAgICAgICApXG4gICAgfSxcblxuICAgIF9pbml0Q29tcG9uZW50czogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnRleHQgPSBuZXcgZmFicmljLlRleHQoJycsIHt2aXNpYmxlOiBmYWxzZX0pXG4gICAgICAgIHRoaXMuYm9keSA9IG5ldyBmYWJyaWMuUmVjdCh7XG4gICAgICAgICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQsXG4gICAgICAgICAgICB0b3A6IHRoaXMudG9wLFxuICAgICAgICAgICAgbGVmdDogdGhpcy5sZWZ0LFxuICAgICAgICAgICAgZmlsbDogdGhpcy5ib2R5RmlsbFxuICAgICAgICB9KVxuICAgICAgICB0aGlzLmNvbXBvbmVudHMgPSBbdGhpcy50ZXh0LCB0aGlzLmJvZHldXG5cbiAgICAgICAgdGhpcy5fc2V0dXBDb21wb25lbnRzKClcbiAgICAgICAgdGhpcy5zZXRUZXh0KHRoaXMuYm9keVRleHQpXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIF9zZXR1cENvbXBvbmVudHM6IGFkZCB0aGUgY29tcG9uZW50IHRvIHRoZSBjYW52YXMgYW5kIHNldCBzb21lIG9wdGlvbnNcbiAgICAgKiB0byBhdm9pZCB0aGVtIGZyb20gYmVpbmcgZXhwb3J0ZWQvc2VsZWN0ZWRcbiAgICAgKi9cbiAgICBfc2V0dXBDb21wb25lbnRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY29tcG9uZW50cy5mb3JFYWNoKChjb21wb25lbnQpID0+IHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5zZXQoe1xuICAgICAgICAgICAgICAgIGV4Y2x1ZGVGcm9tRXhwb3J0OiB0cnVlLFxuICAgICAgICAgICAgICAgIGhhc0NvbnRyb2xzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzZWxlY3RhYmxlOiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLmFkZChjb21wb25lbnQpXG4gICAgICAgICAgICBjb21wb25lbnQuc2VuZEJhY2t3YXJkcygpXG4gICAgICAgIH0pXG4gICAgfSxcblxuICAgIF9zZXRDb21wb25lbnRzUG9zaXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5oZWlnaHQgKiB0aGlzLnNjYWxlWSxcbiAgICAgICAgICAgIHdpZHRoID0gdGhpcy53aWR0aCAqIHRoaXMuc2NhbGVYLFxuICAgICAgICAgICAgYm91bmRpbmdSZWN0ID0gdGhpcy5nZXRCb3VuZGluZ1JlY3QoKVxuXG4gICAgICAgIGlmICh0aGlzLnRleHQpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dC5zZXQoe1xuICAgICAgICAgICAgICAgIHRvcDogYm91bmRpbmdSZWN0LnRvcCArIDAuNSAqIChib3VuZGluZ1JlY3QuaGVpZ2h0IC0gdGhpcy50ZXh0LmhlaWdodCksXG4gICAgICAgICAgICAgICAgbGVmdDogYm91bmRpbmdSZWN0LmxlZnQgKyAwLjUgKiAoYm91bmRpbmdSZWN0LndpZHRoIC0gdGhpcy50ZXh0LndpZHRoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYm9keS5zZXQoe1xuICAgICAgICAgICAgdG9wOiB0aGlzLnRvcCxcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMubGVmdCxcbiAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICAgICAgYW5nbGU6IHRoaXMuYW5nbGVcbiAgICAgICAgfSlcblxuICAgIH0sXG5cbiAgICBnZXRDb21wb25lbnRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudHNcbiAgICB9LFxuXG4gICAgc2V0VGV4dDogZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgICAgdGhpcy5ib2R5VGV4dCA9IHRleHRcbiAgICAgICAgaWYgKHRleHQuc2xpY2UoLTEpICE9PSAnbScpIHtcbiAgICAgICAgICAgIHRleHQgKz0gJ20nXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50ZXh0LnNldCh7XG4gICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuX3NldENvbXBvbmVudHNQb3NpdGlvbigpXG4gICAgfSxcblxuICAgIF9yZW5kZXI6IGZ1bmN0aW9uIChjdHgpIHtcbiAgICAgICAgdGhpcy5jYWxsU3VwZXIoJ19yZW5kZXInLCBjdHgpXG4gICAgfSxcblxuICAgIGNsZWFyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY2FudmFzLnJlbW92ZSh0aGlzLmNvbXBvbmVudHMpXG4gICAgfSxcblxuICAgIHRvT2JqZWN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHRoaXMuY2FsbFN1cGVyKCd0b09iamVjdCcpLCB7XG4gICAgICAgICAgICBib2R5RmlsbDogdGhpcy5nZXQoJ2JvZHlGaWxsJyksXG4gICAgICAgICAgICBib2R5VGV4dDogdGhpcy5nZXQoJ2JvZHlUZXh0JylcbiAgICAgICAgfSk7XG4gICAgfVxuXG59KVxuXG5mYWJyaWMuTGluZSA9IExpbmVcblxuZmFicmljLkxpbmUuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIGZhYnJpYy5PYmplY3QuX2Zyb21PYmplY3QoJ0xpbmUnLCBvYmplY3QsIGNhbGxiYWNrKTtcbn07XG4iLCIvLyBjb250cm9sczogJ3RsJywgJ3RyJywgJ2JyJywgJ2JsJywgJ21sJywgJ210JywgJ21yJywgJ21iJywgJ210cidcbmV4cG9ydCBjb25zdCBDb25zdGFudHMgPSB7XG4gICAgUkVDVF9ESVNBQkxFRF9DT05UUk9MUzogWyAndGwnLCAndHInLCAnYmwnLCAnYnInLCAnbXQnLCAnbWInIF1cbn1cbiIsImltcG9ydCB7QXJyb3dsaW5lfSBmcm9tICcuL2Fycm93bGluZS5qcyc7XG5pbXBvcnQge0NhbnZhc30gZnJvbSAnLi9jYW52YXMuanMnO1xuaW1wb3J0IHtMaW5lfSBmcm9tICcuL2xpbmUuanMnO1xuaW1wb3J0IHtDb25zdGFudHN9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmV4cG9ydCB7QXJyb3dsaW5lLCBDYW52YXMsIExpbmUsIENvbnN0YW50c307XG4iLCJpbXBvcnQge2ZhYnJpY30gZnJvbSAnZmFicmljJ1xuaW1wb3J0IHtMaW5lfSBmcm9tICcuL2xpbmUnXG5cbi8qKlxuICogQW4gQXJyb3dsaW5lIGlzIGEgZ3JvdXAgdGhhdCBsb29rcyBsaWtlIGEgZG91YmxlIGFycm93ZWQgbGluZTpcbiAqICAgICAgIDwtLS0tLS0tPlxuICovXG5leHBvcnQgY29uc3QgQXJyb3dsaW5lID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoTGluZSwge1xuXG4gICAgdHlwZTogJ2Fycm93bGluZScsXG5cbiAgICBfaW5pdENvbXBvbmVudHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy50ZXh0ID0gbmV3IGZhYnJpYy5UZXh0KHRoaXMuYm9keVRleHQsIHtiYWNrZ3JvdW5kQ29sb3I6ICd3aGl0ZSd9KVxuICAgICAgICB0aGlzLmJvZHkgPSBuZXcgZmFicmljLlJlY3Qoe2ZpbGw6IHRoaXMuYm9keUZpbGx9KVxuICAgICAgICB0aGlzLmxlZnRUcmlhbmdsZSA9IG5ldyBmYWJyaWMuVHJpYW5nbGUoe2ZpbGw6IHRoaXMuYm9keUZpbGx9KVxuICAgICAgICB0aGlzLnJpZ2h0VHJpYW5nbGUgPSBuZXcgZmFicmljLlRyaWFuZ2xlKHtmaWxsOiB0aGlzLmJvZHlGaWxsfSlcblxuICAgICAgICB0aGlzLl9zZXRDb21wb25lbnRzUG9zaXRpb24oKVxuXG4gICAgICAgIHRoaXMuY29tcG9uZW50cyA9IFt0aGlzLmJvZHksIHRoaXMubGVmdFRyaWFuZ2xlLCB0aGlzLnJpZ2h0VHJpYW5nbGUsIHRoaXMudGV4dF1cblxuICAgICAgICB0aGlzLl9zZXR1cENvbXBvbmVudHMoKVxuICAgICAgICB0aGlzLnNldFRleHQodGhpcy5ib2R5VGV4dClcbiAgICB9LFxuXG4gICAgX3NldENvbXBvbmVudHNQb3NpdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBkZWdyZWVzVG9SYWRpYW5zUmF0aW8gPSBNYXRoLlBJIC8gMTgwLFxuICAgICAgICAgICAgaGVpZ2h0ID0gdGhpcy5oZWlnaHQgKiB0aGlzLnNjYWxlWSxcbiAgICAgICAgICAgIHdpZHRoID0gdGhpcy53aWR0aCAqIHRoaXMuc2NhbGVYLFxuICAgICAgICAgICAgY29zVGV0YSA9IE1hdGguY29zKHRoaXMuYW5nbGUgKiBkZWdyZWVzVG9SYWRpYW5zUmF0aW8pLFxuICAgICAgICAgICAgc2luVGV0YSA9IE1hdGguc2luKHRoaXMuYW5nbGUgKiBkZWdyZWVzVG9SYWRpYW5zUmF0aW8pLFxuICAgICAgICAgICAgYm91bmRpbmdSZWN0ID0gdGhpcy5nZXRCb3VuZGluZ1JlY3QoKVxuXG4gICAgICAgIHRoaXMudGV4dC5zZXQoe1xuICAgICAgICAgICAgdG9wOiBib3VuZGluZ1JlY3QudG9wICsgMC41ICogKGJvdW5kaW5nUmVjdC5oZWlnaHQgLSB0aGlzLnRleHQuaGVpZ2h0KSxcbiAgICAgICAgICAgIGxlZnQ6IGJvdW5kaW5nUmVjdC5sZWZ0ICsgMC41ICogKGJvdW5kaW5nUmVjdC53aWR0aCAtIHRoaXMudGV4dC53aWR0aCksXG4gICAgICAgICAgICBmb250U2l6ZTogMThcbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLmJvZHkuc2V0KHtcbiAgICAgICAgICAgIHRvcDogdGhpcy50b3AgKyBoZWlnaHQgKiBzaW5UZXRhICsgKGhlaWdodCAvIDQpICogY29zVGV0YSxcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMubGVmdCArIGhlaWdodCAqIGNvc1RldGEgLSAoaGVpZ2h0IC8gNCkgKiBzaW5UZXRhLFxuICAgICAgICAgICAgd2lkdGg6IHdpZHRoIC0gMiAqIGhlaWdodCxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0IC8gMixcbiAgICAgICAgICAgIGFuZ2xlOiB0aGlzLmFuZ2xlXG4gICAgICAgIH0pXG5cbiAgICAgICAgdGhpcy5sZWZ0VHJpYW5nbGUuc2V0KHtcbiAgICAgICAgICAgIHRvcDogdGhpcy50b3AgKyBoZWlnaHQgKiBjb3NUZXRhLFxuICAgICAgICAgICAgbGVmdDogdGhpcy5sZWZ0IC0gaGVpZ2h0ICogc2luVGV0YSxcbiAgICAgICAgICAgIHdpZHRoOiBoZWlnaHQsXG4gICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgIGFuZ2xlOiB0aGlzLmFuZ2xlIC0gOTBcbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLnJpZ2h0VHJpYW5nbGUuc2V0KHtcbiAgICAgICAgICAgIHRvcDogdGhpcy50b3AgKyB3aWR0aCAqIHNpblRldGEsXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLmxlZnQgKyB3aWR0aCAqIGNvc1RldGEsXG4gICAgICAgICAgICB3aWR0aDogaGVpZ2h0LFxuICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgICBhbmdsZTogdGhpcy5hbmdsZSArIDkwXG4gICAgICAgIH0pXG4gICAgfVxuXG59KVxuXG5mYWJyaWMuQXJyb3dsaW5lID0gQXJyb3dsaW5lXG5cbmZhYnJpYy5BcnJvd2xpbmUuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIGZhYnJpYy5PYmplY3QuX2Zyb21PYmplY3QoJ0Fycm93bGluZScsIG9iamVjdCwgY2FsbGJhY2spO1xufTtcbiIsImltcG9ydCB7ZmFicmljfSBmcm9tICdmYWJyaWMnXG5pbXBvcnQge0NvbnN0YW50c30gZnJvbSAnLi9jb25zdGFudHMnXG5pbXBvcnQge0xpbmV9IGZyb20gJy4vbGluZSdcblxuZXhwb3J0IGNsYXNzIENhbnZhcyBleHRlbmRzIGZhYnJpYy5DYW52YXMge1xuXG4gICAgY29uc3RydWN0b3IoZG9tRWxlbWVuZElkKSB7XG4gICAgICAgIHN1cGVyKGRvbUVsZW1lbmRJZClcbiAgICAgICAgdGhpcy5kb21FbGVtZW5kSWQgPSBkb21FbGVtZW5kSWRcbiAgICAgICAgdGhpcy5zY2FsZSA9IHt2YWx1ZTogbnVsbCwgc2hhcGU6IG51bGx9XG4gICAgICAgIHRoaXMuY3VzdG9tQmFja2dyb3VuZEltYWdlID0gbnVsbFxuICAgICAgICAvLyB0aGlzLl9sb2NrT2JqZWN0c1RvQm91bmRhcmllcygpXG4gICAgfVxuXG4gICAgYWRkSW1hZ2UoaW1hZ2VGaWxlKSB7XG4gICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKClcblxuICAgICAgICByZWFkZXIub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJylcblxuICAgICAgICAgICAgaW1nLnNyYyA9IHJlYWRlci5yZXN1bHRcblxuICAgICAgICAgICAgdGhpcy5jdXN0b21CYWNrZ3JvdW5kSW1hZ2UgPSBuZXcgZmFicmljLkltYWdlKGltZylcbiAgICAgICAgICAgIHRoaXMuY3VzdG9tQmFja2dyb3VuZEltYWdlLnNjYWxlKHRoaXMuaGVpZ2h0IC8gdGhpcy5jdXN0b21CYWNrZ3JvdW5kSW1hZ2UuaGVpZ2h0KVxuICAgICAgICAgICAgdGhpcy5hZGQodGhpcy5jdXN0b21CYWNrZ3JvdW5kSW1hZ2UpXG4gICAgICAgICAgICB0aGlzLnJlbmRlckFsbCgpXG4gICAgICAgIH07XG5cbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoaW1hZ2VGaWxlKTtcbiAgICB9XG5cbiAgICBsb2NrSW1hZ2UoKSB7XG4gICAgICAgIHRoaXMuY3VzdG9tQmFja2dyb3VuZEltYWdlLnNlbmRUb0JhY2soKVxuICAgICAgICB0aGlzLmN1c3RvbUJhY2tncm91bmRJbWFnZS5oYXNDb250cm9scyA9IGZhbHNlXG4gICAgICAgIHRoaXMuY3VzdG9tQmFja2dyb3VuZEltYWdlLnNlbGVjdGFibGUgPSBmYWxzZVxuICAgICAgICB0aGlzLmRpc2NhcmRBY3RpdmVPYmplY3QoKTtcbiAgICAgICAgdGhpcy5yZW5kZXJBbGwoKVxuICAgIH1cblxuICAgIF9sb2NrT2JqZWN0c1RvQm91bmRhcmllcygpIHtcbiAgICAgICAgdGhpcy5vbignb2JqZWN0Om1vdmluZycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICB2YXIgb2JqID0gZS50YXJnZXQ7XG5cbiAgICAgICAgICAgIC8vIGlmIG9iamVjdCBpcyB0b28gYmlnIGlnbm9yZVxuICAgICAgICAgICAgaWYgKG9iai5jdXJyZW50SGVpZ2h0ID4gdGhpcy5oZWlnaHQgfHwgb2JqLmN1cnJlbnRXaWR0aCA+IHRoaXMud2lkdGgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvYmouc2V0Q29vcmRzKCk7XG4gICAgICAgICAgICAvLyB0b3AtbGVmdCAgY29ybmVyXG4gICAgICAgICAgICBpZiAob2JqLmdldEJvdW5kaW5nUmVjdCgpLnRvcCA8IDAgfHwgb2JqLmdldEJvdW5kaW5nUmVjdCgpLmxlZnQgPCAwKSB7XG4gICAgICAgICAgICAgICAgb2JqLnRvcCA9IE1hdGgubWF4KG9iai50b3AsIG9iai50b3AgLSBvYmouZ2V0Qm91bmRpbmdSZWN0KCkudG9wKTtcbiAgICAgICAgICAgICAgICBvYmoubGVmdCA9IE1hdGgubWF4KG9iai5sZWZ0LCBvYmoubGVmdCAtIG9iai5nZXRCb3VuZGluZ1JlY3QoKS5sZWZ0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGJvdC1yaWdodCBjb3JuZXJcbiAgICAgICAgICAgIGlmIChvYmouZ2V0Qm91bmRpbmdSZWN0KCkudG9wICsgb2JqLmdldEJvdW5kaW5nUmVjdCgpLmhlaWdodCA+IHRoaXMuaGVpZ2h0IHx8XG4gICAgICAgICAgICAgICAgICAgIG9iai5nZXRCb3VuZGluZ1JlY3QoKS5sZWZ0ICsgb2JqLmdldEJvdW5kaW5nUmVjdCgpLndpZHRoID4gdGhpcy53aWR0aCkge1xuICAgICAgICAgICAgICAgIG9iai50b3AgPSBNYXRoLm1pbihvYmoudG9wLCB0aGlzLmhlaWdodCAtIG9iai5nZXRCb3VuZGluZ1JlY3QoKS5oZWlnaHQgK1xuICAgICAgICAgICAgICAgICAgICBvYmoudG9wIC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLnRvcCk7XG4gICAgICAgICAgICAgICAgb2JqLmxlZnQgPSBNYXRoLm1pbihvYmoubGVmdCwgdGhpcy53aWR0aCAtIG9iai5nZXRCb3VuZGluZ1JlY3QoKS53aWR0aCArXG4gICAgICAgICAgICAgICAgICAgIG9iai5sZWZ0IC0gb2JqLmdldEJvdW5kaW5nUmVjdCgpLmxlZnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzZXRTY2FsZShzY2FsZURlZmluaXRpb24pIHtcbiAgICAgICAgaWYgKHNjYWxlRGVmaW5pdGlvbi5zaGFwZSkge1xuICAgICAgICAgICAgdGhpcy5zY2FsZS5zaGFwZSA9IHNjYWxlRGVmaW5pdGlvbi5zaGFwZVxuICAgICAgICAgICAgdGhpcy5zY2FsZS5zaGFwZS5oYXNDb250cm9scyA9IGZhbHNlXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNjYWxlRGVmaW5pdGlvbi52YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zY2FsZS52YWx1ZSA9IHNjYWxlRGVmaW5pdGlvbi52YWx1ZVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0U2NhbGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNjYWxlXG4gICAgfVxuXG4gICAgbG9ja1NjYWxlKCkge1xuICAgICAgICB0aGlzLnNjYWxlLnNoYXBlLmhhc0NvbnRyb2xzID0gZmFsc2VcbiAgICB9XG5cbiAgICByZW1vdmUob2JqZWN0cykge1xuICAgICAgICBjb25zb2xlLmxvZygnYmljaGUnKVxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvYmplY3RzKSkge1xuICAgICAgICAgICAgb2JqZWN0cy5mb3JFYWNoKChvYmplY3QpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAob2JqZWN0Lmhhc093blByb3BlcnR5KCdjbGVhcicpKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5jbGVhcigpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChvYmplY3RzLmhhc093blByb3BlcnR5KCdjbGVhcicpKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0cy5jbGVhcigpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYWxsU3VwZXIoJ3JlbW92ZScsIG9iamVjdHMpXG4gICAgfVxuXG4gICAgY2xlYXJTY2FsZSgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2NsZWFyIHNjYWxlcyB1amJqZycpXG4gICAgICAgIGlmICh0aGlzLnNjYWxlLnNoYXBlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY2xlYXIgc2NhbGUnKVxuICAgICAgICAgICAgdGhpcy5jbGVhcigpXG4gICAgICAgICAgICB0aGlzLnJlbW92ZSh0aGlzLnNjYWxlLnNoYXBlKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLypcbiAgICAgKiBAcGFyYW0gY2hvaWNlczogYSBsaXN0IG9mIChsYWJlbCwgY29sb3IpXG4gICAgICogIGV4YW1wbGU6IFtcbiAgICAgKiAgICAgIHtsYWJlbDogJ2xhYmVsMScsIGNvbG9yOiAnYmx1ZSd9LFxuICAgICAqICAgICAge2xhYmVsOiAnbGFiZWwyJywgY29sb3I6ICdyZ2JhKDI1NSwwLDAsMC41KSd9XG4gICAgICogICBdXG4gICAgICogQHJldHVybiBhIERPTSBzZWxlY3Qgb2JqZWN0IHdpdGggY29ycmVzcG9uZGluZyBvcHRpb25zXG4gICAgICovXG4gICAgbGlzdFRvU2VsZWN0RE9NKGNob2ljZXMpIHtcbiAgICAgICAgY29uc3QgY2FudmFzaG9sZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5kb21FbGVtZW5kSWQpXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFuZCBhcHBlbmQgc2VsZWN0IGxpc3RcbiAgICAgICAgY29uc3Qgc2VsZWN0TGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpXG5cbiAgICAgICAgc2VsZWN0TGlzdC5pZCA9ICdmYWJyaWNhc2hhcGVTaGFwZUNob2ljZXMnXG4gICAgICAgIGNhbnZhc2hvbGRlci5wYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKHNlbGVjdExpc3QpXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFuZCBhcHBlbmQgdGhlIG9wdGlvbnNcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaG9pY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKVxuXG4gICAgICAgICAgICBvcHRpb24udmFsdWUgPSBjaG9pY2VzW2ldLmxhYmVsXG4gICAgICAgICAgICBvcHRpb24udGV4dCA9IGNob2ljZXNbaV0ubGFiZWxcbiAgICAgICAgICAgIG9wdGlvbi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjaG9pY2VzW2ldLmNvbG9yXG4gICAgICAgICAgICBzZWxlY3RMaXN0LmFwcGVuZENoaWxkKG9wdGlvbilcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2VsZWN0TGlzdFxuICAgIH1cblxuICAgIHNldFNoYXBlQ2hvaWNlcyhjaG9pY2VzKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdE9iamVjdCA9IHRoaXMubGlzdFRvU2VsZWN0RE9NKGNob2ljZXMpXG5cbiAgICAgICAgdGhpcy5jcmVhdGVSZWZlcmVuY2VMaW5lKHNlbGVjdE9iamVjdClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbGluZSB1c2VyIGNhbiBjbGljayBvbiB0byBkdXBsaWNhdGUgaXQgYW5kIHVzZSB0aGUgZHVwbGljYXRlIGludG8gdGhlIHNjZW5lLlxuICAgICAqL1xuICAgIGNyZWF0ZVJlZmVyZW5jZUxpbmUoc2VsZWN0T2JqZWN0KSB7XG4gICAgICAgIGNvbnN0IHJlZmVyZW5jZUxpbmUgPSBuZXcgZmFicmljLlJlY3Qoe1xuICAgICAgICAgICAgdG9wOiA1LCBsZWZ0OiA1LCB3aWR0aDogODAsIGhlaWdodDogMTcsXG4gICAgICAgICAgICBmaWxsOiBzZWxlY3RPYmplY3Qub3B0aW9uc1tzZWxlY3RPYmplY3Quc2VsZWN0ZWRJbmRleF0uc3R5bGUuYmFja2dyb3VuZENvbG9yXG4gICAgICAgIH0pXG5cbiAgICAgICAgdGhpcy5hZGQocmVmZXJlbmNlTGluZSlcbiAgICAgICAgdGhpcy5pdGVtKHRoaXMuc2l6ZSgpIC0gMSkuaGFzQ29udHJvbHMgPSBmYWxzZVxuICAgICAgICB0aGlzLnJlcXVlc3RSZW5kZXJBbGwoKVxuXG4gICAgICAgIGNvbnN0IGZpbGxSZWZlcmVuY2VMaW5lID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpc1xuICAgICAgICAgICAgICAgIC5pdGVtKHRoaXMuc2l6ZSgpIC0gMSlcbiAgICAgICAgICAgICAgICAuc2V0KCdmaWxsJywgc2VsZWN0T2JqZWN0Lm9wdGlvbnNbc2VsZWN0T2JqZWN0LnNlbGVjdGVkSW5kZXhdLnN0eWxlLmJhY2tncm91bmRDb2xvcilcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQWxsKClcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGR1cGxpY2F0ZVJlZmVyZW5jZUxpbmUgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVJlZmVyZW5jZUxpbmUoc2VsZWN0T2JqZWN0KVxuICAgICAgICAgICAgcmVmZXJlbmNlTGluZS5oYXNDb250cm9scyA9IHRydWVcbiAgICAgICAgICAgIENvbnN0YW50cy5SRUNUX0RJU0FCTEVEX0NPTlRST0xTLmZvckVhY2goKGNvbnRyb2wpID0+IHtcbiAgICAgICAgICAgICAgICByZWZlcmVuY2VMaW5lLnNldENvbnRyb2xWaXNpYmxlKGNvbnRyb2wsIGZhbHNlKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIHJlZmVyZW5jZUxpbmUub24oJ21vdXNlZG93bicsICgpID0+IHtcbiAgICAgICAgICAgIGR1cGxpY2F0ZVJlZmVyZW5jZUxpbmUoKVxuICAgICAgICAgICAgcmVmZXJlbmNlTGluZS5vZmYoJ21vdXNlZG93bicpXG4gICAgICAgIH0pXG5cbiAgICAgICAgc2VsZWN0T2JqZWN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZpbGxSZWZlcmVuY2VMaW5lKVxuICAgICAgICBzZWxlY3RPYmplY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZmlsbFJlZmVyZW5jZUxpbmUpXG4gICAgfVxuXG4gICAgY3JlYXRlU2NhbGVkTGluZShvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHNjYWxlID0gKHRoaXMuc2NhbGUuc2hhcGUud2lkdGggKiB0aGlzLnNjYWxlLnNoYXBlLnNjYWxlWCkgLyB0aGlzLnNjYWxlLnZhbHVlXG5cbiAgICAgICAgb3B0aW9ucy50b3AgPSBvcHRpb25zLnRvcCAqIHNjYWxlXG4gICAgICAgIG9wdGlvbnMubGVmdCA9IG9wdGlvbnMubGVmdCAqIHNjYWxlXG4gICAgICAgIG9wdGlvbnMud2lkdGggPSBvcHRpb25zLndpZHRoICogc2NhbGVcbiAgICAgICAgb3B0aW9ucy5oZWlnaHQgPSBvcHRpb25zLnN0cm9rZSAqIHNjYWxlXG5cbiAgICAgICAgcmV0dXJuIG5ldyBMaW5lKG9wdGlvbnMpXG4gICAgfVxuXG59XG4iXSwic291cmNlUm9vdCI6IiJ9